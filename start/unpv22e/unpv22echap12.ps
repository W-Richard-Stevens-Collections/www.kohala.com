%!PS-Adobe-3.0
%%Creator: groff version 1.08
%%DocumentNeededResources: font AvantGarde-BookOblique
%%+ font AvantGarde-DemiOblique
%%+ font Helvetica-Bold
%%+ font Palatino-Roman
%%+ font Palatino-Italic
%%+ font Courier
%%+ font Palatino-Bold
%%+ font Courier-Oblique
%%+ font Courier-Bold
%%+ font Symbol
%%DocumentSuppliedResources: procset grops 1.08 0
%%Pages: 21
%%PageOrder: Ascend
%%Orientation: Portrait
%%EndComments
%%BeginProlog
%%BeginResource: procset grops 1.08 0
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/MF{
findfont
[5 2 roll
0 3 1 roll 
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
0.1 setlinewidth
 10.8  78   moveto   14.4  0   rlineto   stroke % lower left cut mark
 39.6  42   moveto    0   21.6 rlineto   stroke
588    78   moveto   14.4  0   rlineto   stroke % lower right cut mark
573.6  42   moveto    0   21.6 rlineto   stroke
 10.8 744   moveto   14.4  0   rlineto   stroke % upper left cut mark
 39.6 758.4 moveto    0   21.6 rlineto   stroke
588   744   moveto   14.4  0   rlineto   stroke % upper right cut mark
573.6 758.4 moveto    0   21.6 rlineto   stroke
%
% uncomment following lines to print rules at page# baseline
% 39.6 708 moveto   50.4 0 rlineto   stroke	% to left of upper left page#
%523.2 708 moveto   50.4 0 rlineto   stroke	% to right of upper right page#
%
% uncomment following lines to print bottom trim line(s)
%0 setlinewidth   129.6 132 moveto   390 0 rlineto   stroke
%		 122   138 moveto     6 0 rlineto   stroke
%		 114   144 moveto    14 0 rlineto   stroke
%		 122   150 moveto     6 0 rlineto   stroke
%		 114   156 moveto    14 0 rlineto   stroke
%		 122   162 moveto     6 0 rlineto   stroke
%		 114   168 moveto    14 0 rlineto   stroke
%		 521.2 138 moveto     6 0 rlineto   stroke
%		 521.2 144 moveto    14 0 rlineto   stroke
%		 521.2 150 moveto     6 0 rlineto   stroke
%		 521.2 156 moveto    14 0 rlineto   stroke
%		 521.2 162 moveto     6 0 rlineto   stroke
%		 521.2 168 moveto    14 0 rlineto   stroke
% uncomment one of following two lines to print bottom trim line for index
%		 129.6 144 moveto   390 0 rlineto   stroke % one line short
%		 129.6 156 moveto   390 0 rlineto   stroke % two lines short
%
% uncomment following lines to print PostScript and Courier versions
%/Courier findfont dup 10 scalefont setfont
%100 65 moveto (PostScript Version: ) show
%version show
%100 50 moveto (Courier Version: ) show
%/FontInfo get /version get show
showpage
}bind def
/DA{
newpath arcn stroke
}bind def
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
/DL{
SN
moveto
SN
lineto stroke
}bind def
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
/FL{
currentgray exch setgray fill setgray
}bind def
/BL/fill load def
/LW/setlinewidth load def
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
}bind def
/PEND{
clear
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%IncludeResource: font AvantGarde-BookOblique
%%IncludeResource: font AvantGarde-DemiOblique
%%IncludeResource: font Helvetica-Bold
%%IncludeResource: font Palatino-Roman
%%IncludeResource: font Palatino-Italic
%%IncludeResource: font Courier
%%IncludeResource: font Palatino-Bold
%%IncludeResource: font Courier-Oblique
%%IncludeResource: font Courier-Bold
%%IncludeResource: font Symbol
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72 def/PL
792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron/scaron/zcaron
/Ydieresis/trademark/quotesingle/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/space
/exclam/quotedbl/numbersign/dollar/percent/ampersand/quoteright/parenleft
/parenright/asterisk/plus/comma/hyphen/period/slash/zero/one/two/three/four
/five/six/seven/eight/nine/colon/semicolon/less/equal/greater/question/at/A/B/C
/D/E/F/G/H/I/J/K/L/M/N/O/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash
/bracketright/circumflex/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q
/r/s/t/u/v/w/x/y/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase
/guillemotleft/guillemotright/bullet/florin/fraction/perthousand/dagger
/daggerdbl/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen/brokenbar
/section/dieresis/copyright/ordfeminine/guilsinglleft/logicalnot/minus
/registered/macron/degree/plusminus/twosuperior/threesuperior/acute/mu
/paragraph/periodcentered/cedilla/onesuperior/ordmasculine/guilsinglright
/onequarter/onehalf/threequarters/questiondown/Agrave/Aacute/Acircumflex/Atilde
/Adieresis/Aring/AE/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute
/Icircumflex/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn/germandbls
/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla/egrave/eacute
/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis/eth/ntilde/ograve
/oacute/ocircumflex/otilde/odieresis/divide/oslash/ugrave/uacute/ucircumflex
/udieresis/yacute/thorn/ydieresis]def/Courier-Bold@0 ENC0/Courier-Bold RE
/Courier-Oblique@0 ENC0/Courier-Oblique RE/Palatino-Bold@0 ENC0/Palatino-Bold
RE/Courier@0 ENC0/Courier RE/Palatino-Italic@0 ENC0/Palatino-Italic RE
/Palatino-Roman@0 ENC0/Palatino-Roman RE/Helvetica-Bold@0 ENC0/Helvetica-Bold
RE/AvantGarde-DemiOblique@0 ENC0/AvantGarde-DemiOblique RE
/AvantGarde-BookOblique@0 ENC0/AvantGarde-BookOblique RE
%%EndProlog
%%Page: 303 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 30/AvantGarde-BookOblique@0 SF(12)129.6 141.6 Q/F1 24
/AvantGarde-DemiOblique@0 SF(Shar)129.6 246.424 Q 6.72(ed Memor)-.096 F 13.44
(yI).96 G(ntr)342.144 246.424 Q(oduction)-.36 E/F2 12/Helvetica-Bold@0 SF 9.312
(12.1 Intr)93.6 357.6 R(oduction)-.24 E/F3 10/Palatino-Roman@0 SF(Shar)129.6
381.6 Q .757(ed memory is the fastest form of IPC available.)-.18 F .756
(Once the memory is mapped into)5.756 F 2.68(the addr)129.6 393.6 R 2.68
(ess space of the pr)-.18 F 2.681(ocesses that ar)-.18 F 5.181(es)-.18 G 2.681
(haring the memory r)343.435 393.6 R 2.681(egion, no kernel)-.18 F .551
(involvement occurs in passing data between the pr)129.6 405.6 R 3.051
(ocesses. What)-.18 F .551(is normally r)3.051 F(equir)-.18 E(ed,)-.18 E
(however)129.6 417.6 Q 3.76(,i)-.74 G 3.76(ss)176.83 417.6 S 1.26
(ome form of synchr)189.07 417.6 R 1.26(onization between the pr)-.18 F 1.26
(ocesses that ar)-.18 F 3.76(es)-.18 G 1.26(toring and)471.95 417.6 R 1.252
(fetching information to and fr)129.6 429.6 R 1.252(om the shar)-.18 F 1.252
(ed memory r)-.18 F 3.751(egion. In)-.18 F 1.251(Part 3, we discussed)3.751 F
.025(various forms of synchr)129.6 441.6 R .026
(onization: mutexes, condition variables, r)-.18 F .026(ead\211write locks, r)
-.18 F(ecor)-.18 E(d)-.18 E(locks, and semaphor)129.6 453.6 Q(es.)-.18 E/F4 8
/Palatino-Roman@0 SF .45(What we mean by `)201.6 473.6 R .45
(`no kernel involvement')-.296 F 2.45('i)-.296 G 2.45(st)363.566 473.6 S .45
(hat the pr)372.016 473.6 R .449(ocesses do not execute any sys-)-.144 F .431
(tem calls into the kernel to pass the data.)201.6 483.6 R(Obviously)4.432 E
2.432(,t)-.888 G .432(he kernel must establish the mem-)396.128 483.6 R 2.152
(ory mappings that allow the pr)201.6 493.6 R 2.152(ocesses to shar)-.144 F
4.152(et)-.144 G 2.152(he memory)389.024 493.6 R 4.152(,a)-.888 G 2.152
(nd then manage this)440.864 493.6 R
(memory over time \(handle page faults, and the like\).)201.6 503.6 Q F3 1.084
(Consider the normal steps involved in the client\211server \214le copying pr)
147.6 521.6 R 1.084(ogram that)-.18 F
(we used as an example for the various types of message passing \(Figur)129.6
533.6 Q 2.5(e4)-.18 G(.1\).)454.63 533.6 Q 8.83<8354>147.6 557.6 S .859
(he server r)168.62 557.6 R .858(eads fr)-.18 F .858(om the input \214le.)-.18
F .858(The \214le data is r)5.858 F .858(ead by the kernel into its)-.18 F
(memory and then copied fr)162.49 569.6 Q(om the kernel to the pr)-.18 E
(ocess.)-.18 E 8.83<8354>147.6 585.6 S .571(he server writes this data in a me\
ssage, using a pipe, FIFO, or message queue.)168.62 585.6 R 1.015
(These forms of IPC normally r)162.49 597.6 R(equir)-.18 E 3.515(et)-.18 G
1.015(he data to be copied fr)335.81 597.6 R 1.015(om the pr)-.18 F 1.015
(ocess to)-.18 F(the kernel.)162.49 609.6 Q F4 2.408 -.736(We u)201.6 629.6 T
.936(se the quali\214er).736 F/F5 8/Palatino-Italic@0 SF(normally)2.936 E F4
.936(because Posix message queues can be implemented using)2.936 F .217
(memory-mapped I/O \(the)201.6 639.6 R/F6 8/Courier@0 SF(mmap)2.217 E F4 .216
(function that we describe in this chapter\), as we showed)2.217 F .399
(in Section 5.8 and as we show in the solution to Exer)201.6 649.6 R .4
(cise 12.2.)-.144 F .4(In Figur)4.4 F 2.4(e1)-.144 G .4(2.1, we assume)465.792
649.6 R/F7 9/Palatino-Bold@0 SF(303)506.1 676 Q EP
%%Page: 304 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(304)93.6 82 Q/F1 9/Palatino-Roman@0 SF(Shar)125.1 82 Q
2.25(ed Memory Intr)-.162 F 227.622(oduction Chapter)-.162 F(12)2.25 E .32 LW
97.6 89.2 93.6 89.2 DL 99.6 89.2 95.6 89.2 DL 103.6 89.2 99.6 89.2 DL 107.6
89.2 103.6 89.2 DL 111.6 89.2 107.6 89.2 DL 115.6 89.2 111.6 89.2 DL 119.6 89.2
115.6 89.2 DL 123.6 89.2 119.6 89.2 DL 127.6 89.2 123.6 89.2 DL 131.6 89.2
127.6 89.2 DL 135.6 89.2 131.6 89.2 DL 139.6 89.2 135.6 89.2 DL 143.6 89.2
139.6 89.2 DL 147.6 89.2 143.6 89.2 DL 151.6 89.2 147.6 89.2 DL 155.6 89.2
151.6 89.2 DL 159.6 89.2 155.6 89.2 DL 163.6 89.2 159.6 89.2 DL 167.6 89.2
163.6 89.2 DL 171.6 89.2 167.6 89.2 DL 175.6 89.2 171.6 89.2 DL 179.6 89.2
175.6 89.2 DL 183.6 89.2 179.6 89.2 DL 187.6 89.2 183.6 89.2 DL 191.6 89.2
187.6 89.2 DL 195.6 89.2 191.6 89.2 DL 199.6 89.2 195.6 89.2 DL 203.6 89.2
199.6 89.2 DL 207.6 89.2 203.6 89.2 DL 211.6 89.2 207.6 89.2 DL 215.6 89.2
211.6 89.2 DL 219.6 89.2 215.6 89.2 DL 223.6 89.2 219.6 89.2 DL 227.6 89.2
223.6 89.2 DL 231.6 89.2 227.6 89.2 DL 235.6 89.2 231.6 89.2 DL 239.6 89.2
235.6 89.2 DL 243.6 89.2 239.6 89.2 DL 247.6 89.2 243.6 89.2 DL 251.6 89.2
247.6 89.2 DL 255.6 89.2 251.6 89.2 DL 259.6 89.2 255.6 89.2 DL 263.6 89.2
259.6 89.2 DL 267.6 89.2 263.6 89.2 DL 271.6 89.2 267.6 89.2 DL 275.6 89.2
271.6 89.2 DL 279.6 89.2 275.6 89.2 DL 283.6 89.2 279.6 89.2 DL 287.6 89.2
283.6 89.2 DL 291.6 89.2 287.6 89.2 DL 295.6 89.2 291.6 89.2 DL 299.6 89.2
295.6 89.2 DL 303.6 89.2 299.6 89.2 DL 307.6 89.2 303.6 89.2 DL 311.6 89.2
307.6 89.2 DL 315.6 89.2 311.6 89.2 DL 319.6 89.2 315.6 89.2 DL 323.6 89.2
319.6 89.2 DL 327.6 89.2 323.6 89.2 DL 331.6 89.2 327.6 89.2 DL 335.6 89.2
331.6 89.2 DL 339.6 89.2 335.6 89.2 DL 343.6 89.2 339.6 89.2 DL 347.6 89.2
343.6 89.2 DL 351.6 89.2 347.6 89.2 DL 355.6 89.2 351.6 89.2 DL 359.6 89.2
355.6 89.2 DL 363.6 89.2 359.6 89.2 DL 367.6 89.2 363.6 89.2 DL 371.6 89.2
367.6 89.2 DL 375.6 89.2 371.6 89.2 DL 379.6 89.2 375.6 89.2 DL 383.6 89.2
379.6 89.2 DL 387.6 89.2 383.6 89.2 DL 391.6 89.2 387.6 89.2 DL 395.6 89.2
391.6 89.2 DL 399.6 89.2 395.6 89.2 DL 403.6 89.2 399.6 89.2 DL 407.6 89.2
403.6 89.2 DL 411.6 89.2 407.6 89.2 DL 415.6 89.2 411.6 89.2 DL 419.6 89.2
415.6 89.2 DL 423.6 89.2 419.6 89.2 DL 427.6 89.2 423.6 89.2 DL 431.6 89.2
427.6 89.2 DL 435.6 89.2 431.6 89.2 DL 439.6 89.2 435.6 89.2 DL 443.6 89.2
439.6 89.2 DL 447.6 89.2 443.6 89.2 DL 451.6 89.2 447.6 89.2 DL 455.6 89.2
451.6 89.2 DL 459.6 89.2 455.6 89.2 DL 463.6 89.2 459.6 89.2 DL 467.6 89.2
463.6 89.2 DL 471.6 89.2 467.6 89.2 DL 475.6 89.2 471.6 89.2 DL 479.6 89.2
475.6 89.2 DL 483.6 89.2 479.6 89.2 DL 487.6 89.2 483.6 89.2 DL 491.6 89.2
487.6 89.2 DL 495.6 89.2 491.6 89.2 DL 499.6 89.2 495.6 89.2 DL 503.6 89.2
499.6 89.2 DL 507.6 89.2 503.6 89.2 DL 511.6 89.2 507.6 89.2 DL 515.6 89.2
511.6 89.2 DL 519.6 89.2 515.6 89.2 DL/F2 8/Palatino-Roman@0 SF .363
(that Posix message queues ar)201.6 121 R 2.363(ei)-.144 G .362
(mplemented within the kernel, which is another possibil-)314.655 121 R(ity)
201.6 131 Q 4.008(.B)-.888 G .008
(ut pipes, FIFOs, and System V message queues all involve copying the data fr)
220.992 131 R .008(om the)-.144 F(pr)201.6 141 Q .561
(ocess to the kernel for a)-.144 F/F3 8/Courier@0 SF(write)2.561 E F2(or)2.561
E F3(msgsnd)2.561 E F2 2.56(,o)C 2.56(rc)372.224 141 S .56(opying the data fr)
381.496 141 R .56(om the kernel to the)-.144 F(pr)201.6 151 Q(ocess for a)-.144
E F3(read)2 E F2(or)2 E F3(msgrcv)2 E F2(.)A/F4 10/Palatino-Roman@0 SF 8.83
<8354>147.6 167 S .083(he client r)168.62 167 R .083(eads the data fr)-.18 F
.084(om the IPC channel, normally r)-.18 F .084(equiring the data to be)-.18 F
(copied fr)162.49 179 Q(om the kernel to the pr)-.18 E(ocess.)-.18 E 8.83<8346>
147.6 195 S(inally)168.05 195 Q 3.817(,t)-1.11 G 1.316(he data is copied fr)
201.627 195 R 1.316(om the client's buf)-.18 F(fer)-.18 E 3.816(,t)-.74 G 1.316
(he second ar)397.216 195 R 1.316(gument to the)-.18 F/F5 10/Courier@0 SF
(write)162.49 207 Q F4(function, to the output \214le.)2.5 E 2.89(At)129.6 231
S .391(otal of four copies of the data ar)143.53 231 R 2.891(en)-.18 G .391
(ormally r)300.105 231 R(equir)-.18 E 2.891(ed. Additionally)-.18 F 2.891(,t)
-1.11 G .391(hese four copies)447.558 231 R(ar)129.6 243 Q 3.725(ed)-.18 G
1.225(one between the kernel and a pr)152.995 243 R 1.224
(ocess, often an expensive copy \(mor)-.18 F 3.724(ee)-.18 G(xpensive)480.23
243 Q 1.981
(than copying data within the kernel, or copying data within a single pr)129.6
255 R 4.481(ocess\). Fig-)-.18 F(ur)129.6 267 Q 3.535(e1)-.18 G 1.035
(2.1 depicts this movement of the data between the client and server)152.725
267 R 3.535(,t)-.74 G(hr)469.735 267 Q 1.035(ough the)-.18 F(kernel.)129.6 279
Q 180.6 413.8 MT 0 -28.8 RL -28.8 0 RL 0 28.8 RL CL ST F2(output)154.18 396.16
Q(\214le)160.7 406.16 Q 331.8 413.8 MT 0 -28.8 RL -64.8 0 RL 0 28.8 RL CL ST
(IPC)292.8 391.16 Q(\(pipe, FIFO, or)273.476 401.16 Q(message queue\))271.192
411.16 Q 447 413.8 MT 0 -28.8 RL -28.8 0 RL 0 28.8 RL CL ST(input)422.988
396.16 Q(\214le)427.1 406.16 Q 195 327.4 MT 0 -28.8 RL -43.2 0 RL 0 28.8 RL CL
ST(client)163.748 314.76 Q 447 327.4 MT 0 -28.8 RL -43.2 0 RL 0 28.8 RL CL ST
(server)414.452 314.76 Q 141 356.2 137.4 356.2 DL 148.128 356.2 144.528 356.2
DL 155.256 356.2 151.656 356.2 DL 162.384 356.2 158.784 356.2 DL 169.512 356.2
165.912 356.2 DL 176.64 356.2 173.04 356.2 DL 183.768 356.2 180.168 356.2 DL
190.896 356.2 187.296 356.2 DL 198.024 356.2 194.424 356.2 DL 205.152 356.2
201.552 356.2 DL 212.28 356.2 208.68 356.2 DL 219.408 356.2 215.808 356.2 DL
226.536 356.2 222.936 356.2 DL 233.736 356.2 230.136 356.2 DL 240.864 356.2
237.264 356.2 DL 247.992 356.2 244.392 356.2 DL 255.12 356.2 251.52 356.2 DL
262.248 356.2 258.648 356.2 DL 269.376 356.2 265.776 356.2 DL 276.504 356.2
272.904 356.2 DL 283.632 356.2 280.032 356.2 DL 290.76 356.2 287.16 356.2 DL
297.888 356.2 294.288 356.2 DL 305.016 356.2 301.416 356.2 DL 312.144 356.2
308.544 356.2 DL 319.272 356.2 315.672 356.2 DL 326.4 356.2 322.8 356.2 DL
333.528 356.2 329.928 356.2 DL 340.656 356.2 337.056 356.2 DL 347.784 356.2
344.184 356.2 DL 354.912 356.2 351.312 356.2 DL 362.04 356.2 358.44 356.2 DL
369.168 356.2 365.568 356.2 DL 376.296 356.2 372.696 356.2 DL 383.424 356.2
379.824 356.2 DL 390.552 356.2 386.952 356.2 DL 397.68 356.2 394.08 356.2 DL
404.808 356.2 401.208 356.2 DL 411.936 356.2 408.336 356.2 DL 419.136 356.2
415.536 356.2 DL 426.264 356.2 422.664 356.2 DL 433.392 356.2 429.792 356.2 DL
440.52 356.2 436.92 356.2 DL 447.648 356.2 444.048 356.2 DL 454.776 356.2
451.176 356.2 DL 461.904 356.2 458.304 356.2 DL 469.032 356.2 465.432 356.2 DL
476.16 356.2 472.56 356.2 DL 483.288 356.2 479.688 356.2 DL 490.416 356.2
486.816 356.2 DL 497.544 356.2 493.944 356.2 DL 504.672 356.2 501.072 356.2 DL
511.8 356.2 508.2 356.2 DL(pr)485.44 352.96 Q(ocess)-.144 E(kernel)489.544
362.96 Q 432.6 327.4 432.6 385 DL 432.6 327.4 MT 2.232 6.768 RL -4.464 0 RL CL
BL 432.6 327.4 MT 2.232 6.768 RL -4.464 0 RL CL ST 418.2 327.4 310.2 385 DL
310.2 385 MT 4.896 -5.184 RL 2.088 3.96 RL CL BL 310.2 385 MT 4.896 -5.184 RL
2.088 3.96 RL CL ST 288.6 385 180.6 327.4 DL 180.6 327.4 MT 6.984 1.224 RL
-2.088 3.96 RL CL BL 180.6 327.4 MT 6.984 1.224 RL -2.088 3.96 RL CL ST 166.2
385 166.2 327.4 DL 166.2 385 MT -2.232 -6.768 RL 4.464 0 RL CL BL 166.2 385 MT
-2.232 -6.768 RL 4.464 0 RL CL ST F3(read\(\))436.6 334.16 Q(write\(\))321
334.16 Q F2(,)A F3(mq_send\(\))2 E F2(,)A(or)330.672 342.8 Q F3(msgsnd\(\))2 E
(write\(\))130.6 334.16 Q(read\(\))195 334.16 Q F2(,)A F3(mq_receive\(\))2 E F2
(,)A(or)220.2 342.8 Q F3(msgrcv\(\))2 E/F6 8/Palatino-Bold@0 SF(Figure 12.1)
235.504 431.8 Q F2(Flow of \214le data fr)6 E(om server to client.)-.144 E F4
.627(The pr)147.6 455.8 R .627(oblem with these forms of IPC)-.18 F .833<8a70>
.833 G .627(ipes, FIFOs, and message queues)-.833 F .833<8a69>.833 G 3.128(st)
-.833 G(hat)505.52 455.8 Q .917(for two pr)129.6 467.8 R .916
(ocesses to exchange information, the information has to go thr)-.18 F .916
(ough the ker)-.18 F(-)-.18 E(nel.)129.6 479.8 Q(Shar)147.6 491.8 Q .427
(ed memory pr)-.18 F .427(ovides a way ar)-.18 F .428
(ound this by letting two or mor)-.18 F 2.928(ep)-.18 G -.18(ro)457.082 491.8 S
.428(cesses shar).18 F(e)-.18 E 2.503(ar)129.6 503.8 S .003(egion of memory)
140.873 503.8 R 5.002(.T)-1.11 G .002(he pr)229.15 503.8 R .002
(ocesses must, of course, coor)-.18 F .002(dinate or synchr)-.18 F .002
(onize the use of)-.18 F .455(the shar)129.6 515.8 R .455
(ed memory among themselves.)-.18 F .455
(\(Sharing a common piece of memory is similar)5.455 F .262(to sharing a disk \
\214le, such as the sequence number \214le used in all the \214le locking exam\
-)129.6 527.8 R 2.5(ples.\) Any)129.6 539.8 R
(of the techniques described in Part 3 can be used for this synchr)2.5 E
(onization.)-.18 E(The steps for the client\211server example ar)147.6 551.8 Q
2.5(en)-.18 G(ow as follows:)344.36 551.8 Q 8.83<8354>147.6 575.8 S
(he server gets access to a shar)168.62 575.8 Q
(ed memory object using \(say\) a semaphor)-.18 E(e.)-.18 E 8.83<8354>147.6
591.8 S .512(he server r)168.62 591.8 R .512(eads fr)-.18 F .512
(om the input \214le into the shar)-.18 F .513(ed memory object.)-.18 F .513
(The second)5.513 F(ar)162.49 603.8 Q 1.924(gument to the)-.18 F F5(read)4.424
E F4 4.424(,t)C 1.924(he addr)275.596 603.8 R 1.924(ess of the data buf)-.18 F
(fer)-.18 E 4.424(,p)-.74 G 1.923(oints into the shar)423.59 603.8 R(ed)-.18 E
(memory object.)162.49 615.8 Q 8.83<8357>147.6 631.8 S(hen the r)172.49 631.8 Q
(ead is complete, the server noti\214es the client, using a semaphor)-.18 E(e.)
-.18 E 8.83<8354>147.6 647.8 S(he client writes the data fr)168.62 647.8 Q
(om the shar)-.18 E(ed memory object to the output \214le.)-.18 E EP
%%Page: 305 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF(Section 12.1)93.6 82 Q(Intr)437.961 82 Q(oduction)
-.162 E/F1 9/Palatino-Bold@0 SF(305)506.1 82 Q .32 LW 97.6 89.2 93.6 89.2 DL
99.6 89.2 95.6 89.2 DL 103.6 89.2 99.6 89.2 DL 107.6 89.2 103.6 89.2 DL 111.6
89.2 107.6 89.2 DL 115.6 89.2 111.6 89.2 DL 119.6 89.2 115.6 89.2 DL 123.6 89.2
119.6 89.2 DL 127.6 89.2 123.6 89.2 DL 131.6 89.2 127.6 89.2 DL 135.6 89.2
131.6 89.2 DL 139.6 89.2 135.6 89.2 DL 143.6 89.2 139.6 89.2 DL 147.6 89.2
143.6 89.2 DL 151.6 89.2 147.6 89.2 DL 155.6 89.2 151.6 89.2 DL 159.6 89.2
155.6 89.2 DL 163.6 89.2 159.6 89.2 DL 167.6 89.2 163.6 89.2 DL 171.6 89.2
167.6 89.2 DL 175.6 89.2 171.6 89.2 DL 179.6 89.2 175.6 89.2 DL 183.6 89.2
179.6 89.2 DL 187.6 89.2 183.6 89.2 DL 191.6 89.2 187.6 89.2 DL 195.6 89.2
191.6 89.2 DL 199.6 89.2 195.6 89.2 DL 203.6 89.2 199.6 89.2 DL 207.6 89.2
203.6 89.2 DL 211.6 89.2 207.6 89.2 DL 215.6 89.2 211.6 89.2 DL 219.6 89.2
215.6 89.2 DL 223.6 89.2 219.6 89.2 DL 227.6 89.2 223.6 89.2 DL 231.6 89.2
227.6 89.2 DL 235.6 89.2 231.6 89.2 DL 239.6 89.2 235.6 89.2 DL 243.6 89.2
239.6 89.2 DL 247.6 89.2 243.6 89.2 DL 251.6 89.2 247.6 89.2 DL 255.6 89.2
251.6 89.2 DL 259.6 89.2 255.6 89.2 DL 263.6 89.2 259.6 89.2 DL 267.6 89.2
263.6 89.2 DL 271.6 89.2 267.6 89.2 DL 275.6 89.2 271.6 89.2 DL 279.6 89.2
275.6 89.2 DL 283.6 89.2 279.6 89.2 DL 287.6 89.2 283.6 89.2 DL 291.6 89.2
287.6 89.2 DL 295.6 89.2 291.6 89.2 DL 299.6 89.2 295.6 89.2 DL 303.6 89.2
299.6 89.2 DL 307.6 89.2 303.6 89.2 DL 311.6 89.2 307.6 89.2 DL 315.6 89.2
311.6 89.2 DL 319.6 89.2 315.6 89.2 DL 323.6 89.2 319.6 89.2 DL 327.6 89.2
323.6 89.2 DL 331.6 89.2 327.6 89.2 DL 335.6 89.2 331.6 89.2 DL 339.6 89.2
335.6 89.2 DL 343.6 89.2 339.6 89.2 DL 347.6 89.2 343.6 89.2 DL 351.6 89.2
347.6 89.2 DL 355.6 89.2 351.6 89.2 DL 359.6 89.2 355.6 89.2 DL 363.6 89.2
359.6 89.2 DL 367.6 89.2 363.6 89.2 DL 371.6 89.2 367.6 89.2 DL 375.6 89.2
371.6 89.2 DL 379.6 89.2 375.6 89.2 DL 383.6 89.2 379.6 89.2 DL 387.6 89.2
383.6 89.2 DL 391.6 89.2 387.6 89.2 DL 395.6 89.2 391.6 89.2 DL 399.6 89.2
395.6 89.2 DL 403.6 89.2 399.6 89.2 DL 407.6 89.2 403.6 89.2 DL 411.6 89.2
407.6 89.2 DL 415.6 89.2 411.6 89.2 DL 419.6 89.2 415.6 89.2 DL 423.6 89.2
419.6 89.2 DL 427.6 89.2 423.6 89.2 DL 431.6 89.2 427.6 89.2 DL 435.6 89.2
431.6 89.2 DL 439.6 89.2 435.6 89.2 DL 443.6 89.2 439.6 89.2 DL 447.6 89.2
443.6 89.2 DL 451.6 89.2 447.6 89.2 DL 455.6 89.2 451.6 89.2 DL 459.6 89.2
455.6 89.2 DL 463.6 89.2 459.6 89.2 DL 467.6 89.2 463.6 89.2 DL 471.6 89.2
467.6 89.2 DL 475.6 89.2 471.6 89.2 DL 479.6 89.2 475.6 89.2 DL 483.6 89.2
479.6 89.2 DL 487.6 89.2 483.6 89.2 DL 491.6 89.2 487.6 89.2 DL 495.6 89.2
491.6 89.2 DL 499.6 89.2 495.6 89.2 DL 503.6 89.2 499.6 89.2 DL 507.6 89.2
503.6 89.2 DL 511.6 89.2 507.6 89.2 DL 515.6 89.2 511.6 89.2 DL 519.6 89.2
515.6 89.2 DL/F2 10/Palatino-Roman@0 SF(This scenario is depicted in Figur)
129.6 123 Q 2.5(e1)-.18 G(2.2.)288.23 123 Q 180.6 269.8 MT 0 -28.8 RL -28.8 0
RL 0 28.8 RL CL ST/F3 8/Palatino-Roman@0 SF(output)154.18 252.16 Q(\214le)160.7
262.16 Q 447 269.8 MT 0 -28.8 RL -28.8 0 RL 0 28.8 RL CL ST(input)422.988
252.16 Q(\214le)427.1 262.16 Q 195 183.4 MT 0 -28.8 RL -43.2 0 RL 0 28.8 RL CL
ST(client)163.748 170.76 Q 447 183.4 MT 0 -28.8 RL -43.2 0 RL 0 28.8 RL CL ST
(server)414.452 170.76 Q 331.8 183.4 MT 0 -28.8 RL -64.8 0 RL 0 28.8 RL CL ST
(shar)271.54 170.76 Q(ed memory)-.144 E 141 219.4 137.4 219.4 DL 148.128 219.4
144.528 219.4 DL 155.256 219.4 151.656 219.4 DL 162.384 219.4 158.784 219.4 DL
169.512 219.4 165.912 219.4 DL 176.64 219.4 173.04 219.4 DL 183.768 219.4
180.168 219.4 DL 190.896 219.4 187.296 219.4 DL 198.024 219.4 194.424 219.4 DL
205.152 219.4 201.552 219.4 DL 212.28 219.4 208.68 219.4 DL 219.408 219.4
215.808 219.4 DL 226.536 219.4 222.936 219.4 DL 233.736 219.4 230.136 219.4 DL
240.864 219.4 237.264 219.4 DL 247.992 219.4 244.392 219.4 DL 255.12 219.4
251.52 219.4 DL 262.248 219.4 258.648 219.4 DL 269.376 219.4 265.776 219.4 DL
276.504 219.4 272.904 219.4 DL 283.632 219.4 280.032 219.4 DL 290.76 219.4
287.16 219.4 DL 297.888 219.4 294.288 219.4 DL 305.016 219.4 301.416 219.4 DL
312.144 219.4 308.544 219.4 DL 319.272 219.4 315.672 219.4 DL 326.4 219.4 322.8
219.4 DL 333.528 219.4 329.928 219.4 DL 340.656 219.4 337.056 219.4 DL 347.784
219.4 344.184 219.4 DL 354.912 219.4 351.312 219.4 DL 362.04 219.4 358.44 219.4
DL 369.168 219.4 365.568 219.4 DL 376.296 219.4 372.696 219.4 DL 383.424 219.4
379.824 219.4 DL 390.552 219.4 386.952 219.4 DL 397.68 219.4 394.08 219.4 DL
404.808 219.4 401.208 219.4 DL 411.936 219.4 408.336 219.4 DL 419.136 219.4
415.536 219.4 DL 426.264 219.4 422.664 219.4 DL 433.392 219.4 429.792 219.4 DL
440.52 219.4 436.92 219.4 DL 447.648 219.4 444.048 219.4 DL 454.776 219.4
451.176 219.4 DL 461.904 219.4 458.304 219.4 DL 469.032 219.4 465.432 219.4 DL
476.16 219.4 472.56 219.4 DL 483.288 219.4 479.688 219.4 DL 490.416 219.4
486.816 219.4 DL 497.544 219.4 493.944 219.4 DL 504.672 219.4 501.072 219.4 DL
511.8 219.4 508.2 219.4 DL(pr)485.44 216.16 Q(ocess)-.144 E(kernel)489.544
226.16 Q 432.6 241 310.2 183.4 DL 310.2 183.4 MT 7.272 1.44 RL -1.512 3.24 RL
CL BL 310.2 183.4 MT 7.272 1.44 RL -1.512 3.24 RL CL ST 288.6 183.4 166.2 241
DL 166.2 241 MT 5.76 -4.68 RL 1.512 3.24 RL CL BL 166.2 241 MT 5.76 -4.68 RL
1.512 3.24 RL CL ST 137.4 194.2 137.4 197.8 DL 137.4 186.496 137.4 190.096 DL
137.4 178.792 137.4 182.392 DL 137.4 171.088 137.4 174.688 DL 137.4 163.312
137.4 166.912 DL 137.4 155.608 137.4 159.208 DL 137.4 147.904 137.4 151.504 DL
137.4 140.2 137.4 143.8 DL 141 140.2 137.4 140.2 DL 148.056 140.2 144.456 140.2
DL 155.184 140.2 151.584 140.2 DL 162.24 140.2 158.64 140.2 DL 169.296 140.2
165.696 140.2 DL 176.352 140.2 172.752 140.2 DL 183.48 140.2 179.88 140.2 DL
190.536 140.2 186.936 140.2 DL 197.592 140.2 193.992 140.2 DL 204.648 140.2
201.048 140.2 DL 211.776 140.2 208.176 140.2 DL 218.832 140.2 215.232 140.2 DL
225.888 140.2 222.288 140.2 DL 233.016 140.2 229.416 140.2 DL 240.072 140.2
236.472 140.2 DL 247.128 140.2 243.528 140.2 DL 254.184 140.2 250.584 140.2 DL
261.312 140.2 257.712 140.2 DL 268.368 140.2 264.768 140.2 DL 275.424 140.2
271.824 140.2 DL 282.552 140.2 278.952 140.2 DL 289.608 140.2 286.008 140.2 DL
296.664 140.2 293.064 140.2 DL 303.72 140.2 300.12 140.2 DL 310.848 140.2
307.248 140.2 DL 317.904 140.2 314.304 140.2 DL 324.96 140.2 321.36 140.2 DL
332.016 140.2 328.416 140.2 DL 339.144 140.2 335.544 140.2 DL 346.2 140.2 342.6
140.2 DL 346.2 143.8 346.2 140.2 DL 346.2 151.504 346.2 147.904 DL 346.2
159.208 346.2 155.608 DL 346.2 166.912 346.2 163.312 DL 346.2 174.688 346.2
171.088 DL 346.2 182.392 346.2 178.792 DL 346.2 190.096 346.2 186.496 DL 346.2
197.8 346.2 194.2 DL 342.6 197.8 346.2 197.8 DL 335.544 197.8 339.144 197.8 DL
328.416 197.8 332.016 197.8 DL 321.36 197.8 324.96 197.8 DL 314.304 197.8
317.904 197.8 DL 307.248 197.8 310.848 197.8 DL 300.12 197.8 303.72 197.8 DL
293.064 197.8 296.664 197.8 DL 286.008 197.8 289.608 197.8 DL 278.952 197.8
282.552 197.8 DL 271.824 197.8 275.424 197.8 DL 264.768 197.8 268.368 197.8 DL
257.712 197.8 261.312 197.8 DL 250.584 197.8 254.184 197.8 DL 243.528 197.8
247.128 197.8 DL 236.472 197.8 240.072 197.8 DL 229.416 197.8 233.016 197.8 DL
222.288 197.8 225.888 197.8 DL 215.232 197.8 218.832 197.8 DL 208.176 197.8
211.776 197.8 DL 201.048 197.8 204.648 197.8 DL 193.992 197.8 197.592 197.8 DL
186.936 197.8 190.536 197.8 DL 179.88 197.8 183.48 197.8 DL 172.752 197.8
176.352 197.8 DL 165.696 197.8 169.296 197.8 DL 158.64 197.8 162.24 197.8 DL
151.584 197.8 155.184 197.8 DL 144.456 197.8 148.056 197.8 DL 137.4 197.8 141
197.8 DL(client addr)139.4 194.56 Q(ess space)-.144 E 252.6 190.6 252.6 205 DL
252.6 161.8 252.6 176.2 DL 252.6 133 252.6 147.4 DL 267 133 252.6 133 DL
294.792 133 280.392 133 DL 322.512 133 308.112 133 DL 350.304 133 335.904 133
DL 378.096 133 363.696 133 DL 405.888 133 391.488 133 DL 433.608 133 419.208
133 DL 461.4 133 447 133 DL 461.4 147.4 461.4 133 DL 461.4 176.2 461.4 161.8 DL
461.4 205 461.4 190.6 DL 447 205 461.4 205 DL 419.208 205 433.608 205 DL
391.488 205 405.888 205 DL 363.696 205 378.096 205 DL 335.904 205 350.304 205
DL 308.112 205 322.512 205 DL 280.392 205 294.792 205 DL 252.6 205 267 205 DL
(server addr)386.512 201.76 Q(ess space)-.144 E/F4 8/Palatino-Bold@0 SF
(Figure 12.2)194.324 287.8 Q F3(Copying \214le data fr)6 E
(om server to client using shar)-.144 E(ed memory)-.144 E(.)-.888 E F2 .069
(In this \214gur)129.6 311.8 R 2.569(et)-.18 G .069
(he data is copied only twice)192.187 311.8 R .833<8a66>.833 G -.18(ro)-.833 G
2.57(mt).18 G .07(he input \214le into shar)354.26 311.8 R .07(ed memory and)
-.18 F(fr)129.6 323.8 Q .969(om shar)-.18 F .969
(ed memory to the output \214le.)-.18 F 2.809 -.92(We d)5.969 H .968
(raw one dashed box enclosing the client).92 F 1.383(and the shar)129.6 335.8 R
1.384(ed memory object, and another dashed box enclosing the server and the)
-.18 F(shar)129.6 347.8 Q 2.913(ed memory object, to r)-.18 F(einfor)-.18 E
2.913(ce that the shar)-.18 F 2.912(ed memory object appears in the)-.18 F
(addr)129.6 359.8 Q(ess space of both the client and the server)-.18 E(.)-.74 E
.452(The concepts involved in using shar)147.6 371.8 R .452(ed memory ar)-.18 F
2.952(es)-.18 G .453(imilar for both the Posix inter)383.956 371.8 R(-)-.18 E
.44(face and the System V interface.)129.6 383.8 R 2.28 -.92(We d)5.44 H .44
(escribe the former in Chapter 13 and the latter in).92 F(Chapter 14.)129.6
395.8 Q 2.732(In this chapter)147.6 419.8 R 5.232(,w)-.74 G 5.232(er)232.086
419.8 S 2.732(eturn to our sequence-number)245.878 419.8 R(-incr)-.18 E 2.732
(ement example that we)-.18 F .31(started in Chapter 9.)129.6 431.8 R .31
(But we now stor)5.31 F 2.809(et)-.18 G .309
(he sequence number in memory instead of in a)310.268 431.8 R(\214le.)129.6
443.8 Q 2.663 -.92(We \214)147.6 455.8 T .823(rst r).92 F .823
(eiterate that memory is)-.18 F/F5 10/Palatino-Italic@0 SF(not)3.323 E F2(shar)
3.324 E .824(ed by default between a par)-.18 F .824(ent and child)-.18 F(acr)
129.6 467.8 Q 1.104(oss a)-.18 F/F6 10/Courier@0 SF(fork)3.604 E F2 6.104(.T)C
1.104(he pr)207.692 467.8 R 1.104(ogram in Figur)-.18 F 3.603(e1)-.18 G 1.103
(2.3 has a par)313.646 467.8 R 1.103(ent and child incr)-.18 F 1.103
(ement a global)-.18 F(integer named)129.6 479.8 Q F6(count)2.5 E F2(.)A/F7 9
/Helvetica-Bold@0 SF(Create and initializ)129.6 495.8 Q 2.502(es).09 G
(emaphore)221.724 495.8 Q/F8 7/Courier-Oblique@0 SF(12\21114)104.28 510.8 Q F2
2.826 -.92(We c)147.6 510.8 T -.18(re).92 G .986(ate and initialize a semaphor)
.18 F 3.486(et)-.18 G .986(hat pr)320.756 510.8 R .987
(otects what we think is a shar)-.18 F .987(ed vari-)-.18 F 1.819
(able \(the global)129.6 522.8 R F6(count)4.319 E F2 4.319(\). Since)B 1.818
(this assumption is false, this semaphor)4.319 F 4.318(ei)-.18 G 4.318(sn)
467.244 522.8 S 1.818(ot r)481.622 522.8 R(eally)-.18 E 5.485(needed. Notice)
129.6 534.8 R 2.985(that we r)5.485 F 2.985(emove the semaphor)-.18 F 5.485(en)
-.18 G 2.985(ame fr)366.735 534.8 R 2.985(om the system by calling)-.18 F F6
(sem_unlink)129.6 546.8 Q F2 6.395(,b)C 3.895(ut although this r)204.025 546.8
R 3.895(emoves the pathname, it has no ef)-.18 F 3.895(fect on the)-.18 F
(semaphor)129.6 558.8 Q 3.177(et)-.18 G .677(hat is alr)184.747 558.8 R .677
(eady open.)-.18 F 2.517 -.92(We d)5.677 H 3.177(ot).92 G .677
(his so that the pathname is r)313.959 558.8 R .678(emoved fr)-.18 F .678
(om the)-.18 F(\214lesystem even if the pr)129.6 570.8 Q(ogram aborts.)-.18 E
F7(Set standar)129.6 586.8 Q 2.502(do)-.18 G(utput unb)191.934 586.8 Q(uff)-.18
E(ered and)-.09 E/F9 9/Courier-Bold@0 SF(fork)2.502 E F8(15)104.28 601.8 Q F2
2.527 -.92(We s)147.6 601.8 T .687(et standar).92 F 3.186(do)-.18 G .686
(utput unbuf)228.09 601.8 R(fer)-.18 E .686(ed because both the par)-.18 F .686
(ent and child will be writ-)-.18 F(ing to it.)129.6 613.8 Q(This pr)5 E
(events interleaving of the output fr)-.18 E(om the two pr)-.18 E(ocesses.)-.18
E F8(16\21129)104.28 625.8 Q F2 .769(The par)147.6 625.8 R .769
(ent and child each execute a loop that incr)-.18 F .77
(ements the counter the speci\214ed)-.18 F 1.18(number of times, being car)
129.6 637.8 R 1.18(eful to incr)-.18 F 1.18
(ement the variable only when the semaphor)-.18 F 3.68(ei)-.18 G(s)515.36 637.8
Q(held.)129.6 649.8 Q EP
%%Page: 306 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(306)93.6 82 Q/F1 9/Palatino-Roman@0 SF(Shar)125.1 82 Q
2.25(ed Memory Intr)-.162 F 227.622(oduction Chapter)-.162 F(12)2.25 E .32 LW
97.6 89.2 93.6 89.2 DL 99.6 89.2 95.6 89.2 DL 103.6 89.2 99.6 89.2 DL 107.6
89.2 103.6 89.2 DL 111.6 89.2 107.6 89.2 DL 115.6 89.2 111.6 89.2 DL 119.6 89.2
115.6 89.2 DL 123.6 89.2 119.6 89.2 DL 127.6 89.2 123.6 89.2 DL 131.6 89.2
127.6 89.2 DL 135.6 89.2 131.6 89.2 DL 139.6 89.2 135.6 89.2 DL 143.6 89.2
139.6 89.2 DL 147.6 89.2 143.6 89.2 DL 151.6 89.2 147.6 89.2 DL 155.6 89.2
151.6 89.2 DL 159.6 89.2 155.6 89.2 DL 163.6 89.2 159.6 89.2 DL 167.6 89.2
163.6 89.2 DL 171.6 89.2 167.6 89.2 DL 175.6 89.2 171.6 89.2 DL 179.6 89.2
175.6 89.2 DL 183.6 89.2 179.6 89.2 DL 187.6 89.2 183.6 89.2 DL 191.6 89.2
187.6 89.2 DL 195.6 89.2 191.6 89.2 DL 199.6 89.2 195.6 89.2 DL 203.6 89.2
199.6 89.2 DL 207.6 89.2 203.6 89.2 DL 211.6 89.2 207.6 89.2 DL 215.6 89.2
211.6 89.2 DL 219.6 89.2 215.6 89.2 DL 223.6 89.2 219.6 89.2 DL 227.6 89.2
223.6 89.2 DL 231.6 89.2 227.6 89.2 DL 235.6 89.2 231.6 89.2 DL 239.6 89.2
235.6 89.2 DL 243.6 89.2 239.6 89.2 DL 247.6 89.2 243.6 89.2 DL 251.6 89.2
247.6 89.2 DL 255.6 89.2 251.6 89.2 DL 259.6 89.2 255.6 89.2 DL 263.6 89.2
259.6 89.2 DL 267.6 89.2 263.6 89.2 DL 271.6 89.2 267.6 89.2 DL 275.6 89.2
271.6 89.2 DL 279.6 89.2 275.6 89.2 DL 283.6 89.2 279.6 89.2 DL 287.6 89.2
283.6 89.2 DL 291.6 89.2 287.6 89.2 DL 295.6 89.2 291.6 89.2 DL 299.6 89.2
295.6 89.2 DL 303.6 89.2 299.6 89.2 DL 307.6 89.2 303.6 89.2 DL 311.6 89.2
307.6 89.2 DL 315.6 89.2 311.6 89.2 DL 319.6 89.2 315.6 89.2 DL 323.6 89.2
319.6 89.2 DL 327.6 89.2 323.6 89.2 DL 331.6 89.2 327.6 89.2 DL 335.6 89.2
331.6 89.2 DL 339.6 89.2 335.6 89.2 DL 343.6 89.2 339.6 89.2 DL 347.6 89.2
343.6 89.2 DL 351.6 89.2 347.6 89.2 DL 355.6 89.2 351.6 89.2 DL 359.6 89.2
355.6 89.2 DL 363.6 89.2 359.6 89.2 DL 367.6 89.2 363.6 89.2 DL 371.6 89.2
367.6 89.2 DL 375.6 89.2 371.6 89.2 DL 379.6 89.2 375.6 89.2 DL 383.6 89.2
379.6 89.2 DL 387.6 89.2 383.6 89.2 DL 391.6 89.2 387.6 89.2 DL 395.6 89.2
391.6 89.2 DL 399.6 89.2 395.6 89.2 DL 403.6 89.2 399.6 89.2 DL 407.6 89.2
403.6 89.2 DL 411.6 89.2 407.6 89.2 DL 415.6 89.2 411.6 89.2 DL 419.6 89.2
415.6 89.2 DL 423.6 89.2 419.6 89.2 DL 427.6 89.2 423.6 89.2 DL 431.6 89.2
427.6 89.2 DL 435.6 89.2 431.6 89.2 DL 439.6 89.2 435.6 89.2 DL 443.6 89.2
439.6 89.2 DL 447.6 89.2 443.6 89.2 DL 451.6 89.2 447.6 89.2 DL 455.6 89.2
451.6 89.2 DL 459.6 89.2 455.6 89.2 DL 463.6 89.2 459.6 89.2 DL 467.6 89.2
463.6 89.2 DL 471.6 89.2 467.6 89.2 DL 475.6 89.2 471.6 89.2 DL 479.6 89.2
475.6 89.2 DL 483.6 89.2 479.6 89.2 DL 487.6 89.2 483.6 89.2 DL 491.6 89.2
487.6 89.2 DL 495.6 89.2 491.6 89.2 DL 499.6 89.2 495.6 89.2 DL 503.6 89.2
499.6 89.2 DL 507.6 89.2 503.6 89.2 DL 511.6 89.2 507.6 89.2 DL 515.6 89.2
511.6 89.2 DL 519.6 89.2 515.6 89.2 DL .4 LW 134.6 123 129.6 123 DL 138.1 123
133.1 123 DL 143.1 123 138.1 123 DL 148.1 123 143.1 123 DL 153.1 123 148.1 123
DL 158.1 123 153.1 123 DL 163.1 123 158.1 123 DL 168.1 123 163.1 123 DL 173.1
123 168.1 123 DL 178.1 123 173.1 123 DL 183.1 123 178.1 123 DL 188.1 123 183.1
123 DL 193.1 123 188.1 123 DL 198.1 123 193.1 123 DL 203.1 123 198.1 123 DL
208.1 123 203.1 123 DL 213.1 123 208.1 123 DL 218.1 123 213.1 123 DL 223.1 123
218.1 123 DL 228.1 123 223.1 123 DL 233.1 123 228.1 123 DL 238.1 123 233.1 123
DL 243.1 123 238.1 123 DL 248.1 123 243.1 123 DL 253.1 123 248.1 123 DL 258.1
123 253.1 123 DL 263.1 123 258.1 123 DL 268.1 123 263.1 123 DL 273.1 123 268.1
123 DL 278.1 123 273.1 123 DL 283.1 123 278.1 123 DL 288.1 123 283.1 123 DL
293.1 123 288.1 123 DL 298.1 123 293.1 123 DL 303.1 123 298.1 123 DL 308.1 123
303.1 123 DL 313.1 123 308.1 123 DL 318.1 123 313.1 123 DL 323.1 123 318.1 123
DL 328.1 123 323.1 123 DL 333.1 123 328.1 123 DL 338.1 123 333.1 123 DL 343.1
123 338.1 123 DL 348.1 123 343.1 123 DL 353.1 123 348.1 123 DL 358.1 123 353.1
123 DL 363.1 123 358.1 123 DL 368.1 123 363.1 123 DL 373.1 123 368.1 123 DL
378.1 123 373.1 123 DL 383.1 123 378.1 123 DL 388.1 123 383.1 123 DL 393.1 123
388.1 123 DL 398.1 123 393.1 123 DL 403.1 123 398.1 123 DL 408.1 123 403.1 123
DL 413.1 123 408.1 123 DL 418.1 123 413.1 123 DL 423.1 123 418.1 123 DL 428.1
123 423.1 123 DL 433.1 123 428.1 123 DL 438.1 123 433.1 123 DL 443.1 123 438.1
123 DL 448.1 123 443.1 123 DL 453.1 123 448.1 123 DL 458.1 123 453.1 123 DL
463.1 123 458.1 123 DL 468.1 123 463.1 123 DL 473.1 123 468.1 123 DL/F2 9
/Palatino-Italic@0 SF -1.5(shm / incr1.c)475.35 125.5 R/F3 8.15/Courier@0 SF
4.89(1#)134.49 131.801 S 14.67(include "unpipc.h")149.16 131.801 R 4.89(2#)
134.49 148.801 S(define SEM_NAME)149.16 148.801 Q("mysem")242.07 148.801 Q 4.89
(3i)134.49 165.801 S 19.56(nt count)149.16 165.801 R 4.89(=0)4.89 G(;)227.4
165.801 Q 4.89(4i)134.49 182.801 S(nt)149.16 182.801 Q 4.89(5m)134.49 192.801 S
(ain\(int argc, char **argv\))149.16 192.801 Q 4.89(6{)134.49 202.801 S 24.45
(7i)134.49 212.801 S 19.56(nt i,)168.72 212.801 R(nloop;)4.89 E 24.45(8s)134.49
222.801 S 4.89(em_t *mutex;)168.72 222.801 R 24.45(9i)134.49 239.801 S 4.89
(f\()168.72 239.801 S(argc != 2\))183.39 239.801 Q 39.12(10 err_quit\("usage:)
129.6 249.801 R(incr1 <#loops>"\);)4.89 E 19.56(11 nloop)129.6 259.801 R 4.89
(=a)4.89 G(toi\(argv[1]\);)207.84 259.801 Q 39.12(12 /*)129.6 276.801 R
(create, initialize, and unlink semaphore */)4.89 E 19.56(13 mutex)129.6
286.801 R 4.89(=S)4.89 G
(em_open\(Px_ipc_name\(SEM_NAME\), O_CREAT | O_EXCL, FILE_MODE, 1\);)207.84
286.801 Q 19.56(14 Sem_unlink\(Px_ipc_name\(SEM_NAME\)\);)129.6 296.801 R 19.56
(15 setbuf\(stdout,)129.6 313.801 R 29.34(NULL\); /*)4.89 F
(stdout is unbuffered */)4.89 E 19.56(16 if)129.6 323.801 R
(\(Fork\(\) == 0\) {)4.89 E(/* child */)300.75 323.801 Q 39.12(17 for)129.6
333.801 R(\(i = 0; i < nloop; i++\) {)4.89 E 58.68(18 Sem_wait\(mutex\);)129.6
343.801 R 58.68(19 printf\("child:)129.6 353.801 R(%d\\n", count++\);)4.89 E
58.68(20 Sem_post\(mutex\);)129.6 363.801 R 39.12(21 })129.6 373.801 R 39.12
(22 exit\(0\);)129.6 383.801 R 19.56(23 })129.6 393.801 R 39.12(24 /*)129.6
403.801 R(parent */)4.89 E 19.56(25 for)129.6 413.801 R
(\(i = 0; i < nloop; i++\) {)4.89 E 39.12(26 Sem_wait\(mutex\);)129.6 423.801 R
39.12(27 printf\("parent:)129.6 433.801 R(%d\\n", count++\);)4.89 E 39.12
(28 Sem_post\(mutex\);)129.6 443.801 R 19.56(29 })129.6 453.801 R 19.56
(30 exit\(0\);)129.6 463.801 R(31 })129.6 473.801 Q 134.6 478.602 129.6 478.602
DL 138.1 478.602 133.1 478.602 DL 143.1 478.602 138.1 478.602 DL 148.1 478.602
143.1 478.602 DL 153.1 478.602 148.1 478.602 DL 158.1 478.602 153.1 478.602 DL
163.1 478.602 158.1 478.602 DL 168.1 478.602 163.1 478.602 DL 173.1 478.602
168.1 478.602 DL 178.1 478.602 173.1 478.602 DL 183.1 478.602 178.1 478.602 DL
188.1 478.602 183.1 478.602 DL 193.1 478.602 188.1 478.602 DL 198.1 478.602
193.1 478.602 DL 203.1 478.602 198.1 478.602 DL 208.1 478.602 203.1 478.602 DL
213.1 478.602 208.1 478.602 DL 218.1 478.602 213.1 478.602 DL 223.1 478.602
218.1 478.602 DL 228.1 478.602 223.1 478.602 DL 233.1 478.602 228.1 478.602 DL
238.1 478.602 233.1 478.602 DL 243.1 478.602 238.1 478.602 DL 248.1 478.602
243.1 478.602 DL 253.1 478.602 248.1 478.602 DL 258.1 478.602 253.1 478.602 DL
263.1 478.602 258.1 478.602 DL 268.1 478.602 263.1 478.602 DL 273.1 478.602
268.1 478.602 DL 278.1 478.602 273.1 478.602 DL 283.1 478.602 278.1 478.602 DL
288.1 478.602 283.1 478.602 DL 293.1 478.602 288.1 478.602 DL 298.1 478.602
293.1 478.602 DL 303.1 478.602 298.1 478.602 DL 308.1 478.602 303.1 478.602 DL
313.1 478.602 308.1 478.602 DL 318.1 478.602 313.1 478.602 DL 323.1 478.602
318.1 478.602 DL 328.1 478.602 323.1 478.602 DL 333.1 478.602 328.1 478.602 DL
338.1 478.602 333.1 478.602 DL 343.1 478.602 338.1 478.602 DL 348.1 478.602
343.1 478.602 DL 353.1 478.602 348.1 478.602 DL 358.1 478.602 353.1 478.602 DL
363.1 478.602 358.1 478.602 DL 368.1 478.602 363.1 478.602 DL 373.1 478.602
368.1 478.602 DL 378.1 478.602 373.1 478.602 DL 383.1 478.602 378.1 478.602 DL
388.1 478.602 383.1 478.602 DL 393.1 478.602 388.1 478.602 DL 398.1 478.602
393.1 478.602 DL 403.1 478.602 398.1 478.602 DL 408.1 478.602 403.1 478.602 DL
413.1 478.602 408.1 478.602 DL 418.1 478.602 413.1 478.602 DL 423.1 478.602
418.1 478.602 DL 428.1 478.602 423.1 478.602 DL 433.1 478.602 428.1 478.602 DL
438.1 478.602 433.1 478.602 DL 443.1 478.602 438.1 478.602 DL 448.1 478.602
443.1 478.602 DL 453.1 478.602 448.1 478.602 DL 458.1 478.602 453.1 478.602 DL
463.1 478.602 458.1 478.602 DL 468.1 478.602 463.1 478.602 DL 473.1 478.602
468.1 478.602 DL F2 -1.5(shm / incr1.c)475.35 481.102 R/F4 8/Palatino-Bold@0 SF
(Figure 12.3)215.26 494.602 Q/F5 8/Palatino-Roman@0 SF(Par)6 E
(ent and child both incr)-.144 E(ement the same global.)-.144 E/F6 10
/Palatino-Roman@0 SF 2.199(If we r)147.6 518.602 R 2.199(un this pr)-.08 F
2.199(ogram and look only at the output when the system switches)-.18 F
(between the par)129.6 530.602 Q(ent and child, we have the following:)-.18 E
F3(child: 0)147.6 546.602 Q/F7 8.15/Palatino-Italic@0 SF
(child runs \214rst, counter starts at 0)255.6 546.602 Q F3(child: 1)147.6
556.602 Q 4.89(...)147.6 566.602 S(child: 678)147.6 576.602 Q(child: 679)147.6
586.602 Q(parent: 0)147.6 596.602 Q F7(child is stopped, par)255.6 596.602 Q
(ent runs, counter starts at 0)-.147 E F3(parent: 1)147.6 606.602 Q 4.89(...)
147.6 616.602 S(parent: 1220)147.6 626.602 Q(parent: 1221)147.6 636.602 Q
(child: 680)147.6 646.602 Q F7(par)255.6 646.602 Q(ent is stopped, child runs)
-.147 E EP
%%Page: 307 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF(Section 12.2)93.6 82 Q/F1 9/Courier@0 SF(mmap)330.177
82 Q F0(,)A F1(munmap)4.5 E F0 4.5(,a)C(nd)402.177 82 Q F1(msync)4.5 E F0
(Functions)4.5 E/F2 9/Palatino-Bold@0 SF(307)506.1 82 Q .32 LW 97.6 89.2 93.6
89.2 DL 99.6 89.2 95.6 89.2 DL 103.6 89.2 99.6 89.2 DL 107.6 89.2 103.6 89.2 DL
111.6 89.2 107.6 89.2 DL 115.6 89.2 111.6 89.2 DL 119.6 89.2 115.6 89.2 DL
123.6 89.2 119.6 89.2 DL 127.6 89.2 123.6 89.2 DL 131.6 89.2 127.6 89.2 DL
135.6 89.2 131.6 89.2 DL 139.6 89.2 135.6 89.2 DL 143.6 89.2 139.6 89.2 DL
147.6 89.2 143.6 89.2 DL 151.6 89.2 147.6 89.2 DL 155.6 89.2 151.6 89.2 DL
159.6 89.2 155.6 89.2 DL 163.6 89.2 159.6 89.2 DL 167.6 89.2 163.6 89.2 DL
171.6 89.2 167.6 89.2 DL 175.6 89.2 171.6 89.2 DL 179.6 89.2 175.6 89.2 DL
183.6 89.2 179.6 89.2 DL 187.6 89.2 183.6 89.2 DL 191.6 89.2 187.6 89.2 DL
195.6 89.2 191.6 89.2 DL 199.6 89.2 195.6 89.2 DL 203.6 89.2 199.6 89.2 DL
207.6 89.2 203.6 89.2 DL 211.6 89.2 207.6 89.2 DL 215.6 89.2 211.6 89.2 DL
219.6 89.2 215.6 89.2 DL 223.6 89.2 219.6 89.2 DL 227.6 89.2 223.6 89.2 DL
231.6 89.2 227.6 89.2 DL 235.6 89.2 231.6 89.2 DL 239.6 89.2 235.6 89.2 DL
243.6 89.2 239.6 89.2 DL 247.6 89.2 243.6 89.2 DL 251.6 89.2 247.6 89.2 DL
255.6 89.2 251.6 89.2 DL 259.6 89.2 255.6 89.2 DL 263.6 89.2 259.6 89.2 DL
267.6 89.2 263.6 89.2 DL 271.6 89.2 267.6 89.2 DL 275.6 89.2 271.6 89.2 DL
279.6 89.2 275.6 89.2 DL 283.6 89.2 279.6 89.2 DL 287.6 89.2 283.6 89.2 DL
291.6 89.2 287.6 89.2 DL 295.6 89.2 291.6 89.2 DL 299.6 89.2 295.6 89.2 DL
303.6 89.2 299.6 89.2 DL 307.6 89.2 303.6 89.2 DL 311.6 89.2 307.6 89.2 DL
315.6 89.2 311.6 89.2 DL 319.6 89.2 315.6 89.2 DL 323.6 89.2 319.6 89.2 DL
327.6 89.2 323.6 89.2 DL 331.6 89.2 327.6 89.2 DL 335.6 89.2 331.6 89.2 DL
339.6 89.2 335.6 89.2 DL 343.6 89.2 339.6 89.2 DL 347.6 89.2 343.6 89.2 DL
351.6 89.2 347.6 89.2 DL 355.6 89.2 351.6 89.2 DL 359.6 89.2 355.6 89.2 DL
363.6 89.2 359.6 89.2 DL 367.6 89.2 363.6 89.2 DL 371.6 89.2 367.6 89.2 DL
375.6 89.2 371.6 89.2 DL 379.6 89.2 375.6 89.2 DL 383.6 89.2 379.6 89.2 DL
387.6 89.2 383.6 89.2 DL 391.6 89.2 387.6 89.2 DL 395.6 89.2 391.6 89.2 DL
399.6 89.2 395.6 89.2 DL 403.6 89.2 399.6 89.2 DL 407.6 89.2 403.6 89.2 DL
411.6 89.2 407.6 89.2 DL 415.6 89.2 411.6 89.2 DL 419.6 89.2 415.6 89.2 DL
423.6 89.2 419.6 89.2 DL 427.6 89.2 423.6 89.2 DL 431.6 89.2 427.6 89.2 DL
435.6 89.2 431.6 89.2 DL 439.6 89.2 435.6 89.2 DL 443.6 89.2 439.6 89.2 DL
447.6 89.2 443.6 89.2 DL 451.6 89.2 447.6 89.2 DL 455.6 89.2 451.6 89.2 DL
459.6 89.2 455.6 89.2 DL 463.6 89.2 459.6 89.2 DL 467.6 89.2 463.6 89.2 DL
471.6 89.2 467.6 89.2 DL 475.6 89.2 471.6 89.2 DL 479.6 89.2 475.6 89.2 DL
483.6 89.2 479.6 89.2 DL 487.6 89.2 483.6 89.2 DL 491.6 89.2 487.6 89.2 DL
495.6 89.2 491.6 89.2 DL 499.6 89.2 495.6 89.2 DL 503.6 89.2 499.6 89.2 DL
507.6 89.2 503.6 89.2 DL 511.6 89.2 507.6 89.2 DL 515.6 89.2 511.6 89.2 DL
519.6 89.2 515.6 89.2 DL/F3 8.15/Courier@0 SF(child: 681)147.6 121 Q 4.89(...)
147.6 131 S(child: 2078)147.6 141 Q(child: 2079)147.6 151 Q(parent: 1222)147.6
161 Q/F4 8.15/Palatino-Italic@0 SF(child is stopped, par)255.6 161 Q(ent runs)
-.147 E F3(parent: 1223)147.6 171 Q F4(and so on)255.6 188 Q/F5 10
/Palatino-Roman@0 SF 1.353(As we can see, both pr)129.6 206 R 1.353
(ocesses have their own copy of the global)-.18 F/F6 10/Courier@0 SF(count)
3.852 E F5 6.352(.E)C 1.352(ach starts)476.538 206 R .844
(with the value of this variable as 0, and each incr)129.6 218 R .845
(ements its own copy of this variable.)-.18 F(Figur)129.6 230 Q 2.5(e1)-.18 G
(2.4 shows the par)165.72 230 Q(ent befor)-.18 E 2.5(ec)-.18 G(alling)293.45
230 Q F6(fork)2.5 E F5(.)A 421.8 352.8 MT 0 -100.8 RL -100.8 0 RL 0 100.8 RL CL
ST/F7 8/Courier@0 SF(int count;)328.2 269.16 Q(if \(Fork\(\) == 0\) {)328.2
289.16 Q(/* child */)347.4 299.16 Q(...)347.4 309.16 Q(})328.2 319.16 Q
(/* parent */)328.2 339.16 Q(...)328.2 349.16 Q/F8 8/Palatino-Roman@0 SF(par)
359.94 248.76 Q(ent)-.144 E 303 280.8 317.4 280.8 DL 317.4 280.8 MT -7.2 1.8 RL
0 -3.6 RL CL BL 317.4 280.8 MT -7.2 1.8 RL 0 -3.6 RL CL ST(par)224.536 282.56 Q
(ent executing her)-.144 E(e)-.144 E/F9 8/Palatino-Bold@0 SF(Figure 12.4)253.86
370.8 Q F8(Par)6 E(ent befor)-.144 E 2(ec)-.144 G(alling)352.052 370.8 Q F7
(fork)2 E F8(.)A F5(When)129.6 394.8 Q F6(fork)2.962 E F5 .461
(is called, the child starts with its own copy of the par)2.962 F .461
(ent's data space.)-.18 F(Fig-)5.461 E(ur)129.6 406.8 Q 2.5(e1)-.18 G
(2.5 shows the two pr)151.69 406.8 Q(ocesses after)-.18 E F6(fork)2.5 E F5 -.18
(re)2.5 G(turns.).18 E 309.6 529.6 MT 0 -100.8 RL -100.8 0 RL 0 100.8 RL CL ST
F7(int count;)213.6 445.96 Q(if \(Fork\(\) == 0\) {)213.6 465.96 Q(/* child */)
232.8 475.96 Q(...)232.8 485.96 Q(})213.6 495.96 Q(/* parent */)213.6 515.96 Q
(...)213.6 525.96 Q 518.4 529.6 MT 0 -100.8 RL -100.8 0 RL 0 100.8 RL CL ST
(int count;)422.4 445.96 Q(if \(Fork\(\) == 0\) {)422.4 465.96 Q(/* child */)
441.6 475.96 Q(...)441.6 485.96 Q(})422.4 495.96 Q(/* parent */)422.4 515.96 Q
(...)422.4 525.96 Q F8(par)247.74 425.56 Q(ent)-.144 E(child)459.124 425.56 Q
190.8 522.4 205.2 522.4 DL 205.2 522.4 MT -7.2 1.8 RL 0 -3.6 RL CL BL 205.2
522.4 MT -7.2 1.8 RL 0 -3.6 RL CL ST(par)112.336 524.16 Q(ent executing her)
-.144 E(e)-.144 E 399.6 482.8 414 482.8 DL 414 482.8 MT -7.2 1.8 RL 0 -3.6 RL
CL BL 414 482.8 MT -7.2 1.8 RL 0 -3.6 RL CL ST(child executing her)326.304
484.56 Q(e)-.144 E F9(Figure 12.5)238.224 547.6 Q F8(Par)6 E
(ent and child after)-.144 E F7(fork)2 E F8 -.144(re)2 G(turns.).144 E F5 1.84
-.92(We s)129.6 571.6 T(ee that the par).92 E
(ent and child each have their own copy of the variable)-.18 E F6(count)2.5 E
F5(.)A/F10 12/Helvetica-Bold@0 SF(12.2)93.6 607.6 Q/F11 12/Courier-Bold@0 SF
(mmap)129.6 607.6 Q F10(,)A F11(munmap)6.672 E F10 6.672(,a)C(nd)228.288 607.6
Q F11(msync)6.672 E F10(Functions)6.672 E F5(The)129.6 631.6 Q F6(mmap)3.138 E
F5 .638(function maps either a \214le or a Posix shar)3.138 F .638
(ed memory object into the addr)-.18 F(ess)-.18 E(space of a pr)129.6 643.6 Q
2.5(ocess. W)-.18 F 2.5(eu)-.92 G(se this function for thr)238.22 643.6 Q
(ee purposes:)-.18 E EP
%%Page: 308 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(308)93.6 82 Q/F1 9/Palatino-Roman@0 SF(Shar)125.1 82 Q
2.25(ed Memory Intr)-.162 F 227.622(oduction Chapter)-.162 F(12)2.25 E .32 LW
97.6 89.2 93.6 89.2 DL 99.6 89.2 95.6 89.2 DL 103.6 89.2 99.6 89.2 DL 107.6
89.2 103.6 89.2 DL 111.6 89.2 107.6 89.2 DL 115.6 89.2 111.6 89.2 DL 119.6 89.2
115.6 89.2 DL 123.6 89.2 119.6 89.2 DL 127.6 89.2 123.6 89.2 DL 131.6 89.2
127.6 89.2 DL 135.6 89.2 131.6 89.2 DL 139.6 89.2 135.6 89.2 DL 143.6 89.2
139.6 89.2 DL 147.6 89.2 143.6 89.2 DL 151.6 89.2 147.6 89.2 DL 155.6 89.2
151.6 89.2 DL 159.6 89.2 155.6 89.2 DL 163.6 89.2 159.6 89.2 DL 167.6 89.2
163.6 89.2 DL 171.6 89.2 167.6 89.2 DL 175.6 89.2 171.6 89.2 DL 179.6 89.2
175.6 89.2 DL 183.6 89.2 179.6 89.2 DL 187.6 89.2 183.6 89.2 DL 191.6 89.2
187.6 89.2 DL 195.6 89.2 191.6 89.2 DL 199.6 89.2 195.6 89.2 DL 203.6 89.2
199.6 89.2 DL 207.6 89.2 203.6 89.2 DL 211.6 89.2 207.6 89.2 DL 215.6 89.2
211.6 89.2 DL 219.6 89.2 215.6 89.2 DL 223.6 89.2 219.6 89.2 DL 227.6 89.2
223.6 89.2 DL 231.6 89.2 227.6 89.2 DL 235.6 89.2 231.6 89.2 DL 239.6 89.2
235.6 89.2 DL 243.6 89.2 239.6 89.2 DL 247.6 89.2 243.6 89.2 DL 251.6 89.2
247.6 89.2 DL 255.6 89.2 251.6 89.2 DL 259.6 89.2 255.6 89.2 DL 263.6 89.2
259.6 89.2 DL 267.6 89.2 263.6 89.2 DL 271.6 89.2 267.6 89.2 DL 275.6 89.2
271.6 89.2 DL 279.6 89.2 275.6 89.2 DL 283.6 89.2 279.6 89.2 DL 287.6 89.2
283.6 89.2 DL 291.6 89.2 287.6 89.2 DL 295.6 89.2 291.6 89.2 DL 299.6 89.2
295.6 89.2 DL 303.6 89.2 299.6 89.2 DL 307.6 89.2 303.6 89.2 DL 311.6 89.2
307.6 89.2 DL 315.6 89.2 311.6 89.2 DL 319.6 89.2 315.6 89.2 DL 323.6 89.2
319.6 89.2 DL 327.6 89.2 323.6 89.2 DL 331.6 89.2 327.6 89.2 DL 335.6 89.2
331.6 89.2 DL 339.6 89.2 335.6 89.2 DL 343.6 89.2 339.6 89.2 DL 347.6 89.2
343.6 89.2 DL 351.6 89.2 347.6 89.2 DL 355.6 89.2 351.6 89.2 DL 359.6 89.2
355.6 89.2 DL 363.6 89.2 359.6 89.2 DL 367.6 89.2 363.6 89.2 DL 371.6 89.2
367.6 89.2 DL 375.6 89.2 371.6 89.2 DL 379.6 89.2 375.6 89.2 DL 383.6 89.2
379.6 89.2 DL 387.6 89.2 383.6 89.2 DL 391.6 89.2 387.6 89.2 DL 395.6 89.2
391.6 89.2 DL 399.6 89.2 395.6 89.2 DL 403.6 89.2 399.6 89.2 DL 407.6 89.2
403.6 89.2 DL 411.6 89.2 407.6 89.2 DL 415.6 89.2 411.6 89.2 DL 419.6 89.2
415.6 89.2 DL 423.6 89.2 419.6 89.2 DL 427.6 89.2 423.6 89.2 DL 431.6 89.2
427.6 89.2 DL 435.6 89.2 431.6 89.2 DL 439.6 89.2 435.6 89.2 DL 443.6 89.2
439.6 89.2 DL 447.6 89.2 443.6 89.2 DL 451.6 89.2 447.6 89.2 DL 455.6 89.2
451.6 89.2 DL 459.6 89.2 455.6 89.2 DL 463.6 89.2 459.6 89.2 DL 467.6 89.2
463.6 89.2 DL 471.6 89.2 467.6 89.2 DL 475.6 89.2 471.6 89.2 DL 479.6 89.2
475.6 89.2 DL 483.6 89.2 479.6 89.2 DL 487.6 89.2 483.6 89.2 DL 491.6 89.2
487.6 89.2 DL 495.6 89.2 491.6 89.2 DL 499.6 89.2 495.6 89.2 DL 503.6 89.2
499.6 89.2 DL 507.6 89.2 503.6 89.2 DL 511.6 89.2 507.6 89.2 DL 515.6 89.2
511.6 89.2 DL 519.6 89.2 515.6 89.2 DL/F2 10/Palatino-Roman@0 SF 6.33(1. with)
147.6 123 R 2.5(ar)2.5 G(egular \214le to pr)198.03 123 Q
(ovide memory-mapped I/O \(Section 12.3\),)-.18 E 6.33(2. with)147.6 139 R
3.346(special \214les to pr)5.846 F 3.345
(ovide anonymous memory mappings \(Sections 12.4)-.18 F(and 12.5\), and)163.93
151 Q 6.33(3. with)147.6 167 R/F3 10/Courier@0 SF(shm_open)3.464 E F2 .964
(to pr)3.464 F .964(ovide Posix shar)-.18 F .965(ed memory between unr)-.18 F
.965(elated pr)-.18 F(ocesses)-.18 E(\(Chapter 13\).)163.93 179 Q/F4 8.15
/Courier@0 SF(#include <sys/mman.h>)147.6 213 Q(void *mmap\(void *)147.6 233 Q
/F5 8.15/Palatino-Italic@0 SF(addr)A F4 4.89(,s)C(ize_t)260.339 233 Q F5(len)
4.89 E F4 4.89(,i)C(nt)314.316 233 Q F5(pr)4.89 E(ot)-.147 E F4 4.89(,i)C(nt)
357.087 233 Q F5(\215ags)4.89 E F4 4.89(,i)C(nt)401.733 233 Q F5(fd)4.89 E F4
4.89(,o)C(ff_t)437.414 233 Q F5(offset)4.89 E F4(\);).22 E/F6 8.15
/Palatino-Roman@0 SF(Returns: starting addr)239.621 253 Q(ess of mapped r)-.147
E(egion if OK,)-.147 E F4(MAP_FAILED)2.038 E F6(on err)2.038 E(or)-.147 E .326
LW 129.6 200.775 129.6 257.075 DL 519.6 200.775 129.6 200.775 DL 519.6 257.075
519.6 200.775 DL 129.6 257.075 519.6 257.075 DL/F7 10/Palatino-Italic@0 SF
(addr)129.6 277 Q F2 2.427(can specify the starting addr)4.927 F 2.427
(ess within the pr)-.18 F 2.427(ocess of wher)-.18 F 4.927(et)-.18 G 2.427
(he descriptor)446.237 277 R F7(fd)4.926 E F2 1.491(should be mapped.)129.6 289
R(Normally)6.491 E 3.991(,t)-1.11 G 1.491(his is speci\214ed as a null pointer)
275.784 289 R 3.992(,t)-.74 G 1.492(elling the kernel to)432.314 289 R .534
(choose the starting addr)129.6 301 R 3.034(ess. In)-.18 F .533
(any case, the r)3.034 F .533(eturn value of the function is the starting)-.18
F(addr)129.6 313 Q(ess of wher)-.18 E 2.5(et)-.18 G
(he descriptor has been mapped.)210.92 313 Q F7(len)147.6 325 Q F2 .79
(is the number of bytes to map into the addr)3.29 F .79(ess space of the pr)
-.18 F .79(ocess, starting at)-.18 F F7(offset)129.6 337 Q F2 .906(bytes fr)
3.406 F .906(om the beginning of the \214le.)-.18 F(Normally)5.906 E(,)-1.11 E
F7(offset)3.406 E F2 .906(is 0.)3.406 F(Figur)5.906 E 3.406(e1)-.18 G .906
(2.6 shows this)455.958 337 R(mapping.)129.6 349 Q 295.8 515.24 MT 0 -129.6 RL
-43.2 0 RL 0 129.6 RL CL .32 LW ST/F8 8/Palatino-Roman@0 SF(addr)249.704 373.76
Q(ess space)-.144 E(of pr)256.504 382.4 Q(ocess)-.144 E(high memory)202.576
392.4 Q(low memory)205.296 512 Q 403.8 558.44 MT 0 -21.6 RL -36 0 RL 0 21.6 RL
CL 0.8000 FL 403.8 558.44 MT 0 -21.6 RL -36 0 RL 0 21.6 RL CL ST 475.8 558.44
MT 0 -21.6 RL -72 0 RL 0 21.6 RL CL ST(memory mapped)409.132 544.4 Q
(portion of \214le)415.636 554.4 Q 490.2 558.44 MT 0 -21.6 RL -14.4 0 RL 0 21.6
RL CL 0.8000 FL 490.2 558.44 MT 0 -21.6 RL -14.4 0 RL 0 21.6 RL CL ST(\214le r)
256.488 549.4 Q(efer)-.144 E(enced by descriptor)-.144 E/F9 8/Palatino-Italic@0
SF(fd)2 E F8(:)A 367.8 580.04 367.8 565.64 DL 403.8 580.04 403.8 565.64 DL
475.8 580.04 475.8 565.64 DL 403.8 572.84 367.8 572.84 DL 367.8 572.84 MT 7.2
-1.8 RL 0 3.6 RL CL BL 367.8 572.84 MT 7.2 -1.8 RL 0 3.6 RL CL ST 403.8 572.84
MT -7.2 1.8 RL 0 -3.6 RL CL BL 403.8 572.84 MT -7.2 1.8 RL 0 -3.6 RL CL ST F9
(offset)377.356 579.6 Q 475.8 572.84 403.8 572.84 DL 403.8 572.84 MT 7.2 -1.8
RL 0 3.6 RL CL BL 403.8 572.84 MT 7.2 -1.8 RL 0 3.6 RL CL ST 475.8 572.84 MT
-7.2 1.8 RL 0 -3.6 RL CL BL 475.8 572.84 MT -7.2 1.8 RL 0 -3.6 RL CL ST(len)
434.908 579.6 Q 295.8 486.44 MT 0 -72 RL -43.2 0 RL 0 72 RL CL ST F8(memory)
259.232 437.2 Q(mapped)259.5 447.2 Q(portion)261.052 457.2 Q(of \214le)264.184
467.2 Q 425.409 465.052 50.391 -0.2419 -4.3393 DA 425.359 464.615 50.401
-8.3685 -12.4470 DA 425.594 465.375 50.397 -17.8392 -21.9312 DA 425.098 464.247
50.384 -25.0027 -29.1414 DA 425.651 465.174 50.388 -34.8227 -38.9171 DA 425.4
464.84 50.383 -42.9732 -47.0268 DA 425.066 464.589 50.388 -51.0829 -55.1773 DA
425.993 465.142 50.384 -60.8586 -64.9973 DA 424.865 464.646 50.397 -68.0688
-72.1608 DA 425.625 464.881 50.401 -77.5530 -81.6315 DA 425.188 464.831 50.391
-85.6607 -89.7581 DA 421.8 414.44 425.4 414.44 DL 414.384 414.44 417.984 414.44
DL 406.968 414.44 410.568 414.44 DL 399.552 414.44 403.152 414.44 DL 392.136
414.44 395.736 414.44 DL 384.72 414.44 388.32 414.44 DL 377.304 414.44 380.904
414.44 DL 369.888 414.44 373.488 414.44 DL 362.472 414.44 366.072 414.44 DL
355.128 414.44 358.728 414.44 DL 347.712 414.44 351.312 414.44 DL 340.296
414.44 343.896 414.44 DL 332.88 414.44 336.48 414.44 DL 325.464 414.44 329.064
414.44 DL 318.048 414.44 321.648 414.44 DL 310.632 414.44 314.232 414.44 DL
303.216 414.44 306.816 414.44 DL 295.8 414.44 299.4 414.44 DL 475.8 468.44
475.8 464.84 DL 475.8 476.072 475.8 472.472 DL 475.8 483.632 475.8 480.032 DL
475.8 491.264 475.8 487.664 DL 475.8 498.824 475.8 495.224 DL 475.8 506.456
475.8 502.856 DL 475.8 514.016 475.8 510.416 DL 475.8 521.648 475.8 518.048 DL
475.8 529.208 475.8 525.608 DL 475.8 536.84 475.8 533.24 DL 367.786 522.078
36.016 0.5764 -5.1576 DA 367.792 522.407 35.997 -11.9525 -17.7647 DA 367.546
521.92 35.992 -23.1817 -28.9253 DA 367.937 522.606 36.005 -36.4781 -42.2605 DA
367.634 522.303 36.005 -47.7395 -53.5219 DA 368.32 522.694 35.992 -61.0747
-66.8183 DA 367.833 522.448 35.997 -72.2353 -78.0475 DA 368.163 522.454 36.016
-84.8424 -90.5764 DA 364.2 486.44 367.8 486.44 DL 356.568 486.44 360.168 486.44
DL 349.008 486.44 352.608 486.44 DL 341.376 486.44 344.976 486.44 DL 333.816
486.44 337.416 486.44 DL 326.184 486.44 329.784 486.44 DL 318.624 486.44
322.224 486.44 DL 310.992 486.44 314.592 486.44 DL 303.432 486.44 307.032
486.44 DL 295.8 486.44 299.4 486.44 DL 403.8 526.04 403.8 522.44 DL 403.8
531.44 403.8 527.84 DL 403.8 536.84 403.8 533.24 DL 231 486.44 252.6 486.44 DL
252.6 486.44 MT -7.2 1.8 RL 0 -3.6 RL CL BL 252.6 486.44 MT -7.2 1.8 RL 0 -3.6
RL CL ST -.144(re)155.168 488.2 S(turn value of).144 E/F10 8/Courier@0 SF(mmap)
2 E/F11 8/Palatino-Bold@0 SF(Figure 12.6)242.28 598.04 Q F8
(Example of memory-mapped \214le.)6 E F2 2.101(The pr)147.6 622.04 R 2.102
(otection of the memory-mapped r)-.18 F 2.102(egion is speci\214ed by the)-.18
F F7(pr)4.602 E(ot)-.18 E F2(ar)4.602 E(gument)-.18 E .35
(using the constants in Figur)129.6 634.04 R 2.849(e1)-.18 G 2.849(2.7. The)
266.168 634.04 R .349(common value for this ar)2.849 F .349(gument is)-.18 F F3
(PROT_READ)2.849 E 2.5(|P)129.6 646.04 S(ROT_WRITE)144.1 646.04 Q F2(for r)2.5
E(ead\211write access.)-.18 E EP
%%Page: 309 7
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF(Section 12.2)93.6 82 Q/F1 9/Courier@0 SF(mmap)330.177
82 Q F0(,)A F1(munmap)4.5 E F0 4.5(,a)C(nd)402.177 82 Q F1(msync)4.5 E F0
(Functions)4.5 E/F2 9/Palatino-Bold@0 SF(309)506.1 82 Q .32 LW 97.6 89.2 93.6
89.2 DL 99.6 89.2 95.6 89.2 DL 103.6 89.2 99.6 89.2 DL 107.6 89.2 103.6 89.2 DL
111.6 89.2 107.6 89.2 DL 115.6 89.2 111.6 89.2 DL 119.6 89.2 115.6 89.2 DL
123.6 89.2 119.6 89.2 DL 127.6 89.2 123.6 89.2 DL 131.6 89.2 127.6 89.2 DL
135.6 89.2 131.6 89.2 DL 139.6 89.2 135.6 89.2 DL 143.6 89.2 139.6 89.2 DL
147.6 89.2 143.6 89.2 DL 151.6 89.2 147.6 89.2 DL 155.6 89.2 151.6 89.2 DL
159.6 89.2 155.6 89.2 DL 163.6 89.2 159.6 89.2 DL 167.6 89.2 163.6 89.2 DL
171.6 89.2 167.6 89.2 DL 175.6 89.2 171.6 89.2 DL 179.6 89.2 175.6 89.2 DL
183.6 89.2 179.6 89.2 DL 187.6 89.2 183.6 89.2 DL 191.6 89.2 187.6 89.2 DL
195.6 89.2 191.6 89.2 DL 199.6 89.2 195.6 89.2 DL 203.6 89.2 199.6 89.2 DL
207.6 89.2 203.6 89.2 DL 211.6 89.2 207.6 89.2 DL 215.6 89.2 211.6 89.2 DL
219.6 89.2 215.6 89.2 DL 223.6 89.2 219.6 89.2 DL 227.6 89.2 223.6 89.2 DL
231.6 89.2 227.6 89.2 DL 235.6 89.2 231.6 89.2 DL 239.6 89.2 235.6 89.2 DL
243.6 89.2 239.6 89.2 DL 247.6 89.2 243.6 89.2 DL 251.6 89.2 247.6 89.2 DL
255.6 89.2 251.6 89.2 DL 259.6 89.2 255.6 89.2 DL 263.6 89.2 259.6 89.2 DL
267.6 89.2 263.6 89.2 DL 271.6 89.2 267.6 89.2 DL 275.6 89.2 271.6 89.2 DL
279.6 89.2 275.6 89.2 DL 283.6 89.2 279.6 89.2 DL 287.6 89.2 283.6 89.2 DL
291.6 89.2 287.6 89.2 DL 295.6 89.2 291.6 89.2 DL 299.6 89.2 295.6 89.2 DL
303.6 89.2 299.6 89.2 DL 307.6 89.2 303.6 89.2 DL 311.6 89.2 307.6 89.2 DL
315.6 89.2 311.6 89.2 DL 319.6 89.2 315.6 89.2 DL 323.6 89.2 319.6 89.2 DL
327.6 89.2 323.6 89.2 DL 331.6 89.2 327.6 89.2 DL 335.6 89.2 331.6 89.2 DL
339.6 89.2 335.6 89.2 DL 343.6 89.2 339.6 89.2 DL 347.6 89.2 343.6 89.2 DL
351.6 89.2 347.6 89.2 DL 355.6 89.2 351.6 89.2 DL 359.6 89.2 355.6 89.2 DL
363.6 89.2 359.6 89.2 DL 367.6 89.2 363.6 89.2 DL 371.6 89.2 367.6 89.2 DL
375.6 89.2 371.6 89.2 DL 379.6 89.2 375.6 89.2 DL 383.6 89.2 379.6 89.2 DL
387.6 89.2 383.6 89.2 DL 391.6 89.2 387.6 89.2 DL 395.6 89.2 391.6 89.2 DL
399.6 89.2 395.6 89.2 DL 403.6 89.2 399.6 89.2 DL 407.6 89.2 403.6 89.2 DL
411.6 89.2 407.6 89.2 DL 415.6 89.2 411.6 89.2 DL 419.6 89.2 415.6 89.2 DL
423.6 89.2 419.6 89.2 DL 427.6 89.2 423.6 89.2 DL 431.6 89.2 427.6 89.2 DL
435.6 89.2 431.6 89.2 DL 439.6 89.2 435.6 89.2 DL 443.6 89.2 439.6 89.2 DL
447.6 89.2 443.6 89.2 DL 451.6 89.2 447.6 89.2 DL 455.6 89.2 451.6 89.2 DL
459.6 89.2 455.6 89.2 DL 463.6 89.2 459.6 89.2 DL 467.6 89.2 463.6 89.2 DL
471.6 89.2 467.6 89.2 DL 475.6 89.2 471.6 89.2 DL 479.6 89.2 475.6 89.2 DL
483.6 89.2 479.6 89.2 DL 487.6 89.2 483.6 89.2 DL 491.6 89.2 487.6 89.2 DL
495.6 89.2 491.6 89.2 DL 499.6 89.2 495.6 89.2 DL 503.6 89.2 499.6 89.2 DL
507.6 89.2 503.6 89.2 DL 511.6 89.2 507.6 89.2 DL 515.6 89.2 511.6 89.2 DL
519.6 89.2 515.6 89.2 DL 400.616 115 248.584 115 DL/F3 8/Palatino-Italic@0 SF
(pr)269.992 123 Q(ot)-.144 E/F4 8/Palatino-Roman@0 SF(Description)333.988 123 Q
400.616 127 248.584 127 DL 400.616 129 248.584 129 DL/F5 8/Courier@0 SF
(PROT_READ)252.584 137 Q F4(data can be r)312.584 137 Q(ead)-.144 E F5
(PROT_WRITE)252.584 147 Q F4(data can be written)312.584 147 Q F5(PROT_EXEC)
252.584 157 Q F4(data can be executed)312.584 157 Q F5(PROT_NONE)252.584 167 Q
F4(data cannot be accessed)312.584 167 Q 400.616 171 248.584 171 DL 306.584 115
306.584 171 DL 400.616 115 400.616 171 DL 248.584 115 248.584 171 DL/F6 8
/Palatino-Bold@0 SF(Figure 12.7)253.556 189 Q F3(pr)6 E(ot)-.144 E F4(ar)2 E
(gument for)-.144 E F5(mmap)2 E F4(.h>.)A 422.976 215 226.224 215 DL F3
(\215ags)249.112 223 Q F4(Description)336.388 223 Q 422.976 227 226.224 227 DL
422.976 229 226.224 229 DL F5(MAP_SHARED)230.224 237 Q F4(changes ar)295.024
237 Q 2(es)-.144 G(har)341.8 237 Q(ed)-.144 E F5(MAP_PRIVATE)230.224 247 Q F4
(changes ar)295.024 247 Q 2(ep)-.144 G(rivate)343.216 247 Q F5(MAP_FIXED)
230.224 257 Q F4(interpr)295.024 257 Q(et the)-.144 E F3(addr)2 E F4(ar)2 E
(gument exactly)-.144 E 422.976 261 226.224 261 DL 289.024 215 289.024 261 DL
422.976 215 422.976 261 DL 226.224 215 226.224 261 DL F6(Figure 12.8)258.388
279 Q F3(\215ags)6 E F4(ar)2 E(gument for)-.144 E F5(mmap)2 E F4(.)A/F7 10
/Palatino-Roman@0 SF(The)147.6 303 Q/F8 10/Palatino-Italic@0 SF(\215ags)3.623 E
F7(ar)3.623 E 3.624(es)-.18 G 1.124(peci\214ed by the constants in Figur)211.79
303 R 3.624(e1)-.18 G 3.624(2.8. Either)377.484 303 R(the)3.624 E/F9 10
/Courier@0 SF(MAP_SHARED)3.624 E F7(or)3.624 E(the)129.6 315 Q F9(MAP_PRIVATE)
6.22 E F7 3.72(\215ag must be speci\214ed, optionally ORed with)6.22 F F9
(MAP_FIXED)6.22 E F7 8.72(.I)C(f)516.27 315 Q F9(MAP_PRIVATE)129.6 327 Q F7
1.087
(is speci\214ed, then modi\214cations to the mapped data by the calling pr)
3.586 F(o-)-.18 E 1.071(cess ar)129.6 339 R 3.571(ev)-.18 G 1.071
(isible only to that pr)173.662 339 R 1.07
(ocess and do not change the underlying object \(either a)-.18 F .265
(\214le object or a shar)129.6 351 R .265(ed memory object\).)-.18 F(If)5.265 E
F9(MAP_SHARED)2.765 E F7 .266(is speci\214ed, modi\214cations to the)2.766 F
2.095(mapped data by the calling pr)129.6 363 R 2.095(ocess ar)-.18 F 4.595(ev)
-.18 G 2.095(isible to all pr)324.555 363 R 2.095(ocesses that ar)-.18 F 4.595
(es)-.18 G 2.095(haring the)472.075 363 R
(object, and these changes do modify the underlying object.)129.6 375 Q .243
(For portability)147.6 387 R(,)-1.11 E F9(MAP_FIXED)2.743 E F7 .243
(should not be speci\214ed.)2.743 F .244(If it is not speci\214ed, but)5.244 F
F8(addr)2.744 E F7(is)2.744 E .798(not a null pointer)129.6 399 R 3.298(,t)-.74
G .798(hen it is implementation dependent as to what the implementation)217.222
399 R .75(does with)129.6 411 R F8(addr)3.25 E F7 5.75(.T)C .75
(he nonnull value of)209.74 411 R F8(addr)3.25 E F7 .75
(is normally taken as a hint about wher)3.25 F 3.25(et)-.18 G(he)508.99 411 Q
1.79(memory should be located.)129.6 423 R 1.789(Portable code should specify)
6.789 F F8(addr)4.289 E F7 1.789(as a null pointer and)4.289 F
(should not specify)129.6 435 Q F9(MAP_FIXED)2.5 E F7(.)A 3.165
(One way to shar)147.6 447 R 5.665(em)-.18 G 3.166(emory between a par)248.8
447 R 3.166(ent and child is to call)-.18 F F9(mmap)5.666 E F7(with)5.666 E F9
(MAP_SHARED)129.6 459 Q F7(befor)3.647 E 3.647(ec)-.18 G(alling)229.004 459 Q
F9(fork)3.647 E F7 6.147(.P)C 1.147
(osix.1 then guarantees that memory mappings in)296.448 459 R .525(the par)
129.6 471 R .525(ent ar)-.18 F 3.025(er)-.18 G .526(etained in the child.)
198.525 471 R(Furthermor)5.526 E .526(e, changes made by the par)-.18 F .526
(ent ar)-.18 F 3.026(ev)-.18 G(isi-)506.21 471 Q
(ble to the child and vice versa.)129.6 483 Q 1.84 -.92(We s)5 H
(how an example of this shortly).92 E(.)-1.11 E(After)147.6 495 Q F9(mmap)2.702
E F7 -.18(re)2.702 G .202(turns success, the).18 F F8(fd)2.702 E F7(ar)2.701 E
.201(gument can be closed.)-.18 F .201(This has no ef)5.201 F .201(fect on the)
-.18 F(mapping that was established by)129.6 507 Q F9(mmap)2.5 E F7(.)A 1.84
-.92(To r)147.6 531 T(emove a mapping fr).74 E(om the addr)-.18 E
(ess space of the pr)-.18 E(ocess, we call)-.18 E F9(munmap)2.5 E F7(.)A/F10
8.15/Courier@0 SF(#include <sys/mman.h>)147.6 553 Q(int munmap\(void *)147.6
573 Q/F11 8.15/Palatino-Italic@0 SF(addr)A F10 4.89(,s)C(ize_t)260.339 573 Q
F11(len)4.89 E F10(\);)A/F12 8.15/Palatino-Roman@0 SF(Returns: 0 if OK,)399.869
593 Q/F13 8.15/Symbol SF(-)2.038 E F12 2.038(1o)C 2.038(ne)476.955 593 S(rr)
487.64 593 Q(or)-.147 E .326 LW 129.6 540.775 129.6 597.075 DL 519.6 540.775
129.6 540.775 DL 519.6 597.075 519.6 540.775 DL 129.6 597.075 519.6 597.075 DL
F7(The)129.6 617 Q F8(addr)3.281 E F7(ar)3.281 E .781(gument is the addr)-.18 F
.781(ess that was r)-.18 F .781(eturned by)-.18 F F9(mmap)3.281 E F7 3.281(,a)C
.781(nd the)415.131 617 R F8(len)3.281 E F7 .782(is the size of)3.281 F .658
(that mapped r)129.6 629 R 3.158(egion. Further)-.18 F -.18(re)3.158 G(fer).18
E .658(ences to these addr)-.18 F .658(esses r)-.18 F .657
(esult in the generation of a)-.18 F F9(SIGSEGV)129.6 641 Q F7 .966
(signal to the pr)3.466 F .966
(ocess \(assuming, of course, that a later call to)-.18 F F9(mmap)3.466 E F7
.966(does not)3.466 F -.18(re)129.6 653 S(use this portion of the addr).18 E
(ess space\).)-.18 E EP
%%Page: 310 8
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(310)93.6 82 Q/F1 9/Palatino-Roman@0 SF(Shar)125.1 82 Q
2.25(ed Memory Intr)-.162 F 227.622(oduction Chapter)-.162 F(12)2.25 E .32 LW
97.6 89.2 93.6 89.2 DL 99.6 89.2 95.6 89.2 DL 103.6 89.2 99.6 89.2 DL 107.6
89.2 103.6 89.2 DL 111.6 89.2 107.6 89.2 DL 115.6 89.2 111.6 89.2 DL 119.6 89.2
115.6 89.2 DL 123.6 89.2 119.6 89.2 DL 127.6 89.2 123.6 89.2 DL 131.6 89.2
127.6 89.2 DL 135.6 89.2 131.6 89.2 DL 139.6 89.2 135.6 89.2 DL 143.6 89.2
139.6 89.2 DL 147.6 89.2 143.6 89.2 DL 151.6 89.2 147.6 89.2 DL 155.6 89.2
151.6 89.2 DL 159.6 89.2 155.6 89.2 DL 163.6 89.2 159.6 89.2 DL 167.6 89.2
163.6 89.2 DL 171.6 89.2 167.6 89.2 DL 175.6 89.2 171.6 89.2 DL 179.6 89.2
175.6 89.2 DL 183.6 89.2 179.6 89.2 DL 187.6 89.2 183.6 89.2 DL 191.6 89.2
187.6 89.2 DL 195.6 89.2 191.6 89.2 DL 199.6 89.2 195.6 89.2 DL 203.6 89.2
199.6 89.2 DL 207.6 89.2 203.6 89.2 DL 211.6 89.2 207.6 89.2 DL 215.6 89.2
211.6 89.2 DL 219.6 89.2 215.6 89.2 DL 223.6 89.2 219.6 89.2 DL 227.6 89.2
223.6 89.2 DL 231.6 89.2 227.6 89.2 DL 235.6 89.2 231.6 89.2 DL 239.6 89.2
235.6 89.2 DL 243.6 89.2 239.6 89.2 DL 247.6 89.2 243.6 89.2 DL 251.6 89.2
247.6 89.2 DL 255.6 89.2 251.6 89.2 DL 259.6 89.2 255.6 89.2 DL 263.6 89.2
259.6 89.2 DL 267.6 89.2 263.6 89.2 DL 271.6 89.2 267.6 89.2 DL 275.6 89.2
271.6 89.2 DL 279.6 89.2 275.6 89.2 DL 283.6 89.2 279.6 89.2 DL 287.6 89.2
283.6 89.2 DL 291.6 89.2 287.6 89.2 DL 295.6 89.2 291.6 89.2 DL 299.6 89.2
295.6 89.2 DL 303.6 89.2 299.6 89.2 DL 307.6 89.2 303.6 89.2 DL 311.6 89.2
307.6 89.2 DL 315.6 89.2 311.6 89.2 DL 319.6 89.2 315.6 89.2 DL 323.6 89.2
319.6 89.2 DL 327.6 89.2 323.6 89.2 DL 331.6 89.2 327.6 89.2 DL 335.6 89.2
331.6 89.2 DL 339.6 89.2 335.6 89.2 DL 343.6 89.2 339.6 89.2 DL 347.6 89.2
343.6 89.2 DL 351.6 89.2 347.6 89.2 DL 355.6 89.2 351.6 89.2 DL 359.6 89.2
355.6 89.2 DL 363.6 89.2 359.6 89.2 DL 367.6 89.2 363.6 89.2 DL 371.6 89.2
367.6 89.2 DL 375.6 89.2 371.6 89.2 DL 379.6 89.2 375.6 89.2 DL 383.6 89.2
379.6 89.2 DL 387.6 89.2 383.6 89.2 DL 391.6 89.2 387.6 89.2 DL 395.6 89.2
391.6 89.2 DL 399.6 89.2 395.6 89.2 DL 403.6 89.2 399.6 89.2 DL 407.6 89.2
403.6 89.2 DL 411.6 89.2 407.6 89.2 DL 415.6 89.2 411.6 89.2 DL 419.6 89.2
415.6 89.2 DL 423.6 89.2 419.6 89.2 DL 427.6 89.2 423.6 89.2 DL 431.6 89.2
427.6 89.2 DL 435.6 89.2 431.6 89.2 DL 439.6 89.2 435.6 89.2 DL 443.6 89.2
439.6 89.2 DL 447.6 89.2 443.6 89.2 DL 451.6 89.2 447.6 89.2 DL 455.6 89.2
451.6 89.2 DL 459.6 89.2 455.6 89.2 DL 463.6 89.2 459.6 89.2 DL 467.6 89.2
463.6 89.2 DL 471.6 89.2 467.6 89.2 DL 475.6 89.2 471.6 89.2 DL 479.6 89.2
475.6 89.2 DL 483.6 89.2 479.6 89.2 DL 487.6 89.2 483.6 89.2 DL 491.6 89.2
487.6 89.2 DL 495.6 89.2 491.6 89.2 DL 499.6 89.2 495.6 89.2 DL 503.6 89.2
499.6 89.2 DL 507.6 89.2 503.6 89.2 DL 511.6 89.2 507.6 89.2 DL 515.6 89.2
511.6 89.2 DL 519.6 89.2 515.6 89.2 DL/F2 10/Palatino-Roman@0 SF .38
(If the mapped r)147.6 123 R .38(egion was mapped using)-.18 F/F3 10/Courier@0
SF(MAP_PRIVATE)2.88 E F2 2.88(,t)C .38(he changes made ar)406.92 123 R 2.88(ed)
-.18 G(is-)509.12 123 Q(car)129.6 135 Q(ded.)-.18 E 1.289(In Figur)147.6 159 R
3.789(e1)-.18 G 1.289
(2.6, the kernel's virtual memory algorithm keeps the memory-mapped)197.988 159
R 2.864(\214le \(typically on disk\) synchr)129.6 171 R 2.864
(onized with the memory-mapped r)-.18 F 2.864(egion in memory)-.18 F(,)-1.11 E
.91(assuming a)129.6 183 R F3(MAP_SHARED)3.41 E F2 3.41(segment. That)3.41 F
.911(is, if we modify a location in memory that is)3.411 F .262(memory-mapped \
to a \214le, then at some time later the kernel will update the \214le accor)
129.6 195 R(d-)-.18 E(ingly)129.6 207 Q 5.099(.B)-1.11 G .099
(ut sometimes, we want to make certain that the \214le on disk corr)164.959 207
R .1(esponds to what)-.18 F(is in the memory-mapped r)129.6 219 Q
(egion, and we call)-.18 E F3(msync)2.5 E F2(to perform this synchr)2.5 E
(onization.)-.18 E/F4 8.15/Courier@0 SF(#include <sys/mman.h>)147.6 241 Q
(int msync\(void *)147.6 261 Q/F5 8.15/Palatino-Italic@0 SF(addr)A F4 4.89(,s)C
(ize_t)255.449 261 Q F5(len)4.89 E F4 4.89(,i)C(nt)309.426 261 Q F5(\215ags)
4.89 E F4(\);)A/F6 8.15/Palatino-Roman@0 SF(Returns: 0 if OK,)399.869 281 Q/F7
8.15/Symbol SF(-)2.038 E F6 2.038(1o)C 2.038(ne)476.955 281 S(rr)487.64 281 Q
(or)-.147 E .326 LW 129.6 228.775 129.6 285.075 DL 519.6 228.775 129.6 228.775
DL 519.6 285.075 519.6 228.775 DL 129.6 285.075 519.6 285.075 DL F2(The)129.6
305 Q/F8 10/Palatino-Italic@0 SF(addr)4.573 E F2(and)4.573 E F8(len)4.573 E F2
(ar)4.573 E 2.073(guments normally r)-.18 F 2.072(efer to the entir)-.18 F
4.572(em)-.18 G 2.072(emory-mapped r)404.686 305 R 2.072(egion of)-.18 F
(memory)129.6 317 Q 4.031(,a)-1.11 G 1.531(lthough subsets of this r)177.441
317 R 1.532(egion can also be speci\214ed.)-.18 F(The)6.532 E F8(\215ags)4.032
E F2(ar)4.032 E 1.532(gument is)-.18 F(formed fr)129.6 329 Q
(om the combination of constants shown in Figur)-.18 E 2.5(e1)-.18 G(2.9.)
397.63 329 Q .32 LW 417.988 343 231.212 343 DL/F9 8/Palatino-Roman@0 SF 56.796
(Constant Description)250.432 351 R 417.988 355 231.212 355 DL 417.988 357
231.212 357 DL/F10 8/Courier@0 SF(MS_ASYNC)235.212 365 Q F9(perform asynchr)
309.612 365 Q(onous writes)-.144 E F10(MS_SYNC)235.212 375 Q F9(perform synchr)
309.612 375 Q(onous writes)-.144 E F10(MS_INVALIDATE)235.212 385 Q F9
(invalidate cached data)309.612 385 Q 417.988 389 231.212 389 DL 303.612 343
303.612 389 DL 417.988 343 417.988 389 DL 231.212 343 231.212 389 DL/F11 8
/Palatino-Bold@0 SF(Figure 12.9)258.384 407 Q/F12 8/Palatino-Italic@0 SF
(\215ags)6 E F9(for)2 E F10(msync)2 E F9(function.)2 E F2 .19
(One of the two constants)129.6 431 R F3(MS_ASYNC)2.689 E F2(and)2.689 E F3
(MS_SYNC)2.689 E F2 .189(must be speci\214ed, but not both.)2.689 F(The)5.189 E
(dif)129.6 443 Q(fer)-.18 E .701(ence in these two is that)-.18 F F3(MS_ASYNC)
3.201 E F2 -.18(re)3.202 G .702(turns once the write operations ar).18 F 3.202
(eq)-.18 G(ueued)491.85 443 Q .136(by the kernel, wher)129.6 455 R(eas)-.18 E
F3(MS_SYNC)2.636 E F2 -.18(re)2.636 G .135
(turns only after the write operations ar).18 F 2.635(ec)-.18 G 2.635
(omplete. If)469.215 455 R F3(MS_INVALIDATE)129.6 467 Q F2 .792
(is also speci\214ed, all in-memory copies of the \214le data that ar)3.291 F
3.292(ei)-.18 G(ncon-)494.73 467 Q 1.121(sistent with the \214le data ar)129.6
479 R 3.621(ei)-.18 G 3.621(nvalidated. Subsequent)263.636 479 R -.18(re)3.621
G(fer).18 E 1.121(ences will obtain data fr)-.18 F(om)-.18 E(the \214le.)129.6
491 Q/F13 10/Helvetica-Bold@0 SF(Wh)93.6 515 Q 2.78(yU)-.2 G(se)124.51 515 Q
/F14 10/Courier-Bold@0 SF(mmap)2.78 E F13(?)A F2 1.19(Our description of)129.6
539 R F3(mmap)3.69 E F2 1.191
(so far has implied a memory-mapped \214le: some \214le that we)3.69 F F3(open)
129.6 551 Q F2 .27(and then map into our addr)2.77 F .269(ess space by calling)
-.18 F F3(mmap)2.769 E F2 5.269(.T)C .269(he nice featur)407.925 551 R 2.769
(ei)-.18 G 2.769(nu)478.682 551 S .269(sing a)493.301 551 R .532(memory-mapped\
 \214le is that all the I/O is done under the covers by the kernel, and we)
129.6 563 R .46(just write code that fetches and stor)129.6 575 R .46
(es values in the memory-mapped r)-.18 F 2.96(egion. W)-.18 F 2.96(en)-.92 G
(ever)500.42 575 Q(call)129.6 587 Q F3(read)2.5 E F2(,)A F3(write)2.5 E F2 2.5
(,o)C(r)216.82 587 Q F3(lseek)2.5 E F2 5(.O)C
(ften, this can simplify our code.)268.63 587 Q F9 .301
(Recall our implementation of Posix message queues using)183.6 607 R F10(mmap)
2.302 E F9 .302(and the storing of values into)2.302 F(a)183.6 617 Q F10
(msg_hdr)2.008 E F9(str)2.008 E(uctur)-.064 E 2.008(ei)-.144 G 2.008(nF)261.304
617 S(igur)272.416 617 Q 2.008(e5)-.144 G .008
(.30 and the fetching of values fr)296.872 617 R .007(om a)-.144 F F10(msg_hdr)
2.007 E F9(str)2.007 E(uctur)-.064 E 2.007(ei)-.144 G 2.007(nF)499.049 617 S
(ig-)510.16 617 Q(ur)183.6 627 Q 2(e5)-.144 G(.32.)201.272 627 Q EP
%%Page: 311 9
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF(Section 12.3)93.6 82 Q(Incr)294.978 82 Q 2.25
(ement Counter in a Memory-Mapped File)-.162 F/F1 9/Palatino-Bold@0 SF(31)
506.433 82 Q(1)-.333 E .32 LW 97.6 89.2 93.6 89.2 DL 99.6 89.2 95.6 89.2 DL
103.6 89.2 99.6 89.2 DL 107.6 89.2 103.6 89.2 DL 111.6 89.2 107.6 89.2 DL 115.6
89.2 111.6 89.2 DL 119.6 89.2 115.6 89.2 DL 123.6 89.2 119.6 89.2 DL 127.6 89.2
123.6 89.2 DL 131.6 89.2 127.6 89.2 DL 135.6 89.2 131.6 89.2 DL 139.6 89.2
135.6 89.2 DL 143.6 89.2 139.6 89.2 DL 147.6 89.2 143.6 89.2 DL 151.6 89.2
147.6 89.2 DL 155.6 89.2 151.6 89.2 DL 159.6 89.2 155.6 89.2 DL 163.6 89.2
159.6 89.2 DL 167.6 89.2 163.6 89.2 DL 171.6 89.2 167.6 89.2 DL 175.6 89.2
171.6 89.2 DL 179.6 89.2 175.6 89.2 DL 183.6 89.2 179.6 89.2 DL 187.6 89.2
183.6 89.2 DL 191.6 89.2 187.6 89.2 DL 195.6 89.2 191.6 89.2 DL 199.6 89.2
195.6 89.2 DL 203.6 89.2 199.6 89.2 DL 207.6 89.2 203.6 89.2 DL 211.6 89.2
207.6 89.2 DL 215.6 89.2 211.6 89.2 DL 219.6 89.2 215.6 89.2 DL 223.6 89.2
219.6 89.2 DL 227.6 89.2 223.6 89.2 DL 231.6 89.2 227.6 89.2 DL 235.6 89.2
231.6 89.2 DL 239.6 89.2 235.6 89.2 DL 243.6 89.2 239.6 89.2 DL 247.6 89.2
243.6 89.2 DL 251.6 89.2 247.6 89.2 DL 255.6 89.2 251.6 89.2 DL 259.6 89.2
255.6 89.2 DL 263.6 89.2 259.6 89.2 DL 267.6 89.2 263.6 89.2 DL 271.6 89.2
267.6 89.2 DL 275.6 89.2 271.6 89.2 DL 279.6 89.2 275.6 89.2 DL 283.6 89.2
279.6 89.2 DL 287.6 89.2 283.6 89.2 DL 291.6 89.2 287.6 89.2 DL 295.6 89.2
291.6 89.2 DL 299.6 89.2 295.6 89.2 DL 303.6 89.2 299.6 89.2 DL 307.6 89.2
303.6 89.2 DL 311.6 89.2 307.6 89.2 DL 315.6 89.2 311.6 89.2 DL 319.6 89.2
315.6 89.2 DL 323.6 89.2 319.6 89.2 DL 327.6 89.2 323.6 89.2 DL 331.6 89.2
327.6 89.2 DL 335.6 89.2 331.6 89.2 DL 339.6 89.2 335.6 89.2 DL 343.6 89.2
339.6 89.2 DL 347.6 89.2 343.6 89.2 DL 351.6 89.2 347.6 89.2 DL 355.6 89.2
351.6 89.2 DL 359.6 89.2 355.6 89.2 DL 363.6 89.2 359.6 89.2 DL 367.6 89.2
363.6 89.2 DL 371.6 89.2 367.6 89.2 DL 375.6 89.2 371.6 89.2 DL 379.6 89.2
375.6 89.2 DL 383.6 89.2 379.6 89.2 DL 387.6 89.2 383.6 89.2 DL 391.6 89.2
387.6 89.2 DL 395.6 89.2 391.6 89.2 DL 399.6 89.2 395.6 89.2 DL 403.6 89.2
399.6 89.2 DL 407.6 89.2 403.6 89.2 DL 411.6 89.2 407.6 89.2 DL 415.6 89.2
411.6 89.2 DL 419.6 89.2 415.6 89.2 DL 423.6 89.2 419.6 89.2 DL 427.6 89.2
423.6 89.2 DL 431.6 89.2 427.6 89.2 DL 435.6 89.2 431.6 89.2 DL 439.6 89.2
435.6 89.2 DL 443.6 89.2 439.6 89.2 DL 447.6 89.2 443.6 89.2 DL 451.6 89.2
447.6 89.2 DL 455.6 89.2 451.6 89.2 DL 459.6 89.2 455.6 89.2 DL 463.6 89.2
459.6 89.2 DL 467.6 89.2 463.6 89.2 DL 471.6 89.2 467.6 89.2 DL 475.6 89.2
471.6 89.2 DL 479.6 89.2 475.6 89.2 DL 483.6 89.2 479.6 89.2 DL 487.6 89.2
483.6 89.2 DL 491.6 89.2 487.6 89.2 DL 495.6 89.2 491.6 89.2 DL 499.6 89.2
495.6 89.2 DL 503.6 89.2 499.6 89.2 DL 507.6 89.2 503.6 89.2 DL 511.6 89.2
507.6 89.2 DL 515.6 89.2 511.6 89.2 DL 519.6 89.2 515.6 89.2 DL/F2 10
/Palatino-Roman@0 SF(Bewar)147.6 123 Q 2.815(eo)-.18 G 2.815(fs)188.675 123 S
.315(ome caveats, however)199.06 123 R 2.815(,i)-.74 G 2.815(nt)304.935 123 S
.315(hat not all \214les can be memory mapped.)316.83 123 R -.9(Tr)5.315 G(y-)
.9 E .827(ing to map a descriptor that r)129.6 135 R .826
(efers to a terminal or a socket, for example, generates an)-.18 F(err)129.6
147 Q 1.043(or r)-.18 F 1.043(eturn fr)-.18 F(om)-.18 E/F3 10/Courier@0 SF
(mmap)3.544 E F2 6.044(.T)C 1.044
(hese types of descriptors must be accessed using)249.834 147 R F3(read)3.544 E
F2(and)3.544 E F3(write)129.6 159 Q F2(\(or variants ther)2.5 E -1.667(eof \).)
-.18 F .299(Another use of)147.6 171 R F3(mmap)2.799 E F2 .298(is to pr)2.799 F
.298(ovide shar)-.18 F .298(ed memory between unr)-.18 F .298(elated pr)-.18 F
2.798(ocesses. In)-.18 F .231(this case, the actual contents of the \214le bec\
ome the initial contents of the memory that is)129.6 183 R(shar)129.6 195 Q
.504(ed, and any changes made by the pr)-.18 F .503(ocesses to this shar)-.18 F
.503(ed memory ar)-.18 F 3.003(et)-.18 G .503(hen copied)470.447 195 R 1.354
(back to the \214le \(pr)129.6 207 R 1.354(oviding \214lesystem persistence\).)
-.18 F 1.355(This assumes that)6.355 F F3(MAP_SHARED)3.855 E F2(is)3.855 E
(speci\214ed, which is r)129.6 219 Q(equir)-.18 E(ed to shar)-.18 E 2.5(et)-.18
G(he memory between pr)294.29 219 Q(ocesses.)-.18 E/F4 8/Palatino-Roman@0 SF
1.435(Details on the implementation of)183.6 239 R/F5 8/Courier@0 SF(mmap)3.435
E F4 1.434(and its r)3.435 F 1.434(elationship to the kernel's virtual memory)
-.144 F .221(algorithms ar)183.6 249 R 2.221(ep)-.144 G -.144(ro)242.05 249 S
.221(vided in [McKusick et al. 1996] for 4.4BSD and in).144 F([)2.222 -.32 M
-.736(Va).32 K .222(halia 1996).736 F(])-.32 I(and)2.222 .32 M([)2.222 -.32 M
(Good-).32 I(heart and Cox 1994)183.6 259 Q(])-.32 I(for SVR4.)2 .32 M/F6 12
/Helvetica-Bold@0 SF 9.312(12.3 Increment)93.6 295 R 3.336(Counter in a Memor)
6.672 F 3.336(y-Mapped File).12 F F2 2.71 -.92(We n)129.6 319 T .87
(ow modify Figur).92 F 3.37(e1)-.18 G .87
(2.3 \(which did not work\) so that the par)242.39 319 R .87
(ent and child shar)-.18 F 3.37(ea)-.18 G .984
(piece of memory in which the counter is stor)129.6 331 R 3.484(ed. T)-.18 F
3.484(od)-.92 G 3.484(os)373.83 331 S .984(o, we use a memory-mapped)387.014
331 R .637(\214le: a \214le that we)129.6 343 R F3(open)3.137 E F2 .637
(and then)3.137 F F3(mmap)3.137 E F2 .637(into our addr)3.137 F .637
(ess space.)-.18 F(Figur)5.637 E 3.137(e1)-.18 G .636(2.10 shows the)453.858
343 R(new pr)129.6 355 Q(ogram.)-.18 E/F7 9/Helvetica-Bold@0 SF(Ne)129.6 371 Q
2.502(wc)-.135 G(ommand)155.475 371 Q(-)-.81 I(line ar).81 I(gument)-.135 E/F8
7/Courier-Oblique@0 SF(11\21114)104.28 386 Q F2 2.137 -.92(We h)147.6 386 T
.297(ave a new command).92 F(-)-.9 I .297(line ar).9 J .298
(gument that is the name of a \214le that will be mem-)-.18 F 1.257
(ory mapped.)129.6 398 R 3.097 -.92(We o)6.257 H 1.257(pen the \214le for r).92
F 1.257(eading and writing, cr)-.18 F 1.257(eating the \214le if it does not)
-.18 F(exist, and then write an integer with a value of 0 to the \214le.)129.6
410 Q/F9 9/Courier-Bold@0 SF(mmap)129.6 426 Q F7(then c)2.502 E
(lose descriptor)-.18 E F8(15\21116)104.28 441 Q F2 2.446 -.92(We c)147.6 441 T
(all).92 E F3(mmap)3.106 E F2 .607
(to map the \214le that was just opened into the memory of this pr)3.107 F
(ocess.)-.18 E .464(The \214rst ar)129.6 453 R .464(gument is a null pointer)
-.18 F 2.964(,t)-.74 G .464(elling the system to pick the starting addr)294.688
453 R 2.964(ess. The)-.18 F .162(length is the size of an integer)129.6 465 R
2.662(,a)-.74 G .162(nd we specify r)271.804 465 R .162(ead\211write access.)
-.18 F .162(By specifying a fourth)5.162 F(ar)129.6 477 Q .97(gument of)-.18 F
F3(MAP_SHARED)3.47 E F2 3.47(,a)C .97(ny changes made by the par)259.36 477 R
.97(ent will be seen by the child,)-.18 F .555(and vice versa.)129.6 489 R .555
(The r)5.555 F .555(eturn value is the starting addr)-.18 F .556
(ess of the memory r)-.18 F .556(egion that will)-.18 F(be shar)129.6 501 Q
(ed, and we stor)-.18 E 2.5(ei)-.18 G 2.5(ti)239.14 501 S(n)247.81 501 Q F3
(ptr)2.5 E F2(.)A F9(fork)129.6 517 Q F8(20\21134)104.28 532 Q F2 2.133 -.92
(We s)147.6 532 T .293(et standar).92 F 2.793(do)-.18 G .293(utput unbuf)
226.909 532 R(fer)-.18 E .292(ed and call)-.18 F F3(fork)2.792 E F2 5.292(.T)C
.292(he par)382.13 532 R .292(ent and child both incr)-.18 F(e-)-.18 E
(ment the integer counter pointed to by)129.6 544 Q F3(ptr)2.5 E F2(.)A 1.653
(Memory-mapped \214les ar)147.6 556 R 4.153(eh)-.18 G 1.653
(andled specially by)275.559 556 R F3(fork)4.153 E F2 4.153(,i)C 4.153(nt)
402.181 556 S 1.653(hat memory mappings)415.414 556 R(cr)129.6 568 Q .848
(eated by the par)-.18 F .848(ent befor)-.18 F 3.348(ec)-.18 G(alling)264.22
568 Q F3(fork)3.348 E F2(ar)3.348 E 3.348(es)-.18 G(har)341.174 568 Q .848
(ed by the child.)-.18 F(Ther)5.848 E(efor)-.18 E .847(e, what we)-.18 F .387
(have done by opening the \214le and calling)129.6 580 R F3(mmap)2.887 E F2
.387(with the)2.887 F F3(MAP_SHARED)2.888 E F2 .388(\215ag is pr)2.888 F .388
(ovide a)-.18 F 1.184(piece of memory that is shar)129.6 592 R 1.184
(ed between the par)-.18 F 1.184(ent and child.)-.18 F(Furthermor)6.184 E 1.183
(e, since the)-.18 F(shar)129.6 604 Q .194
(ed memory is a memory-mapped \214le, any changes to the shar)-.18 F .194
(ed memory \(the piece)-.18 F .458(of memory pointed to by)129.6 616 R F3(ptr)
2.958 E F2 .458(of size)2.958 F F3(sizeof\(int\))2.958 E F2 2.958(\)a)C .818
-.18(re a)374.662 616 T .458(lso r).18 F .458(e\215ected in the actual \214le)
-.18 F(\(whose name was speci\214ed by the command)129.6 628 Q(-)-.9 I(line ar)
.9 I(gument\).)-.18 E EP
%%Page: 312 10
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(312)93.6 82 Q/F1 9/Palatino-Roman@0 SF(Shar)125.1 82 Q
2.25(ed Memory Intr)-.162 F 227.622(oduction Chapter)-.162 F(12)2.25 E .32 LW
97.6 89.2 93.6 89.2 DL 99.6 89.2 95.6 89.2 DL 103.6 89.2 99.6 89.2 DL 107.6
89.2 103.6 89.2 DL 111.6 89.2 107.6 89.2 DL 115.6 89.2 111.6 89.2 DL 119.6 89.2
115.6 89.2 DL 123.6 89.2 119.6 89.2 DL 127.6 89.2 123.6 89.2 DL 131.6 89.2
127.6 89.2 DL 135.6 89.2 131.6 89.2 DL 139.6 89.2 135.6 89.2 DL 143.6 89.2
139.6 89.2 DL 147.6 89.2 143.6 89.2 DL 151.6 89.2 147.6 89.2 DL 155.6 89.2
151.6 89.2 DL 159.6 89.2 155.6 89.2 DL 163.6 89.2 159.6 89.2 DL 167.6 89.2
163.6 89.2 DL 171.6 89.2 167.6 89.2 DL 175.6 89.2 171.6 89.2 DL 179.6 89.2
175.6 89.2 DL 183.6 89.2 179.6 89.2 DL 187.6 89.2 183.6 89.2 DL 191.6 89.2
187.6 89.2 DL 195.6 89.2 191.6 89.2 DL 199.6 89.2 195.6 89.2 DL 203.6 89.2
199.6 89.2 DL 207.6 89.2 203.6 89.2 DL 211.6 89.2 207.6 89.2 DL 215.6 89.2
211.6 89.2 DL 219.6 89.2 215.6 89.2 DL 223.6 89.2 219.6 89.2 DL 227.6 89.2
223.6 89.2 DL 231.6 89.2 227.6 89.2 DL 235.6 89.2 231.6 89.2 DL 239.6 89.2
235.6 89.2 DL 243.6 89.2 239.6 89.2 DL 247.6 89.2 243.6 89.2 DL 251.6 89.2
247.6 89.2 DL 255.6 89.2 251.6 89.2 DL 259.6 89.2 255.6 89.2 DL 263.6 89.2
259.6 89.2 DL 267.6 89.2 263.6 89.2 DL 271.6 89.2 267.6 89.2 DL 275.6 89.2
271.6 89.2 DL 279.6 89.2 275.6 89.2 DL 283.6 89.2 279.6 89.2 DL 287.6 89.2
283.6 89.2 DL 291.6 89.2 287.6 89.2 DL 295.6 89.2 291.6 89.2 DL 299.6 89.2
295.6 89.2 DL 303.6 89.2 299.6 89.2 DL 307.6 89.2 303.6 89.2 DL 311.6 89.2
307.6 89.2 DL 315.6 89.2 311.6 89.2 DL 319.6 89.2 315.6 89.2 DL 323.6 89.2
319.6 89.2 DL 327.6 89.2 323.6 89.2 DL 331.6 89.2 327.6 89.2 DL 335.6 89.2
331.6 89.2 DL 339.6 89.2 335.6 89.2 DL 343.6 89.2 339.6 89.2 DL 347.6 89.2
343.6 89.2 DL 351.6 89.2 347.6 89.2 DL 355.6 89.2 351.6 89.2 DL 359.6 89.2
355.6 89.2 DL 363.6 89.2 359.6 89.2 DL 367.6 89.2 363.6 89.2 DL 371.6 89.2
367.6 89.2 DL 375.6 89.2 371.6 89.2 DL 379.6 89.2 375.6 89.2 DL 383.6 89.2
379.6 89.2 DL 387.6 89.2 383.6 89.2 DL 391.6 89.2 387.6 89.2 DL 395.6 89.2
391.6 89.2 DL 399.6 89.2 395.6 89.2 DL 403.6 89.2 399.6 89.2 DL 407.6 89.2
403.6 89.2 DL 411.6 89.2 407.6 89.2 DL 415.6 89.2 411.6 89.2 DL 419.6 89.2
415.6 89.2 DL 423.6 89.2 419.6 89.2 DL 427.6 89.2 423.6 89.2 DL 431.6 89.2
427.6 89.2 DL 435.6 89.2 431.6 89.2 DL 439.6 89.2 435.6 89.2 DL 443.6 89.2
439.6 89.2 DL 447.6 89.2 443.6 89.2 DL 451.6 89.2 447.6 89.2 DL 455.6 89.2
451.6 89.2 DL 459.6 89.2 455.6 89.2 DL 463.6 89.2 459.6 89.2 DL 467.6 89.2
463.6 89.2 DL 471.6 89.2 467.6 89.2 DL 475.6 89.2 471.6 89.2 DL 479.6 89.2
475.6 89.2 DL 483.6 89.2 479.6 89.2 DL 487.6 89.2 483.6 89.2 DL 491.6 89.2
487.6 89.2 DL 495.6 89.2 491.6 89.2 DL 499.6 89.2 495.6 89.2 DL 503.6 89.2
499.6 89.2 DL 507.6 89.2 503.6 89.2 DL 511.6 89.2 507.6 89.2 DL 515.6 89.2
511.6 89.2 DL 519.6 89.2 515.6 89.2 DL .4 LW 134.6 123 129.6 123 DL 138.1 123
133.1 123 DL 143.1 123 138.1 123 DL 148.1 123 143.1 123 DL 153.1 123 148.1 123
DL 158.1 123 153.1 123 DL 163.1 123 158.1 123 DL 168.1 123 163.1 123 DL 173.1
123 168.1 123 DL 178.1 123 173.1 123 DL 183.1 123 178.1 123 DL 188.1 123 183.1
123 DL 193.1 123 188.1 123 DL 198.1 123 193.1 123 DL 203.1 123 198.1 123 DL
208.1 123 203.1 123 DL 213.1 123 208.1 123 DL 218.1 123 213.1 123 DL 223.1 123
218.1 123 DL 228.1 123 223.1 123 DL 233.1 123 228.1 123 DL 238.1 123 233.1 123
DL 243.1 123 238.1 123 DL 248.1 123 243.1 123 DL 253.1 123 248.1 123 DL 258.1
123 253.1 123 DL 263.1 123 258.1 123 DL 268.1 123 263.1 123 DL 273.1 123 268.1
123 DL 278.1 123 273.1 123 DL 283.1 123 278.1 123 DL 288.1 123 283.1 123 DL
293.1 123 288.1 123 DL 298.1 123 293.1 123 DL 303.1 123 298.1 123 DL 308.1 123
303.1 123 DL 313.1 123 308.1 123 DL 318.1 123 313.1 123 DL 323.1 123 318.1 123
DL 328.1 123 323.1 123 DL 333.1 123 328.1 123 DL 338.1 123 333.1 123 DL 343.1
123 338.1 123 DL 348.1 123 343.1 123 DL 353.1 123 348.1 123 DL 358.1 123 353.1
123 DL 363.1 123 358.1 123 DL 368.1 123 363.1 123 DL 373.1 123 368.1 123 DL
378.1 123 373.1 123 DL 383.1 123 378.1 123 DL 388.1 123 383.1 123 DL 393.1 123
388.1 123 DL 398.1 123 393.1 123 DL 403.1 123 398.1 123 DL 408.1 123 403.1 123
DL 413.1 123 408.1 123 DL 418.1 123 413.1 123 DL 423.1 123 418.1 123 DL 428.1
123 423.1 123 DL 433.1 123 428.1 123 DL 438.1 123 433.1 123 DL 443.1 123 438.1
123 DL 448.1 123 443.1 123 DL 453.1 123 448.1 123 DL 458.1 123 453.1 123 DL
463.1 123 458.1 123 DL 468.1 123 463.1 123 DL 473.1 123 468.1 123 DL/F2 9
/Palatino-Italic@0 SF -1.5(shm / incr2.c)475.35 125.5 R/F3 8.15/Courier@0 SF
4.89(1#)134.49 131.801 S 14.67(include "unpipc.h")149.16 131.801 R 4.89(2#)
134.49 146.801 S(define SEM_NAME)149.16 146.801 Q("mysem")242.07 146.801 Q 4.89
(3i)134.49 161.801 S(nt)149.16 161.801 Q 4.89(4m)134.49 171.801 S
(ain\(int argc, char **argv\))149.16 171.801 Q 4.89(5{)134.49 181.801 S 24.45
(6i)134.49 191.801 S 19.56(nt fd,)168.72 191.801 R(i, nloop, zero = 0;)4.89 E
24.45(7i)134.49 201.801 S 14.67(nt *ptr;)168.72 201.801 R 24.45(8s)134.49
211.801 S 4.89(em_t *mutex;)168.72 211.801 R 24.45(9i)134.49 226.801 S 4.89
(f\()168.72 226.801 S(argc != 3\))183.39 226.801 Q 39.12(10 err_quit\("usage:)
129.6 236.801 R(incr2 <pathname> <#loops>"\);)4.89 E 19.56(11 nloop)129.6
246.801 R 4.89(=a)4.89 G(toi\(argv[2]\);)207.84 246.801 Q 39.12(12 /*)129.6
261.801 R(open file, initialize to 0, map into memory */)4.89 E 19.56(13 fd)
129.6 271.801 R 4.89(=O)4.89 G(pen\(argv[1], O_RDWR | O_CREAT, FILE_MODE\);)
193.17 271.801 Q 19.56(14 Write\(fd,)129.6 281.801 R(&zero, sizeof\(int\)\);)
4.89 E 19.56(15 ptr)129.6 291.801 R 4.89(=M)4.89 G
(map\(NULL, sizeof\(int\), PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0\);)198.06
291.801 Q 19.56(16 Close\(fd\);)129.6 301.801 R 39.12(17 /*)129.6 316.801 R
(create, initialize, and unlink semaphore */)4.89 E 19.56(18 mutex)129.6
326.801 R 4.89(=S)4.89 G
(em_open\(Px_ipc_name\(SEM_NAME\), O_CREAT | O_EXCL, FILE_MODE, 1\);)207.84
326.801 Q 19.56(19 Sem_unlink\(Px_ipc_name\(SEM_NAME\)\);)129.6 336.801 R 19.56
(20 setbuf\(stdout,)129.6 351.801 R 29.34(NULL\); /*)4.89 F
(stdout is unbuffered */)4.89 E 19.56(21 if)129.6 361.801 R
(\(Fork\(\) == 0\) {)4.89 E(/* child */)300.75 361.801 Q 39.12(22 for)129.6
371.801 R(\(i = 0; i < nloop; i++\) {)4.89 E 58.68(23 Sem_wait\(mutex\);)129.6
381.801 R 58.68(24 printf\("child:)129.6 391.801 R(%d\\n", \(*ptr\)++\);)4.89 E
58.68(25 Sem_post\(mutex\);)129.6 401.801 R 39.12(26 })129.6 411.801 R 39.12
(27 exit\(0\);)129.6 421.801 R 19.56(28 })129.6 431.801 R 39.12(29 /*)129.6
441.801 R(parent */)4.89 E 19.56(30 for)129.6 451.801 R
(\(i = 0; i < nloop; i++\) {)4.89 E 39.12(31 Sem_wait\(mutex\);)129.6 461.801 R
39.12(32 printf\("parent:)129.6 471.801 R(%d\\n", \(*ptr\)++\);)4.89 E 39.12
(33 Sem_post\(mutex\);)129.6 481.801 R 19.56(34 })129.6 491.801 R 19.56
(35 exit\(0\);)129.6 501.801 R(36 })129.6 511.801 Q 134.6 516.602 129.6 516.602
DL 138.1 516.602 133.1 516.602 DL 143.1 516.602 138.1 516.602 DL 148.1 516.602
143.1 516.602 DL 153.1 516.602 148.1 516.602 DL 158.1 516.602 153.1 516.602 DL
163.1 516.602 158.1 516.602 DL 168.1 516.602 163.1 516.602 DL 173.1 516.602
168.1 516.602 DL 178.1 516.602 173.1 516.602 DL 183.1 516.602 178.1 516.602 DL
188.1 516.602 183.1 516.602 DL 193.1 516.602 188.1 516.602 DL 198.1 516.602
193.1 516.602 DL 203.1 516.602 198.1 516.602 DL 208.1 516.602 203.1 516.602 DL
213.1 516.602 208.1 516.602 DL 218.1 516.602 213.1 516.602 DL 223.1 516.602
218.1 516.602 DL 228.1 516.602 223.1 516.602 DL 233.1 516.602 228.1 516.602 DL
238.1 516.602 233.1 516.602 DL 243.1 516.602 238.1 516.602 DL 248.1 516.602
243.1 516.602 DL 253.1 516.602 248.1 516.602 DL 258.1 516.602 253.1 516.602 DL
263.1 516.602 258.1 516.602 DL 268.1 516.602 263.1 516.602 DL 273.1 516.602
268.1 516.602 DL 278.1 516.602 273.1 516.602 DL 283.1 516.602 278.1 516.602 DL
288.1 516.602 283.1 516.602 DL 293.1 516.602 288.1 516.602 DL 298.1 516.602
293.1 516.602 DL 303.1 516.602 298.1 516.602 DL 308.1 516.602 303.1 516.602 DL
313.1 516.602 308.1 516.602 DL 318.1 516.602 313.1 516.602 DL 323.1 516.602
318.1 516.602 DL 328.1 516.602 323.1 516.602 DL 333.1 516.602 328.1 516.602 DL
338.1 516.602 333.1 516.602 DL 343.1 516.602 338.1 516.602 DL 348.1 516.602
343.1 516.602 DL 353.1 516.602 348.1 516.602 DL 358.1 516.602 353.1 516.602 DL
363.1 516.602 358.1 516.602 DL 368.1 516.602 363.1 516.602 DL 373.1 516.602
368.1 516.602 DL 378.1 516.602 373.1 516.602 DL 383.1 516.602 378.1 516.602 DL
388.1 516.602 383.1 516.602 DL 393.1 516.602 388.1 516.602 DL 398.1 516.602
393.1 516.602 DL 403.1 516.602 398.1 516.602 DL 408.1 516.602 403.1 516.602 DL
413.1 516.602 408.1 516.602 DL 418.1 516.602 413.1 516.602 DL 423.1 516.602
418.1 516.602 DL 428.1 516.602 423.1 516.602 DL 433.1 516.602 428.1 516.602 DL
438.1 516.602 433.1 516.602 DL 443.1 516.602 438.1 516.602 DL 448.1 516.602
443.1 516.602 DL 453.1 516.602 448.1 516.602 DL 458.1 516.602 453.1 516.602 DL
463.1 516.602 458.1 516.602 DL 468.1 516.602 463.1 516.602 DL 473.1 516.602
468.1 516.602 DL F2 -1.5(shm / incr2.c)475.35 519.102 R/F4 8/Palatino-Bold@0 SF
(Figure 12.10)194.804 532.602 Q/F5 8/Palatino-Roman@0 SF(Par)6 E
(ent and child incr)-.144 E(ementing a counter in shar)-.144 E(ed memory)-.144
E(.)-.888 E/F6 10/Palatino-Roman@0 SF 1.244(If we execute this pr)147.6 556.602
R 1.245(ogram, we see that the memory pointed to by)-.18 F/F7 10/Courier@0 SF
(ptr)3.745 E F6 1.245(is indeed)3.745 F(shar)129.6 568.602 Q 2.876
(ed between the par)-.18 F 2.876(ent and child.)-.18 F 4.715 -.92(We s)7.875 H
2.875(how only the values when the kernel).92 F(switches between the two pr)
129.6 580.602 Q(ocesses.)-.18 E F3(solaris %)147.6 596.602 Q/F8 8.15
/Courier-Bold@0 SF(incr2 /tmp/temp.1 10000)4.89 E F3(child: 0)147.6 606.602 Q
/F9 8.15/Palatino-Italic@0 SF(child starts \214rst)255.6 606.602 Q F3(child: 1)
147.6 616.602 Q 4.89(...)147.6 626.602 S(child: 128)147.6 636.602 Q(child: 129)
147.6 646.602 Q(parent: 130)147.6 656.602 Q F9(child is stopped, par)255.6
656.602 Q(ent starts)-.147 E EP
%%Page: 313 11
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF(Section 12.3)93.6 82 Q(Incr)294.645 82 Q 2.25
(ement Counter in a Memory-Mapped File)-.162 F/F1 9/Palatino-Bold@0 SF(313)
506.1 82 Q .32 LW 97.6 89.2 93.6 89.2 DL 99.6 89.2 95.6 89.2 DL 103.6 89.2 99.6
89.2 DL 107.6 89.2 103.6 89.2 DL 111.6 89.2 107.6 89.2 DL 115.6 89.2 111.6 89.2
DL 119.6 89.2 115.6 89.2 DL 123.6 89.2 119.6 89.2 DL 127.6 89.2 123.6 89.2 DL
131.6 89.2 127.6 89.2 DL 135.6 89.2 131.6 89.2 DL 139.6 89.2 135.6 89.2 DL
143.6 89.2 139.6 89.2 DL 147.6 89.2 143.6 89.2 DL 151.6 89.2 147.6 89.2 DL
155.6 89.2 151.6 89.2 DL 159.6 89.2 155.6 89.2 DL 163.6 89.2 159.6 89.2 DL
167.6 89.2 163.6 89.2 DL 171.6 89.2 167.6 89.2 DL 175.6 89.2 171.6 89.2 DL
179.6 89.2 175.6 89.2 DL 183.6 89.2 179.6 89.2 DL 187.6 89.2 183.6 89.2 DL
191.6 89.2 187.6 89.2 DL 195.6 89.2 191.6 89.2 DL 199.6 89.2 195.6 89.2 DL
203.6 89.2 199.6 89.2 DL 207.6 89.2 203.6 89.2 DL 211.6 89.2 207.6 89.2 DL
215.6 89.2 211.6 89.2 DL 219.6 89.2 215.6 89.2 DL 223.6 89.2 219.6 89.2 DL
227.6 89.2 223.6 89.2 DL 231.6 89.2 227.6 89.2 DL 235.6 89.2 231.6 89.2 DL
239.6 89.2 235.6 89.2 DL 243.6 89.2 239.6 89.2 DL 247.6 89.2 243.6 89.2 DL
251.6 89.2 247.6 89.2 DL 255.6 89.2 251.6 89.2 DL 259.6 89.2 255.6 89.2 DL
263.6 89.2 259.6 89.2 DL 267.6 89.2 263.6 89.2 DL 271.6 89.2 267.6 89.2 DL
275.6 89.2 271.6 89.2 DL 279.6 89.2 275.6 89.2 DL 283.6 89.2 279.6 89.2 DL
287.6 89.2 283.6 89.2 DL 291.6 89.2 287.6 89.2 DL 295.6 89.2 291.6 89.2 DL
299.6 89.2 295.6 89.2 DL 303.6 89.2 299.6 89.2 DL 307.6 89.2 303.6 89.2 DL
311.6 89.2 307.6 89.2 DL 315.6 89.2 311.6 89.2 DL 319.6 89.2 315.6 89.2 DL
323.6 89.2 319.6 89.2 DL 327.6 89.2 323.6 89.2 DL 331.6 89.2 327.6 89.2 DL
335.6 89.2 331.6 89.2 DL 339.6 89.2 335.6 89.2 DL 343.6 89.2 339.6 89.2 DL
347.6 89.2 343.6 89.2 DL 351.6 89.2 347.6 89.2 DL 355.6 89.2 351.6 89.2 DL
359.6 89.2 355.6 89.2 DL 363.6 89.2 359.6 89.2 DL 367.6 89.2 363.6 89.2 DL
371.6 89.2 367.6 89.2 DL 375.6 89.2 371.6 89.2 DL 379.6 89.2 375.6 89.2 DL
383.6 89.2 379.6 89.2 DL 387.6 89.2 383.6 89.2 DL 391.6 89.2 387.6 89.2 DL
395.6 89.2 391.6 89.2 DL 399.6 89.2 395.6 89.2 DL 403.6 89.2 399.6 89.2 DL
407.6 89.2 403.6 89.2 DL 411.6 89.2 407.6 89.2 DL 415.6 89.2 411.6 89.2 DL
419.6 89.2 415.6 89.2 DL 423.6 89.2 419.6 89.2 DL 427.6 89.2 423.6 89.2 DL
431.6 89.2 427.6 89.2 DL 435.6 89.2 431.6 89.2 DL 439.6 89.2 435.6 89.2 DL
443.6 89.2 439.6 89.2 DL 447.6 89.2 443.6 89.2 DL 451.6 89.2 447.6 89.2 DL
455.6 89.2 451.6 89.2 DL 459.6 89.2 455.6 89.2 DL 463.6 89.2 459.6 89.2 DL
467.6 89.2 463.6 89.2 DL 471.6 89.2 467.6 89.2 DL 475.6 89.2 471.6 89.2 DL
479.6 89.2 475.6 89.2 DL 483.6 89.2 479.6 89.2 DL 487.6 89.2 483.6 89.2 DL
491.6 89.2 487.6 89.2 DL 495.6 89.2 491.6 89.2 DL 499.6 89.2 495.6 89.2 DL
503.6 89.2 499.6 89.2 DL 507.6 89.2 503.6 89.2 DL 511.6 89.2 507.6 89.2 DL
515.6 89.2 511.6 89.2 DL 519.6 89.2 515.6 89.2 DL/F2 8.15/Courier@0 SF
(parent: 131)147.6 121 Q 4.89(...)147.6 131 S(parent: 636)147.6 141 Q
(parent: 637)147.6 151 Q(child: 638)147.6 161 Q/F3 8.15/Palatino-Italic@0 SF
(par)255.6 161 Q(ent is stopped, child starts)-.147 E F2(child: 639)147.6 171 Q
4.89(...)147.6 181 S(child: 1517)147.6 191 Q(child: 1518)147.6 201 Q
(parent: 1519)147.6 211 Q F3(child is stopped, par)255.6 211 Q(ent starts)-.147
E F2(parent: 1520)147.6 221 Q 4.89(...)147.6 231 S(parent: 19999)147.6 241 Q F3
(\214nal line of output)255.6 241 Q F2(solaris %)147.6 251 Q/F4 8.15
/Courier-Bold@0 SF(od -D /tmp/temp.1)4.89 E F2(0000000 0000020000)147.6 261 Q
(0000004)147.6 271 Q/F5 10/Palatino-Roman@0 SF .275
(Since the \214le was memory mapped, we can look at the \214le after the pr)
129.6 289 R .276(ogram terminates)-.18 F .202(with the)129.6 301 R/F6 10
/Courier@0 SF(od)2.702 E F5(pr)2.702 E .201
(ogram and see that the \214nal value of the counter)-.18 F(\()2.701 -.4 M
(20,000).4 I(\))-.4 I .201(is indeed stor)2.701 .4 N(ed)-.18 E(in the \214le.)
129.6 313 Q(Figur)147.6 325 Q 2.572(e1)-.18 G(2.1)183.792 325 Q 2.572(1i)-.55 G
2.572(sam)206.224 325 S .072(odi\214cation of Figur)229.438 325 R 2.572(e1)-.18
G .072(2.5 showing the shar)326.984 325 R .073(ed memory)-.18 F 2.573(,a)-1.11
G .073(nd show-)477.907 325 R .782(ing that the semaphor)129.6 337 R 3.282(ei)
-.18 G 3.282(sa)239.848 337 S .781(lso shar)252.37 337 R 3.281(ed. W)-.18 F
3.281(es)-.92 G .781(how the semaphor)327.663 337 R 3.281(ea)-.18 G 3.281(sb)
424.706 337 S .781(eing in the kernel,)437.757 337 R 2.491
(but as we mentioned with Posix semaphor)129.6 349 R 2.491(es, this is not a r)
-.18 F(equir)-.18 E 4.991(ement. Whatever)-.18 F 2.511
(implementation is used, the semaphor)129.6 361 R 5.011(em)-.18 G 2.511
(ust have at least kernel persistence.)327.485 361 R(The)7.51 E(semaphor)129.6
373 Q 2.564(ec)-.18 G .064(ould be stor)185.314 373 R .064
(ed as another memory-mapped \214le, as we demonstrated in Sec-)-.18 F
(tion 10.15.)129.6 385 Q 310.2 534.2 MT 0 -100.8 RL -100.8 0 RL 0 100.8 RL CL
ST/F7 8/Courier@0 SF(int *ptr;)214.2 450.56 Q(if \(Fork\(\) == 0\) {)214.2
470.56 Q(/* child */)233.4 480.56 Q(...)233.4 490.56 Q(})214.2 500.56 Q
(/* parent */)214.2 520.56 Q(...)214.2 530.56 Q 519 534.2 MT 0 -100.8 RL -100.8
0 RL 0 100.8 RL CL ST(int *ptr;)423 450.56 Q(if \(Fork\(\) == 0\) {)423 470.56
Q(/* child */)442.2 480.56 Q(...)442.2 490.56 Q(})423 500.56 Q(/* parent */)423
520.56 Q(...)423 530.56 Q/F8 8/Palatino-Roman@0 SF(par)248.34 430.16 Q(ent)
-.144 E(child)459.724 430.16 Q 191.4 527 205.8 527 DL 205.8 527 MT -7.2 1.8 RL
0 -3.6 RL CL BL 205.8 527 MT -7.2 1.8 RL 0 -3.6 RL CL ST(par)112.936 528.76 Q
(ent executing her)-.144 E(e)-.144 E 400.2 487.4 414.6 487.4 DL 414.6 487.4 MT
-7.2 1.8 RL 0 -3.6 RL CL BL 414.6 487.4 MT -7.2 1.8 RL 0 -3.6 RL CL ST
(child executing her)326.904 489.16 Q(e)-.144 E 382.2 419 MT 0 -14.4 RL -36 0
RL 0 14.4 RL CL ST(count)354.196 413.56 Q(shar)336.34 401.36 Q(ed memory)-.144
E 382.2 591.8 MT 0 -14.4 RL -36 0 RL 0 14.4 RL CL ST 2(0o)354.436 586.36 S 2
(r1)364.804 586.36 S(semaphor)303.232 586.36 Q(e:)-.144 E 263.4 448.52 MT 34.2
0 RL 22.8 0 36.36 -4.68 40.68 -14.04 RC 6.48 -14.04 RL ST 344.76 420.44 MT
-1.368 7.272 RL -3.24 -1.512 RL CL BL 344.76 420.44 MT -1.368 7.272 RL -3.24
-1.512 RL CL ST 421.8 448.52 MT -30.6 0 RL -20.4 0 -32.76 -4.68 -37.08 -14.04
RC -6.48 -14.04 RL ST 347.64 420.44 MT 4.68 5.76 RL -3.24 1.512 RL CL BL 347.64
420.44 MT 4.68 5.76 RL -3.24 1.512 RL CL ST 213 555.8 209.4 555.8 DL 220.128
555.8 216.528 555.8 DL 227.256 555.8 223.656 555.8 DL 234.384 555.8 230.784
555.8 DL 241.44 555.8 237.84 555.8 DL 248.568 555.8 244.968 555.8 DL 255.696
555.8 252.096 555.8 DL 262.824 555.8 259.224 555.8 DL 269.952 555.8 266.352
555.8 DL 277.08 555.8 273.48 555.8 DL 284.136 555.8 280.536 555.8 DL 291.264
555.8 287.664 555.8 DL 298.392 555.8 294.792 555.8 DL 305.52 555.8 301.92 555.8
DL 312.648 555.8 309.048 555.8 DL 319.776 555.8 316.176 555.8 DL 326.832 555.8
323.232 555.8 DL 333.96 555.8 330.36 555.8 DL 341.088 555.8 337.488 555.8 DL
348.216 555.8 344.616 555.8 DL 355.344 555.8 351.744 555.8 DL 362.472 555.8
358.872 555.8 DL 369.528 555.8 365.928 555.8 DL 376.656 555.8 373.056 555.8 DL
383.784 555.8 380.184 555.8 DL 390.912 555.8 387.312 555.8 DL 398.04 555.8
394.44 555.8 DL 405.168 555.8 401.568 555.8 DL 412.224 555.8 408.624 555.8 DL
419.352 555.8 415.752 555.8 DL 426.48 555.8 422.88 555.8 DL 433.608 555.8
430.008 555.8 DL 440.736 555.8 437.136 555.8 DL 447.864 555.8 444.264 555.8 DL
454.92 555.8 451.32 555.8 DL 462.048 555.8 458.448 555.8 DL 469.176 555.8
465.576 555.8 DL 476.304 555.8 472.704 555.8 DL 483.432 555.8 479.832 555.8 DL
490.56 555.8 486.96 555.8 DL 497.616 555.8 494.016 555.8 DL 504.744 555.8
501.144 555.8 DL 511.872 555.8 508.272 555.8 DL 519 555.8 515.4 555.8 DL(pr)
492.64 552.56 Q(ocess)-.144 E(kernel)496.744 562.56 Q/F9 8/Palatino-Bold@0 SF
(Figure 12.1)208.304 609.8 Q(1)-.296 E F8(Par)6 E
(ent and child sharing memory and a semaphor)-.144 E(e.)-.144 E F5 3.089 -.92
(We s)129.6 633.8 T 1.249(how that the par).92 F 1.249
(ent and child each have their own copy of the pointer)-.18 F F6(ptr)3.748 E F5
3.748(,b)C(ut)510.31 633.8 Q .275(each copy points to the same integer in shar)
129.6 645.8 R .276(ed memory: the counter that both pr)-.18 F(ocesses)-.18 E
(incr)129.6 657.8 Q(ement.)-.18 E EP
%%Page: 314 12
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(314)93.6 82 Q/F1 9/Palatino-Roman@0 SF(Shar)125.1 82 Q
2.25(ed Memory Intr)-.162 F 227.622(oduction Chapter)-.162 F(12)2.25 E .32 LW
97.6 89.2 93.6 89.2 DL 99.6 89.2 95.6 89.2 DL 103.6 89.2 99.6 89.2 DL 107.6
89.2 103.6 89.2 DL 111.6 89.2 107.6 89.2 DL 115.6 89.2 111.6 89.2 DL 119.6 89.2
115.6 89.2 DL 123.6 89.2 119.6 89.2 DL 127.6 89.2 123.6 89.2 DL 131.6 89.2
127.6 89.2 DL 135.6 89.2 131.6 89.2 DL 139.6 89.2 135.6 89.2 DL 143.6 89.2
139.6 89.2 DL 147.6 89.2 143.6 89.2 DL 151.6 89.2 147.6 89.2 DL 155.6 89.2
151.6 89.2 DL 159.6 89.2 155.6 89.2 DL 163.6 89.2 159.6 89.2 DL 167.6 89.2
163.6 89.2 DL 171.6 89.2 167.6 89.2 DL 175.6 89.2 171.6 89.2 DL 179.6 89.2
175.6 89.2 DL 183.6 89.2 179.6 89.2 DL 187.6 89.2 183.6 89.2 DL 191.6 89.2
187.6 89.2 DL 195.6 89.2 191.6 89.2 DL 199.6 89.2 195.6 89.2 DL 203.6 89.2
199.6 89.2 DL 207.6 89.2 203.6 89.2 DL 211.6 89.2 207.6 89.2 DL 215.6 89.2
211.6 89.2 DL 219.6 89.2 215.6 89.2 DL 223.6 89.2 219.6 89.2 DL 227.6 89.2
223.6 89.2 DL 231.6 89.2 227.6 89.2 DL 235.6 89.2 231.6 89.2 DL 239.6 89.2
235.6 89.2 DL 243.6 89.2 239.6 89.2 DL 247.6 89.2 243.6 89.2 DL 251.6 89.2
247.6 89.2 DL 255.6 89.2 251.6 89.2 DL 259.6 89.2 255.6 89.2 DL 263.6 89.2
259.6 89.2 DL 267.6 89.2 263.6 89.2 DL 271.6 89.2 267.6 89.2 DL 275.6 89.2
271.6 89.2 DL 279.6 89.2 275.6 89.2 DL 283.6 89.2 279.6 89.2 DL 287.6 89.2
283.6 89.2 DL 291.6 89.2 287.6 89.2 DL 295.6 89.2 291.6 89.2 DL 299.6 89.2
295.6 89.2 DL 303.6 89.2 299.6 89.2 DL 307.6 89.2 303.6 89.2 DL 311.6 89.2
307.6 89.2 DL 315.6 89.2 311.6 89.2 DL 319.6 89.2 315.6 89.2 DL 323.6 89.2
319.6 89.2 DL 327.6 89.2 323.6 89.2 DL 331.6 89.2 327.6 89.2 DL 335.6 89.2
331.6 89.2 DL 339.6 89.2 335.6 89.2 DL 343.6 89.2 339.6 89.2 DL 347.6 89.2
343.6 89.2 DL 351.6 89.2 347.6 89.2 DL 355.6 89.2 351.6 89.2 DL 359.6 89.2
355.6 89.2 DL 363.6 89.2 359.6 89.2 DL 367.6 89.2 363.6 89.2 DL 371.6 89.2
367.6 89.2 DL 375.6 89.2 371.6 89.2 DL 379.6 89.2 375.6 89.2 DL 383.6 89.2
379.6 89.2 DL 387.6 89.2 383.6 89.2 DL 391.6 89.2 387.6 89.2 DL 395.6 89.2
391.6 89.2 DL 399.6 89.2 395.6 89.2 DL 403.6 89.2 399.6 89.2 DL 407.6 89.2
403.6 89.2 DL 411.6 89.2 407.6 89.2 DL 415.6 89.2 411.6 89.2 DL 419.6 89.2
415.6 89.2 DL 423.6 89.2 419.6 89.2 DL 427.6 89.2 423.6 89.2 DL 431.6 89.2
427.6 89.2 DL 435.6 89.2 431.6 89.2 DL 439.6 89.2 435.6 89.2 DL 443.6 89.2
439.6 89.2 DL 447.6 89.2 443.6 89.2 DL 451.6 89.2 447.6 89.2 DL 455.6 89.2
451.6 89.2 DL 459.6 89.2 455.6 89.2 DL 463.6 89.2 459.6 89.2 DL 467.6 89.2
463.6 89.2 DL 471.6 89.2 467.6 89.2 DL 475.6 89.2 471.6 89.2 DL 479.6 89.2
475.6 89.2 DL 483.6 89.2 479.6 89.2 DL 487.6 89.2 483.6 89.2 DL 491.6 89.2
487.6 89.2 DL 495.6 89.2 491.6 89.2 DL 499.6 89.2 495.6 89.2 DL 503.6 89.2
499.6 89.2 DL 507.6 89.2 503.6 89.2 DL 511.6 89.2 507.6 89.2 DL 515.6 89.2
511.6 89.2 DL 519.6 89.2 515.6 89.2 DL/F2 10/Palatino-Roman@0 SF 4.405 -.92
(We n)147.6 123 T 2.564(ow modify our pr).92 F 2.564(ogram fr)-.18 F 2.564
(om Figur)-.18 F 5.064(e1)-.18 G 2.564(2.10 to use a Posix memory-based)357.77
123 R(semaphor)129.6 135 Q 2.621(ei)-.18 G .121
(nstead of a Posix named semaphor)183.841 135 R .122(e, and stor)-.18 F 2.622
(et)-.18 G .122(his semaphor)395.102 135 R 2.622(ei)-.18 G 2.622(nt)464.936 135
S .122(he shar)476.638 135 R(ed)-.18 E(memory)129.6 147 Q 5(.F)-1.11 G(igur)
178.97 147 Q 2.5(e1)-.18 G(2.12 is the new pr)209.53 147 Q(ogram.)-.18 E .4 LW
134.6 160.2 129.6 160.2 DL 138.1 160.2 133.1 160.2 DL 143.1 160.2 138.1 160.2
DL 148.1 160.2 143.1 160.2 DL 153.1 160.2 148.1 160.2 DL 158.1 160.2 153.1
160.2 DL 163.1 160.2 158.1 160.2 DL 168.1 160.2 163.1 160.2 DL 173.1 160.2
168.1 160.2 DL 178.1 160.2 173.1 160.2 DL 183.1 160.2 178.1 160.2 DL 188.1
160.2 183.1 160.2 DL 193.1 160.2 188.1 160.2 DL 198.1 160.2 193.1 160.2 DL
203.1 160.2 198.1 160.2 DL 208.1 160.2 203.1 160.2 DL 213.1 160.2 208.1 160.2
DL 218.1 160.2 213.1 160.2 DL 223.1 160.2 218.1 160.2 DL 228.1 160.2 223.1
160.2 DL 233.1 160.2 228.1 160.2 DL 238.1 160.2 233.1 160.2 DL 243.1 160.2
238.1 160.2 DL 248.1 160.2 243.1 160.2 DL 253.1 160.2 248.1 160.2 DL 258.1
160.2 253.1 160.2 DL 263.1 160.2 258.1 160.2 DL 268.1 160.2 263.1 160.2 DL
273.1 160.2 268.1 160.2 DL 278.1 160.2 273.1 160.2 DL 283.1 160.2 278.1 160.2
DL 288.1 160.2 283.1 160.2 DL 293.1 160.2 288.1 160.2 DL 298.1 160.2 293.1
160.2 DL 303.1 160.2 298.1 160.2 DL 308.1 160.2 303.1 160.2 DL 313.1 160.2
308.1 160.2 DL 318.1 160.2 313.1 160.2 DL 323.1 160.2 318.1 160.2 DL 328.1
160.2 323.1 160.2 DL 333.1 160.2 328.1 160.2 DL 338.1 160.2 333.1 160.2 DL
343.1 160.2 338.1 160.2 DL 348.1 160.2 343.1 160.2 DL 353.1 160.2 348.1 160.2
DL 358.1 160.2 353.1 160.2 DL 363.1 160.2 358.1 160.2 DL 368.1 160.2 363.1
160.2 DL 373.1 160.2 368.1 160.2 DL 378.1 160.2 373.1 160.2 DL 383.1 160.2
378.1 160.2 DL 388.1 160.2 383.1 160.2 DL 393.1 160.2 388.1 160.2 DL 398.1
160.2 393.1 160.2 DL 403.1 160.2 398.1 160.2 DL 408.1 160.2 403.1 160.2 DL
413.1 160.2 408.1 160.2 DL 418.1 160.2 413.1 160.2 DL 423.1 160.2 418.1 160.2
DL 428.1 160.2 423.1 160.2 DL 433.1 160.2 428.1 160.2 DL 438.1 160.2 433.1
160.2 DL 443.1 160.2 438.1 160.2 DL 448.1 160.2 443.1 160.2 DL 453.1 160.2
448.1 160.2 DL 458.1 160.2 453.1 160.2 DL 463.1 160.2 458.1 160.2 DL 468.1
160.2 463.1 160.2 DL 473.1 160.2 468.1 160.2 DL/F3 9/Palatino-Italic@0 SF -1.5
(shm / incr3.c)475.35 162.7 R/F4 8.15/Courier@0 SF 4.89(1#)134.49 169.001 S
14.67(include "unpipc.h")149.16 169.001 R 4.89(2s)134.49 186.001 S
(truct shared {)149.16 186.001 Q 24.45(3s)134.49 196.001 S 9.78(em_t mutex;)
168.72 196.001 R(/* the mutex: a Posix memory-based semaphore */)300.75 196.001
Q 24.45(4i)134.49 206.001 S 19.56(nt count;)168.72 206.001 R
(/* and the counter */)300.75 206.001 Q 4.89(5}s)134.49 216.001 S(hared;)158.94
216.001 Q 4.89(6i)134.49 233.001 S(nt)149.16 233.001 Q 4.89(7m)134.49 243.001 S
(ain\(int argc, char **argv\))149.16 243.001 Q 4.89(8{)134.49 253.001 S 24.45
(9i)134.49 263.001 S 19.56(nt fd,)168.72 263.001 R(i, nloop;)4.89 E 19.56
(10 struct)129.6 273.001 R(shared *ptr;)4.89 E 19.56(11 if)129.6 290.001 R
(\(argc != 3\))4.89 E 39.12(12 err_quit\("usage:)129.6 300.001 R
(incr3 <pathname> <#loops>"\);)4.89 E 19.56(13 nloop)129.6 310.001 R 4.89(=a)
4.89 G(toi\(argv[2]\);)207.84 310.001 Q 39.12(14 /*)129.6 327.001 R
(open file, initialize to 0, map into memory */)4.89 E 19.56(15 fd)129.6
337.001 R 4.89(=O)4.89 G(pen\(argv[1], O_RDWR | O_CREAT, FILE_MODE\);)193.17
337.001 Q 19.56(16 Write\(fd,)129.6 347.001 R
(&shared, sizeof\(struct shared\)\);)4.89 E 19.56(17 ptr)129.6 357.001 R 4.89
(=M)4.89 G(map\(NULL, sizeof\(struct shared\), PROT_READ | PROT_WRITE,)198.06
357.001 Q 73.35(18 MAP_SHARED,)129.6 367.001 R(fd, 0\);)4.89 E 19.56
(19 Close\(fd\);)129.6 377.001 R 39.12(20 /*)129.6 394.001 R
(initialize semaphore that is shared between processes */)4.89 E 19.56
(21 Sem_init\(&ptr->mutex,)129.6 404.001 R(1, 1\);)4.89 E 19.56
(22 setbuf\(stdout,)129.6 421.001 R 29.34(NULL\); /*)4.89 F
(stdout is unbuffered */)4.89 E 19.56(23 if)129.6 431.001 R
(\(Fork\(\) == 0\) {)4.89 E(/* child */)300.75 431.001 Q 39.12(24 for)129.6
441.001 R(\(i = 0; i < nloop; i++\) {)4.89 E 58.68(25 Sem_wait\(&ptr->mutex\);)
129.6 451.001 R 58.68(26 printf\("child:)129.6 461.001 R
(%d\\n", ptr->count++\);)4.89 E 58.68(27 Sem_post\(&ptr->mutex\);)129.6 471.001
R 39.12(28 })129.6 481.001 R 39.12(29 exit\(0\);)129.6 491.001 R 19.56(30 })
129.6 501.001 R 39.12(31 /*)129.6 511.001 R(parent */)4.89 E 19.56(32 for)129.6
521.001 R(\(i = 0; i < nloop; i++\) {)4.89 E 39.12(33 Sem_wait\(&ptr->mutex\);)
129.6 531.001 R 39.12(34 printf\("parent:)129.6 541.001 R
(%d\\n", ptr->count++\);)4.89 E 39.12(35 Sem_post\(&ptr->mutex\);)129.6 551.001
R 19.56(36 })129.6 561.001 R 19.56(37 exit\(0\);)129.6 571.001 R(38 })129.6
581.001 Q 134.6 585.802 129.6 585.802 DL 138.1 585.802 133.1 585.802 DL 143.1
585.802 138.1 585.802 DL 148.1 585.802 143.1 585.802 DL 153.1 585.802 148.1
585.802 DL 158.1 585.802 153.1 585.802 DL 163.1 585.802 158.1 585.802 DL 168.1
585.802 163.1 585.802 DL 173.1 585.802 168.1 585.802 DL 178.1 585.802 173.1
585.802 DL 183.1 585.802 178.1 585.802 DL 188.1 585.802 183.1 585.802 DL 193.1
585.802 188.1 585.802 DL 198.1 585.802 193.1 585.802 DL 203.1 585.802 198.1
585.802 DL 208.1 585.802 203.1 585.802 DL 213.1 585.802 208.1 585.802 DL 218.1
585.802 213.1 585.802 DL 223.1 585.802 218.1 585.802 DL 228.1 585.802 223.1
585.802 DL 233.1 585.802 228.1 585.802 DL 238.1 585.802 233.1 585.802 DL 243.1
585.802 238.1 585.802 DL 248.1 585.802 243.1 585.802 DL 253.1 585.802 248.1
585.802 DL 258.1 585.802 253.1 585.802 DL 263.1 585.802 258.1 585.802 DL 268.1
585.802 263.1 585.802 DL 273.1 585.802 268.1 585.802 DL 278.1 585.802 273.1
585.802 DL 283.1 585.802 278.1 585.802 DL 288.1 585.802 283.1 585.802 DL 293.1
585.802 288.1 585.802 DL 298.1 585.802 293.1 585.802 DL 303.1 585.802 298.1
585.802 DL 308.1 585.802 303.1 585.802 DL 313.1 585.802 308.1 585.802 DL 318.1
585.802 313.1 585.802 DL 323.1 585.802 318.1 585.802 DL 328.1 585.802 323.1
585.802 DL 333.1 585.802 328.1 585.802 DL 338.1 585.802 333.1 585.802 DL 343.1
585.802 338.1 585.802 DL 348.1 585.802 343.1 585.802 DL 353.1 585.802 348.1
585.802 DL 358.1 585.802 353.1 585.802 DL 363.1 585.802 358.1 585.802 DL 368.1
585.802 363.1 585.802 DL 373.1 585.802 368.1 585.802 DL 378.1 585.802 373.1
585.802 DL 383.1 585.802 378.1 585.802 DL 388.1 585.802 383.1 585.802 DL 393.1
585.802 388.1 585.802 DL 398.1 585.802 393.1 585.802 DL 403.1 585.802 398.1
585.802 DL 408.1 585.802 403.1 585.802 DL 413.1 585.802 408.1 585.802 DL 418.1
585.802 413.1 585.802 DL 423.1 585.802 418.1 585.802 DL 428.1 585.802 423.1
585.802 DL 433.1 585.802 428.1 585.802 DL 438.1 585.802 433.1 585.802 DL 443.1
585.802 438.1 585.802 DL 448.1 585.802 443.1 585.802 DL 453.1 585.802 448.1
585.802 DL 458.1 585.802 453.1 585.802 DL 463.1 585.802 458.1 585.802 DL 468.1
585.802 463.1 585.802 DL 473.1 585.802 468.1 585.802 DL F3 -1.5(shm / incr3.c)
475.35 588.302 R/F5 8/Palatino-Bold@0 SF(Figure 12.12)207.644 601.802 Q/F6 8
/Palatino-Roman@0 SF(Counter and semaphor)6 E 2(ea)-.144 G .288 -.144(re b)
348.836 601.802 T(oth in shar).144 E(ed memory)-.144 E(.)-.888 E/F7 9
/Helvetica-Bold@0 SF(De\214ne structure that will be in shared memor)129.6
629.802 Q(y).09 E/F8 7/Courier-Oblique@0 SF(2\2115)112.68 644.802 Q F2 2.507
-.92(We d)147.6 644.802 T .667(e\214ne a str).92 F(uctur)-.08 E 3.166(ec)-.18 G
.666(ontaining the integer counter and a semaphor)250.826 644.802 R 3.166(et)
-.18 G 3.166(op)468.148 644.802 S -.18(ro)482.784 644.802 S .666(tect it.).18 F
(This str)129.6 656.802 Q(uctur)-.08 E 2.5(ew)-.18 G(ill be stor)201.73 656.802
Q(ed in the shar)-.18 E(ed memory object.)-.18 E EP
%%Page: 315 13
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF(Section 12.4)93.6 82 Q 2.25
(4.4BSD Anonymous Memory Mapping)325.722 82 R/F1 9/Palatino-Bold@0 SF(315)506.1
82 Q .32 LW 97.6 89.2 93.6 89.2 DL 99.6 89.2 95.6 89.2 DL 103.6 89.2 99.6 89.2
DL 107.6 89.2 103.6 89.2 DL 111.6 89.2 107.6 89.2 DL 115.6 89.2 111.6 89.2 DL
119.6 89.2 115.6 89.2 DL 123.6 89.2 119.6 89.2 DL 127.6 89.2 123.6 89.2 DL
131.6 89.2 127.6 89.2 DL 135.6 89.2 131.6 89.2 DL 139.6 89.2 135.6 89.2 DL
143.6 89.2 139.6 89.2 DL 147.6 89.2 143.6 89.2 DL 151.6 89.2 147.6 89.2 DL
155.6 89.2 151.6 89.2 DL 159.6 89.2 155.6 89.2 DL 163.6 89.2 159.6 89.2 DL
167.6 89.2 163.6 89.2 DL 171.6 89.2 167.6 89.2 DL 175.6 89.2 171.6 89.2 DL
179.6 89.2 175.6 89.2 DL 183.6 89.2 179.6 89.2 DL 187.6 89.2 183.6 89.2 DL
191.6 89.2 187.6 89.2 DL 195.6 89.2 191.6 89.2 DL 199.6 89.2 195.6 89.2 DL
203.6 89.2 199.6 89.2 DL 207.6 89.2 203.6 89.2 DL 211.6 89.2 207.6 89.2 DL
215.6 89.2 211.6 89.2 DL 219.6 89.2 215.6 89.2 DL 223.6 89.2 219.6 89.2 DL
227.6 89.2 223.6 89.2 DL 231.6 89.2 227.6 89.2 DL 235.6 89.2 231.6 89.2 DL
239.6 89.2 235.6 89.2 DL 243.6 89.2 239.6 89.2 DL 247.6 89.2 243.6 89.2 DL
251.6 89.2 247.6 89.2 DL 255.6 89.2 251.6 89.2 DL 259.6 89.2 255.6 89.2 DL
263.6 89.2 259.6 89.2 DL 267.6 89.2 263.6 89.2 DL 271.6 89.2 267.6 89.2 DL
275.6 89.2 271.6 89.2 DL 279.6 89.2 275.6 89.2 DL 283.6 89.2 279.6 89.2 DL
287.6 89.2 283.6 89.2 DL 291.6 89.2 287.6 89.2 DL 295.6 89.2 291.6 89.2 DL
299.6 89.2 295.6 89.2 DL 303.6 89.2 299.6 89.2 DL 307.6 89.2 303.6 89.2 DL
311.6 89.2 307.6 89.2 DL 315.6 89.2 311.6 89.2 DL 319.6 89.2 315.6 89.2 DL
323.6 89.2 319.6 89.2 DL 327.6 89.2 323.6 89.2 DL 331.6 89.2 327.6 89.2 DL
335.6 89.2 331.6 89.2 DL 339.6 89.2 335.6 89.2 DL 343.6 89.2 339.6 89.2 DL
347.6 89.2 343.6 89.2 DL 351.6 89.2 347.6 89.2 DL 355.6 89.2 351.6 89.2 DL
359.6 89.2 355.6 89.2 DL 363.6 89.2 359.6 89.2 DL 367.6 89.2 363.6 89.2 DL
371.6 89.2 367.6 89.2 DL 375.6 89.2 371.6 89.2 DL 379.6 89.2 375.6 89.2 DL
383.6 89.2 379.6 89.2 DL 387.6 89.2 383.6 89.2 DL 391.6 89.2 387.6 89.2 DL
395.6 89.2 391.6 89.2 DL 399.6 89.2 395.6 89.2 DL 403.6 89.2 399.6 89.2 DL
407.6 89.2 403.6 89.2 DL 411.6 89.2 407.6 89.2 DL 415.6 89.2 411.6 89.2 DL
419.6 89.2 415.6 89.2 DL 423.6 89.2 419.6 89.2 DL 427.6 89.2 423.6 89.2 DL
431.6 89.2 427.6 89.2 DL 435.6 89.2 431.6 89.2 DL 439.6 89.2 435.6 89.2 DL
443.6 89.2 439.6 89.2 DL 447.6 89.2 443.6 89.2 DL 451.6 89.2 447.6 89.2 DL
455.6 89.2 451.6 89.2 DL 459.6 89.2 455.6 89.2 DL 463.6 89.2 459.6 89.2 DL
467.6 89.2 463.6 89.2 DL 471.6 89.2 467.6 89.2 DL 475.6 89.2 471.6 89.2 DL
479.6 89.2 475.6 89.2 DL 483.6 89.2 479.6 89.2 DL 487.6 89.2 483.6 89.2 DL
491.6 89.2 487.6 89.2 DL 495.6 89.2 491.6 89.2 DL 499.6 89.2 495.6 89.2 DL
503.6 89.2 499.6 89.2 DL 507.6 89.2 503.6 89.2 DL 511.6 89.2 507.6 89.2 DL
515.6 89.2 511.6 89.2 DL 519.6 89.2 515.6 89.2 DL/F2 9/Helvetica-Bold@0 SF
(Map the memor)129.6 123 Q(y).09 E/F3 7/Courier-Oblique@0 SF(14\21119)104.28
138 Q/F4 10/Palatino-Roman@0 SF 2.326 -.92(We c)147.6 138 T -.18(re).92 G .486
(ate the \214le that will be mapped, and write a str).18 F(uctur)-.08 E 2.986
(eo)-.18 G 2.986(f0t)425.282 138 S 2.986(ot)442.844 138 S .486(he \214le.)
454.55 138 R .487(All we)5.487 F(ar)129.6 150 Q 3.233(ed)-.18 G .732
(oing is initializing the counter)152.503 150 R 3.232(,b)-.74 G .732
(ecause the value of the semaphor)298.394 150 R 3.232(ew)-.18 G .732
(ill be initial-)465.036 150 R .787(ized by the call to)129.6 162 R/F5 10
/Courier@0 SF(sem_init)3.288 E F4 5.788(.N)C .788
(evertheless, writing an entir)278.386 162 R 3.288(es)-.18 G(tr)416.418 162 Q
(uctur)-.08 E 3.288(eo)-.18 G 3.288(f0i)460.616 162 S 3.288(ss)478.432 162 S
(impler)490.2 162 Q(than to try to write only an integer of 0.)129.6 174 Q F2
-2.412(Initializ e)129.6 190 R(semaphore)2.502 E F3(20\21121)104.28 205 Q F4
2.705 -.92(We a)147.6 205 T 1.225 -.18(re n).92 H .865
(ow using a memory-based semaphor).18 F .865(e, instead of a named semaphor)
-.18 F .865(e, so)-.18 F .318(we call)129.6 217 R F5(sem_init)2.818 E F4 .319
(to initialize its value to 1.)2.818 F .319(The second ar)5.319 F .319
(gument must be nonzer)-.18 F .319(o, to)-.18 F(indicate that the semaphor)
129.6 229 Q 2.5(ei)-.18 G 2.5(sb)257.67 229 S(eing shar)269.94 229 Q
(ed between pr)-.18 E(ocesses.)-.18 E(Figur)147.6 253 Q 2.814(e1)-.18 G .313
(2.13 is a modi\214cation of Figur)184.034 253 R 2.813(e1)-.18 G(2.1)329.222
253 Q .313(1, noting the change that the semaphor)-.55 F(e)-.18 E(has moved fr)
129.6 265 Q(om the kernel into shar)-.18 E(ed memory)-.18 E(.)-1.11 E 310.2
416.6 MT 0 -100.8 RL -100.8 0 RL 0 100.8 RL CL ST/F6 8/Courier@0 SF
(struct shared *ptr;)214.2 332.96 Q(if \(Fork\(\) == 0\) {)214.2 352.96 Q
(/* child */)233.4 362.96 Q(...)233.4 372.96 Q(})214.2 382.96 Q(/* parent */)
214.2 402.96 Q(...)214.2 412.96 Q 519 416.6 MT 0 -100.8 RL -100.8 0 RL 0 100.8
RL CL ST(struct shared *ptr;)423 332.96 Q(if \(Fork\(\) == 0\) {)423 352.96 Q
(/* child */)442.2 362.96 Q(...)442.2 372.96 Q(})423 382.96 Q(/* parent */)423
402.96 Q(...)423 412.96 Q/F7 8/Palatino-Roman@0 SF(par)248.34 312.56 Q(ent)
-.144 E(child)459.724 312.56 Q 191.4 409.4 205.8 409.4 DL 205.8 409.4 MT -7.2
1.8 RL 0 -3.6 RL CL BL 205.8 409.4 MT -7.2 1.8 RL 0 -3.6 RL CL ST(par)112.936
411.16 Q(ent executing her)-.144 E(e)-.144 E 400.2 369.8 414.6 369.8 DL 414.6
369.8 MT -7.2 1.8 RL 0 -3.6 RL CL BL 414.6 369.8 MT -7.2 1.8 RL 0 -3.6 RL CL ST
(child executing her)326.904 371.56 Q(e)-.144 E 403.8 301.4 MT 0 -14.4 RL -79.2
0 RL 0 14.4 RL CL ST(count & semaphor)329.6 295.96 Q(e)-.144 E(shar)336.34
283.76 Q(ed memory)-.144 E 306.6 330.92 MT 5.4 0 RL 3.6 0 6.36 -4.68 8.28
-14.04 RC 2.88 -14.04 RL ST 323.16 302.84 MT .288 7.416 RL -3.528 -.72 RL CL BL
323.16 302.84 MT .288 7.416 RL -3.528 -.72 RL CL ST 421.8 330.92 MT -45 0 RL
-30 0 -45.96 -4.68 -47.88 -14.04 RC -2.88 -14.04 RL ST 326.04 302.84 MT 3.24
6.696 RL -3.528 .72 RL CL BL 326.04 302.84 MT 3.24 6.696 RL -3.528 .72 RL CL ST
/F8 8/Palatino-Bold@0 SF(Figure 12.13)207.824 434.6 Q F7(Counter and semaphor)6
E 2(ea)-.144 G .288 -.144(re n)349.016 434.6 T(ow in shar).144 E(ed memory)
-.144 E(.)-.888 E/F9 12/Helvetica-Bold@0 SF 9.312(12.4 4.4BSD)93.6 482.6 R
(Anon)6.672 E 3.336(ymous Memor)-.24 F 6.672(yM).12 G(apping)316.848 482.6 Q F4
.977(Our examples in Figur)129.6 506.6 R .977
(es 12.10 and 12.12 work \214ne, but we have to cr)-.18 F .977
(eate a \214le in the)-.18 F .446(\214lesystem \(the command)129.6 518.6 R(-)
-.9 I .446(line ar).9 J .446(gument\), call)-.18 F F5(open)2.946 E F4 2.945(,a)
C .445(nd then)369.045 518.6 R F5(write)2.945 E F4(zer)2.945 E .445
(os to the \214le to)-.18 F .154(initialize it.)129.6 530.6 R .154
(When the purpose of calling)5.154 F F5(mmap)2.654 E F4 .154(is to pr)2.654 F
.154(ovide a piece of mapped memory)-.18 F 2.028(that will be shar)129.6 542.6
R 2.028(ed acr)-.18 F 2.028(oss a)-.18 F F5(fork)4.528 E F4 4.528(,w)C 4.528
(ec)302.746 542.6 S 2.028(an simplify this scenario, depending on the)316.504
542.6 R(implementation.)129.6 554.6 Q 6.33(1. 4.4BSD)147.6 578.6 R(pr)3.9 E
(ovides)-.18 E/F10 10/Palatino-Italic@0 SF 1.4(anonymous memory mapping)3.9 F
F4 3.9(,w)C 1.4(hich completely avoids having)379.82 578.6 R 3.521(to cr)163.93
590.6 R 3.521(eate or open a \214le.)-.18 F 3.521(Instead, we specify the)8.521
F F10(\215ags)6.021 E F4(as)6.02 E F5 .02(MAP_SHARED |)6.02 F(MAP_ANON)163.93
602.6 Q F4 .025(and the)2.525 F F10(fd)2.525 E F4(as)2.525 E/F11 10/Symbol SF
(-)2.525 E F4 2.525(1. The)B F10(offset)2.525 E F4 .025(is ignor)2.525 F 2.525
(ed. The)-.18 F .026(memory is initialized to 0.)2.526 F 1.84 -.92(We s)163.93
614.6 T(how an example of this in Figur).92 E 2.5(e1)-.18 G(2.14.)337.34 614.6
Q 6.33(2. SVR4)147.6 630.6 R(pr)3.188 E(ovides)-.18 E F5(/dev/zero)3.188 E F4
3.188(,w)C .687(hich we)301.424 630.6 R F5(open)3.187 E F4 3.187(,a)C .687
(nd we use the r)374.605 630.6 R .687(esulting descrip-)-.18 F .632
(tor in the call to)163.93 642.6 R F5(mmap)3.132 E F4 5.632(.T)C .632
(his device r)277.102 642.6 R .632(eturns bytes of 0 when r)-.18 F .632
(ead, and anything)-.18 F .573(written to the device is discar)163.93 654.6 R
3.073(ded. W)-.18 F 3.073(es)-.92 G .573(how an example of this in Figur)
342.791 654.6 R 3.072(e1)-.18 G(2.15.)499.6 654.6 Q EP
%%Page: 316 14
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(316)93.6 82 Q/F1 9/Palatino-Roman@0 SF(Shar)125.1 82 Q
2.25(ed Memory Intr)-.162 F 227.622(oduction Chapter)-.162 F(12)2.25 E .32 LW
97.6 89.2 93.6 89.2 DL 99.6 89.2 95.6 89.2 DL 103.6 89.2 99.6 89.2 DL 107.6
89.2 103.6 89.2 DL 111.6 89.2 107.6 89.2 DL 115.6 89.2 111.6 89.2 DL 119.6 89.2
115.6 89.2 DL 123.6 89.2 119.6 89.2 DL 127.6 89.2 123.6 89.2 DL 131.6 89.2
127.6 89.2 DL 135.6 89.2 131.6 89.2 DL 139.6 89.2 135.6 89.2 DL 143.6 89.2
139.6 89.2 DL 147.6 89.2 143.6 89.2 DL 151.6 89.2 147.6 89.2 DL 155.6 89.2
151.6 89.2 DL 159.6 89.2 155.6 89.2 DL 163.6 89.2 159.6 89.2 DL 167.6 89.2
163.6 89.2 DL 171.6 89.2 167.6 89.2 DL 175.6 89.2 171.6 89.2 DL 179.6 89.2
175.6 89.2 DL 183.6 89.2 179.6 89.2 DL 187.6 89.2 183.6 89.2 DL 191.6 89.2
187.6 89.2 DL 195.6 89.2 191.6 89.2 DL 199.6 89.2 195.6 89.2 DL 203.6 89.2
199.6 89.2 DL 207.6 89.2 203.6 89.2 DL 211.6 89.2 207.6 89.2 DL 215.6 89.2
211.6 89.2 DL 219.6 89.2 215.6 89.2 DL 223.6 89.2 219.6 89.2 DL 227.6 89.2
223.6 89.2 DL 231.6 89.2 227.6 89.2 DL 235.6 89.2 231.6 89.2 DL 239.6 89.2
235.6 89.2 DL 243.6 89.2 239.6 89.2 DL 247.6 89.2 243.6 89.2 DL 251.6 89.2
247.6 89.2 DL 255.6 89.2 251.6 89.2 DL 259.6 89.2 255.6 89.2 DL 263.6 89.2
259.6 89.2 DL 267.6 89.2 263.6 89.2 DL 271.6 89.2 267.6 89.2 DL 275.6 89.2
271.6 89.2 DL 279.6 89.2 275.6 89.2 DL 283.6 89.2 279.6 89.2 DL 287.6 89.2
283.6 89.2 DL 291.6 89.2 287.6 89.2 DL 295.6 89.2 291.6 89.2 DL 299.6 89.2
295.6 89.2 DL 303.6 89.2 299.6 89.2 DL 307.6 89.2 303.6 89.2 DL 311.6 89.2
307.6 89.2 DL 315.6 89.2 311.6 89.2 DL 319.6 89.2 315.6 89.2 DL 323.6 89.2
319.6 89.2 DL 327.6 89.2 323.6 89.2 DL 331.6 89.2 327.6 89.2 DL 335.6 89.2
331.6 89.2 DL 339.6 89.2 335.6 89.2 DL 343.6 89.2 339.6 89.2 DL 347.6 89.2
343.6 89.2 DL 351.6 89.2 347.6 89.2 DL 355.6 89.2 351.6 89.2 DL 359.6 89.2
355.6 89.2 DL 363.6 89.2 359.6 89.2 DL 367.6 89.2 363.6 89.2 DL 371.6 89.2
367.6 89.2 DL 375.6 89.2 371.6 89.2 DL 379.6 89.2 375.6 89.2 DL 383.6 89.2
379.6 89.2 DL 387.6 89.2 383.6 89.2 DL 391.6 89.2 387.6 89.2 DL 395.6 89.2
391.6 89.2 DL 399.6 89.2 395.6 89.2 DL 403.6 89.2 399.6 89.2 DL 407.6 89.2
403.6 89.2 DL 411.6 89.2 407.6 89.2 DL 415.6 89.2 411.6 89.2 DL 419.6 89.2
415.6 89.2 DL 423.6 89.2 419.6 89.2 DL 427.6 89.2 423.6 89.2 DL 431.6 89.2
427.6 89.2 DL 435.6 89.2 431.6 89.2 DL 439.6 89.2 435.6 89.2 DL 443.6 89.2
439.6 89.2 DL 447.6 89.2 443.6 89.2 DL 451.6 89.2 447.6 89.2 DL 455.6 89.2
451.6 89.2 DL 459.6 89.2 455.6 89.2 DL 463.6 89.2 459.6 89.2 DL 467.6 89.2
463.6 89.2 DL 471.6 89.2 467.6 89.2 DL 475.6 89.2 471.6 89.2 DL 479.6 89.2
475.6 89.2 DL 483.6 89.2 479.6 89.2 DL 487.6 89.2 483.6 89.2 DL 491.6 89.2
487.6 89.2 DL 495.6 89.2 491.6 89.2 DL 499.6 89.2 495.6 89.2 DL 503.6 89.2
499.6 89.2 DL 507.6 89.2 503.6 89.2 DL 511.6 89.2 507.6 89.2 DL 515.6 89.2
511.6 89.2 DL 519.6 89.2 515.6 89.2 DL/F2 10/Palatino-Roman@0 SF .024
(\(Many Berkeley-derived implementations, such as SunOS 4.1.x and BSD/OS 3.1,)
163.93 123 R(also support)163.93 135 Q/F3 10/Courier@0 SF(/dev/zero)2.5 E F2
(.\))A(Figur)129.6 159 Q 3.344(e1)-.18 G .844
(2.14 shows the only portion of Figur)166.564 159 R 3.344(e1)-.18 G .843
(2.10 that changes when we use 4.4BSD)344.472 159 R(anonymous memory mapping.)
129.6 171 Q .4 LW 134.6 184.2 129.6 184.2 DL 135.102 184.2 130.102 184.2 DL
140.102 184.2 135.102 184.2 DL 145.102 184.2 140.102 184.2 DL 150.102 184.2
145.102 184.2 DL 155.102 184.2 150.102 184.2 DL 160.102 184.2 155.102 184.2 DL
165.102 184.2 160.102 184.2 DL 170.102 184.2 165.102 184.2 DL 175.102 184.2
170.102 184.2 DL 180.102 184.2 175.102 184.2 DL 185.102 184.2 180.102 184.2 DL
190.102 184.2 185.102 184.2 DL 195.102 184.2 190.102 184.2 DL 200.102 184.2
195.102 184.2 DL 205.102 184.2 200.102 184.2 DL 210.102 184.2 205.102 184.2 DL
215.102 184.2 210.102 184.2 DL 220.102 184.2 215.102 184.2 DL 225.102 184.2
220.102 184.2 DL 230.102 184.2 225.102 184.2 DL 235.102 184.2 230.102 184.2 DL
240.102 184.2 235.102 184.2 DL 245.102 184.2 240.102 184.2 DL 250.102 184.2
245.102 184.2 DL 255.102 184.2 250.102 184.2 DL 260.102 184.2 255.102 184.2 DL
265.102 184.2 260.102 184.2 DL 270.102 184.2 265.102 184.2 DL 275.102 184.2
270.102 184.2 DL 280.102 184.2 275.102 184.2 DL 285.102 184.2 280.102 184.2 DL
290.102 184.2 285.102 184.2 DL 295.102 184.2 290.102 184.2 DL 300.102 184.2
295.102 184.2 DL 305.102 184.2 300.102 184.2 DL 310.102 184.2 305.102 184.2 DL
315.102 184.2 310.102 184.2 DL 320.102 184.2 315.102 184.2 DL 325.102 184.2
320.102 184.2 DL 330.102 184.2 325.102 184.2 DL 335.102 184.2 330.102 184.2 DL
340.102 184.2 335.102 184.2 DL 345.102 184.2 340.102 184.2 DL 350.102 184.2
345.102 184.2 DL 355.102 184.2 350.102 184.2 DL 360.102 184.2 355.102 184.2 DL
365.102 184.2 360.102 184.2 DL 370.102 184.2 365.102 184.2 DL 375.102 184.2
370.102 184.2 DL 380.102 184.2 375.102 184.2 DL 385.102 184.2 380.102 184.2 DL
390.102 184.2 385.102 184.2 DL 395.102 184.2 390.102 184.2 DL 400.102 184.2
395.102 184.2 DL 405.102 184.2 400.102 184.2 DL 410.102 184.2 405.102 184.2 DL
415.102 184.2 410.102 184.2 DL 420.102 184.2 415.102 184.2 DL 425.102 184.2
420.102 184.2 DL 430.102 184.2 425.102 184.2 DL 435.102 184.2 430.102 184.2 DL
/F4 9/Palatino-Italic@0 SF -1.5(shm / incr_map_anon.c)437.352 186.7 R/F5 8.15
/Courier@0 SF 4.89(3i)134.49 193.001 S(nt)149.16 193.001 Q 4.89(4m)134.49
203.001 S(ain\(int argc, char **argv\))149.16 203.001 Q 4.89(5{)134.49 213.001
S 24.45(6i)134.49 223.001 S 19.56(nt i,)168.72 223.001 R(nloop;)4.89 E 24.45
(7i)134.49 233.001 S 14.67(nt *ptr;)168.72 233.001 R 24.45(8s)134.49 243.001 S
4.89(em_t *mutex;)168.72 243.001 R 24.45(9i)134.49 260.001 S 4.89(f\()168.72
260.001 S(argc != 2\))183.39 260.001 Q 39.12(10 err_quit\("usage:)129.6 270.001
R(incr_map_anon <#loops>"\);)4.89 E 19.56(11 nloop)129.6 280.001 R 4.89(=a)4.89
G(toi\(argv[1]\);)207.84 280.001 Q 39.12(12 /*)129.6 297.001 R
(map into memory */)4.89 E 19.56(13 ptr)129.6 307.001 R 4.89(=M)4.89 G
(map\(NULL, sizeof\(int\), PROT_READ | PROT_WRITE,)198.06 307.001 Q 73.35
(14 MAP_SHARED)129.6 317.001 R 4.89(|M)4.89 G(AP_ANON, -1, 0\);)286.08 317.001
Q 134.6 321.802 129.6 321.802 DL 135.102 321.802 130.102 321.802 DL 140.102
321.802 135.102 321.802 DL 145.102 321.802 140.102 321.802 DL 150.102 321.802
145.102 321.802 DL 155.102 321.802 150.102 321.802 DL 160.102 321.802 155.102
321.802 DL 165.102 321.802 160.102 321.802 DL 170.102 321.802 165.102 321.802
DL 175.102 321.802 170.102 321.802 DL 180.102 321.802 175.102 321.802 DL
185.102 321.802 180.102 321.802 DL 190.102 321.802 185.102 321.802 DL 195.102
321.802 190.102 321.802 DL 200.102 321.802 195.102 321.802 DL 205.102 321.802
200.102 321.802 DL 210.102 321.802 205.102 321.802 DL 215.102 321.802 210.102
321.802 DL 220.102 321.802 215.102 321.802 DL 225.102 321.802 220.102 321.802
DL 230.102 321.802 225.102 321.802 DL 235.102 321.802 230.102 321.802 DL
240.102 321.802 235.102 321.802 DL 245.102 321.802 240.102 321.802 DL 250.102
321.802 245.102 321.802 DL 255.102 321.802 250.102 321.802 DL 260.102 321.802
255.102 321.802 DL 265.102 321.802 260.102 321.802 DL 270.102 321.802 265.102
321.802 DL 275.102 321.802 270.102 321.802 DL 280.102 321.802 275.102 321.802
DL 285.102 321.802 280.102 321.802 DL 290.102 321.802 285.102 321.802 DL
295.102 321.802 290.102 321.802 DL 300.102 321.802 295.102 321.802 DL 305.102
321.802 300.102 321.802 DL 310.102 321.802 305.102 321.802 DL 315.102 321.802
310.102 321.802 DL 320.102 321.802 315.102 321.802 DL 325.102 321.802 320.102
321.802 DL 330.102 321.802 325.102 321.802 DL 335.102 321.802 330.102 321.802
DL 340.102 321.802 335.102 321.802 DL 345.102 321.802 340.102 321.802 DL
350.102 321.802 345.102 321.802 DL 355.102 321.802 350.102 321.802 DL 360.102
321.802 355.102 321.802 DL 365.102 321.802 360.102 321.802 DL 370.102 321.802
365.102 321.802 DL 375.102 321.802 370.102 321.802 DL 380.102 321.802 375.102
321.802 DL 385.102 321.802 380.102 321.802 DL 390.102 321.802 385.102 321.802
DL 395.102 321.802 390.102 321.802 DL 400.102 321.802 395.102 321.802 DL
405.102 321.802 400.102 321.802 DL 410.102 321.802 405.102 321.802 DL 415.102
321.802 410.102 321.802 DL 420.102 321.802 415.102 321.802 DL 425.102 321.802
420.102 321.802 DL 430.102 321.802 425.102 321.802 DL 435.102 321.802 430.102
321.802 DL F4 -1.5(shm / incr_map_anon.c)437.352 324.302 R/F6 8/Palatino-Bold@0
SF(Figure 12.14)231.268 337.802 Q/F7 8/Palatino-Roman@0 SF
(4.4BSD anonymous memory mapping.)6 E/F8 7/Courier-Oblique@0 SF(6\21111)108.48
361.802 Q F2 1.075(The automatic variables)147.6 361.802 R F3(fd)3.575 E F2
(and)3.575 E F3(zero)3.575 E F2(ar)3.575 E 3.575(eg)-.18 G 1.075
(one, as is the command)345.585 361.802 R(-)-.9 I 1.075(line ar).9 J(gument)
-.18 E(that speci\214ed the pathname that was cr)129.6 373.802 Q(eated.)-.18 E
F8(12\21114)104.28 385.802 Q F2 2.636 -.92(We n)147.6 385.802 T 3.296(ol).92 G
(onger)182.252 385.802 Q F3(open)3.296 E F2 3.296<618c>3.296 G 3.296(le. The)
252.77 385.802 R F3(MAP_ANON)3.296 E F2 .795
(\215ag is speci\214ed in the call to)3.296 F F3(mmap)3.295 E F2 3.295(,a)C(nd)
507.67 385.802 Q(the \214fth ar)129.6 397.802 Q(gument \(the descriptor\) is)
-.18 E/F9 10/Symbol SF(-)2.5 E F2(1.)A/F10 12/Helvetica-Bold@0 SF 9.312
(12.5 SVR4)93.6 441.002 R/F11 12/Courier-Bold@0 SF(/dev/zero)6.672 E F10 -3.216
(Memor y)6.672 F(Mapping)6.672 E F2(Figur)129.6 465.002 Q 5.663(e1)-.18 G 3.164
(2.15 shows the only portion of Figur)168.883 465.002 R 5.664(e1)-.18 G 3.164
(2.10 that changes when we map)363.03 465.002 R F3(/dev/zero)129.6 477.002 Q F2
(.)A 134.6 490.202 129.6 490.202 DL 136.267 490.202 131.267 490.202 DL 141.267
490.202 136.267 490.202 DL 146.267 490.202 141.267 490.202 DL 151.267 490.202
146.267 490.202 DL 156.267 490.202 151.267 490.202 DL 161.267 490.202 156.267
490.202 DL 166.267 490.202 161.267 490.202 DL 171.267 490.202 166.267 490.202
DL 176.267 490.202 171.267 490.202 DL 181.267 490.202 176.267 490.202 DL
186.267 490.202 181.267 490.202 DL 191.267 490.202 186.267 490.202 DL 196.267
490.202 191.267 490.202 DL 201.267 490.202 196.267 490.202 DL 206.267 490.202
201.267 490.202 DL 211.267 490.202 206.267 490.202 DL 216.267 490.202 211.267
490.202 DL 221.267 490.202 216.267 490.202 DL 226.267 490.202 221.267 490.202
DL 231.267 490.202 226.267 490.202 DL 236.267 490.202 231.267 490.202 DL
241.267 490.202 236.267 490.202 DL 246.267 490.202 241.267 490.202 DL 251.267
490.202 246.267 490.202 DL 256.267 490.202 251.267 490.202 DL 261.267 490.202
256.267 490.202 DL 266.267 490.202 261.267 490.202 DL 271.267 490.202 266.267
490.202 DL 276.267 490.202 271.267 490.202 DL 281.267 490.202 276.267 490.202
DL 286.267 490.202 281.267 490.202 DL 291.267 490.202 286.267 490.202 DL
296.267 490.202 291.267 490.202 DL 301.267 490.202 296.267 490.202 DL 306.267
490.202 301.267 490.202 DL 311.267 490.202 306.267 490.202 DL 316.267 490.202
311.267 490.202 DL 321.267 490.202 316.267 490.202 DL 326.267 490.202 321.267
490.202 DL 331.267 490.202 326.267 490.202 DL 336.267 490.202 331.267 490.202
DL 341.267 490.202 336.267 490.202 DL 346.267 490.202 341.267 490.202 DL
351.267 490.202 346.267 490.202 DL 356.267 490.202 351.267 490.202 DL 361.267
490.202 356.267 490.202 DL 366.267 490.202 361.267 490.202 DL 371.267 490.202
366.267 490.202 DL 376.267 490.202 371.267 490.202 DL 381.267 490.202 376.267
490.202 DL 386.267 490.202 381.267 490.202 DL 391.267 490.202 386.267 490.202
DL 396.267 490.202 391.267 490.202 DL 401.267 490.202 396.267 490.202 DL
406.267 490.202 401.267 490.202 DL 411.267 490.202 406.267 490.202 DL 416.267
490.202 411.267 490.202 DL 421.267 490.202 416.267 490.202 DL 426.267 490.202
421.267 490.202 DL 431.267 490.202 426.267 490.202 DL 436.267 490.202 431.267
490.202 DL 441.267 490.202 436.267 490.202 DL F4 -1.5(shm / incr_dev_zer)
443.517 492.702 R(o.c)-.162 E F5 4.89(3i)134.49 499.003 S(nt)149.16 499.003 Q
4.89(4m)134.49 509.003 S(ain\(int argc, char **argv\))149.16 509.003 Q 4.89(5{)
134.49 519.003 S 24.45(6i)134.49 529.003 S 19.56(nt fd,)168.72 529.003 R
(i, nloop;)4.89 E 24.45(7i)134.49 539.003 S 14.67(nt *ptr;)168.72 539.003 R
24.45(8s)134.49 549.003 S 4.89(em_t *mutex;)168.72 549.003 R 24.45(9i)134.49
566.003 S 4.89(f\()168.72 566.003 S(argc != 2\))183.39 566.003 Q 39.12
(10 err_quit\("usage:)129.6 576.003 R(incr_dev_zero <#loops>"\);)4.89 E 19.56
(11 nloop)129.6 586.003 R 4.89(=a)4.89 G(toi\(argv[1]\);)207.84 586.003 Q 39.12
(12 /*)129.6 603.003 R(open /dev/zero, map into memory */)4.89 E 19.56(13 fd)
129.6 613.003 R 4.89(=O)4.89 G(pen\("/dev/zero", O_RDWR\);)193.17 613.003 Q
19.56(14 ptr)129.6 623.003 R 4.89(=M)4.89 G
(map\(NULL, sizeof\(int\), PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0\);)198.06
623.003 Q 19.56(15 Close\(fd\);)129.6 633.003 R 134.6 637.804 129.6 637.804 DL
136.267 637.804 131.267 637.804 DL 141.267 637.804 136.267 637.804 DL 146.267
637.804 141.267 637.804 DL 151.267 637.804 146.267 637.804 DL 156.267 637.804
151.267 637.804 DL 161.267 637.804 156.267 637.804 DL 166.267 637.804 161.267
637.804 DL 171.267 637.804 166.267 637.804 DL 176.267 637.804 171.267 637.804
DL 181.267 637.804 176.267 637.804 DL 186.267 637.804 181.267 637.804 DL
191.267 637.804 186.267 637.804 DL 196.267 637.804 191.267 637.804 DL 201.267
637.804 196.267 637.804 DL 206.267 637.804 201.267 637.804 DL 211.267 637.804
206.267 637.804 DL 216.267 637.804 211.267 637.804 DL 221.267 637.804 216.267
637.804 DL 226.267 637.804 221.267 637.804 DL 231.267 637.804 226.267 637.804
DL 236.267 637.804 231.267 637.804 DL 241.267 637.804 236.267 637.804 DL
246.267 637.804 241.267 637.804 DL 251.267 637.804 246.267 637.804 DL 256.267
637.804 251.267 637.804 DL 261.267 637.804 256.267 637.804 DL 266.267 637.804
261.267 637.804 DL 271.267 637.804 266.267 637.804 DL 276.267 637.804 271.267
637.804 DL 281.267 637.804 276.267 637.804 DL 286.267 637.804 281.267 637.804
DL 291.267 637.804 286.267 637.804 DL 296.267 637.804 291.267 637.804 DL
301.267 637.804 296.267 637.804 DL 306.267 637.804 301.267 637.804 DL 311.267
637.804 306.267 637.804 DL 316.267 637.804 311.267 637.804 DL 321.267 637.804
316.267 637.804 DL 326.267 637.804 321.267 637.804 DL 331.267 637.804 326.267
637.804 DL 336.267 637.804 331.267 637.804 DL 341.267 637.804 336.267 637.804
DL 346.267 637.804 341.267 637.804 DL 351.267 637.804 346.267 637.804 DL
356.267 637.804 351.267 637.804 DL 361.267 637.804 356.267 637.804 DL 366.267
637.804 361.267 637.804 DL 371.267 637.804 366.267 637.804 DL 376.267 637.804
371.267 637.804 DL 381.267 637.804 376.267 637.804 DL 386.267 637.804 381.267
637.804 DL 391.267 637.804 386.267 637.804 DL 396.267 637.804 391.267 637.804
DL 401.267 637.804 396.267 637.804 DL 406.267 637.804 401.267 637.804 DL
411.267 637.804 406.267 637.804 DL 416.267 637.804 411.267 637.804 DL 421.267
637.804 416.267 637.804 DL 426.267 637.804 421.267 637.804 DL 431.267 637.804
426.267 637.804 DL 436.267 637.804 431.267 637.804 DL 441.267 637.804 436.267
637.804 DL F4 -1.5(shm / incr_dev_zer)443.517 640.304 R(o.c)-.162 E F6
(Figure 12.15)229.02 653.804 Q F7(SVR4 memory mapping of)6 E/F12 8/Courier@0 SF
(/dev/zero)2 E F7(.)A EP
%%Page: 317 15
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF(Section 12.6)93.6 82 Q(Refer)331.572 82 Q 2.25
(encing Memory-Mapped Objects)-.162 F/F1 9/Palatino-Bold@0 SF(317)506.1 82 Q
.32 LW 97.6 89.2 93.6 89.2 DL 99.6 89.2 95.6 89.2 DL 103.6 89.2 99.6 89.2 DL
107.6 89.2 103.6 89.2 DL 111.6 89.2 107.6 89.2 DL 115.6 89.2 111.6 89.2 DL
119.6 89.2 115.6 89.2 DL 123.6 89.2 119.6 89.2 DL 127.6 89.2 123.6 89.2 DL
131.6 89.2 127.6 89.2 DL 135.6 89.2 131.6 89.2 DL 139.6 89.2 135.6 89.2 DL
143.6 89.2 139.6 89.2 DL 147.6 89.2 143.6 89.2 DL 151.6 89.2 147.6 89.2 DL
155.6 89.2 151.6 89.2 DL 159.6 89.2 155.6 89.2 DL 163.6 89.2 159.6 89.2 DL
167.6 89.2 163.6 89.2 DL 171.6 89.2 167.6 89.2 DL 175.6 89.2 171.6 89.2 DL
179.6 89.2 175.6 89.2 DL 183.6 89.2 179.6 89.2 DL 187.6 89.2 183.6 89.2 DL
191.6 89.2 187.6 89.2 DL 195.6 89.2 191.6 89.2 DL 199.6 89.2 195.6 89.2 DL
203.6 89.2 199.6 89.2 DL 207.6 89.2 203.6 89.2 DL 211.6 89.2 207.6 89.2 DL
215.6 89.2 211.6 89.2 DL 219.6 89.2 215.6 89.2 DL 223.6 89.2 219.6 89.2 DL
227.6 89.2 223.6 89.2 DL 231.6 89.2 227.6 89.2 DL 235.6 89.2 231.6 89.2 DL
239.6 89.2 235.6 89.2 DL 243.6 89.2 239.6 89.2 DL 247.6 89.2 243.6 89.2 DL
251.6 89.2 247.6 89.2 DL 255.6 89.2 251.6 89.2 DL 259.6 89.2 255.6 89.2 DL
263.6 89.2 259.6 89.2 DL 267.6 89.2 263.6 89.2 DL 271.6 89.2 267.6 89.2 DL
275.6 89.2 271.6 89.2 DL 279.6 89.2 275.6 89.2 DL 283.6 89.2 279.6 89.2 DL
287.6 89.2 283.6 89.2 DL 291.6 89.2 287.6 89.2 DL 295.6 89.2 291.6 89.2 DL
299.6 89.2 295.6 89.2 DL 303.6 89.2 299.6 89.2 DL 307.6 89.2 303.6 89.2 DL
311.6 89.2 307.6 89.2 DL 315.6 89.2 311.6 89.2 DL 319.6 89.2 315.6 89.2 DL
323.6 89.2 319.6 89.2 DL 327.6 89.2 323.6 89.2 DL 331.6 89.2 327.6 89.2 DL
335.6 89.2 331.6 89.2 DL 339.6 89.2 335.6 89.2 DL 343.6 89.2 339.6 89.2 DL
347.6 89.2 343.6 89.2 DL 351.6 89.2 347.6 89.2 DL 355.6 89.2 351.6 89.2 DL
359.6 89.2 355.6 89.2 DL 363.6 89.2 359.6 89.2 DL 367.6 89.2 363.6 89.2 DL
371.6 89.2 367.6 89.2 DL 375.6 89.2 371.6 89.2 DL 379.6 89.2 375.6 89.2 DL
383.6 89.2 379.6 89.2 DL 387.6 89.2 383.6 89.2 DL 391.6 89.2 387.6 89.2 DL
395.6 89.2 391.6 89.2 DL 399.6 89.2 395.6 89.2 DL 403.6 89.2 399.6 89.2 DL
407.6 89.2 403.6 89.2 DL 411.6 89.2 407.6 89.2 DL 415.6 89.2 411.6 89.2 DL
419.6 89.2 415.6 89.2 DL 423.6 89.2 419.6 89.2 DL 427.6 89.2 423.6 89.2 DL
431.6 89.2 427.6 89.2 DL 435.6 89.2 431.6 89.2 DL 439.6 89.2 435.6 89.2 DL
443.6 89.2 439.6 89.2 DL 447.6 89.2 443.6 89.2 DL 451.6 89.2 447.6 89.2 DL
455.6 89.2 451.6 89.2 DL 459.6 89.2 455.6 89.2 DL 463.6 89.2 459.6 89.2 DL
467.6 89.2 463.6 89.2 DL 471.6 89.2 467.6 89.2 DL 475.6 89.2 471.6 89.2 DL
479.6 89.2 475.6 89.2 DL 483.6 89.2 479.6 89.2 DL 487.6 89.2 483.6 89.2 DL
491.6 89.2 487.6 89.2 DL 495.6 89.2 491.6 89.2 DL 499.6 89.2 495.6 89.2 DL
503.6 89.2 499.6 89.2 DL 507.6 89.2 503.6 89.2 DL 511.6 89.2 507.6 89.2 DL
515.6 89.2 511.6 89.2 DL 519.6 89.2 515.6 89.2 DL/F2 7/Courier-Oblique@0 SF
(6\21111)108.48 123 Q/F3 10/Palatino-Roman@0 SF .785(The automatic variable)
147.6 123 R/F4 10/Courier@0 SF(zero)3.285 E F3 .785(is gone, as is the command)
3.285 F(-)-.9 I .785(line ar).9 J .785(gument that speci-)-.18 F
(\214ed the pathname that was cr)129.6 135 Q(eated.)-.18 E F2(12\21115)104.28
147 Q F3 -.92(We)147.6 147 S F4 -2.621(open /dev/zero)4.299 F F3 3.379(,a)C
.879(nd the descriptor is then used in the call to)257.107 147 R F4(mmap)3.38 E
F3 5.88(.W)C 3.38(ea)497.87 147 S -.18(re)511.04 147 S
(guaranteed that the memory-mapped r)129.6 159 Q(egion is initialized to 0.)
-.18 E/F5 12/Helvetica-Bold@0 SF 9.312(12.6 Ref)93.6 195 R 3.336
(erencing Memor)-.12 F 3.336(y-Mapped Objects).12 F F3 .245(When a r)129.6 219
R .245(egular \214le is memory mapped, the size of the mapping in memory \(the\
 second)-.18 F(ar)129.6 231 Q .232(gument to)-.18 F F4(mmap)2.732 E F3 2.732
(\)n)C .232(ormally equals the size of the \214le.)222.726 231 R .232
(For example, in Figur)5.232 F 2.732(e1)-.18 G .232(2.12 the)485.498 231 R .87
(\214le size is set to the size of our)129.6 243 R F4(shared)3.37 E F3(str)3.37
E(uctur)-.08 E 3.37(eb)-.18 G(y)361.78 243 Q F4(write)3.37 E F3 3.37(,a)C .87
(nd this value is also the)411.58 243 R 2.386(size of the memory mapping.)129.6
255 R 2.386(But these two sizes)7.386 F .833<8a74>.833 G 2.387
(he \214le size and the memory-)-.833 F(mapped size)129.6 267 Q .833<8a63>.833
G(an dif)-.833 E(fer)-.18 E(.)-.74 E 3.536 -.92(We w)147.6 279 T 1.696
(ill use the pr).92 F 1.696(ogram shown in Figur)-.18 F 4.196(e1)-.18 G 1.696
(2.16 to explor)351.648 279 R 4.195(et)-.18 G(he)426.605 279 Q F4(mmap)4.195 E
F3 1.695(function in)4.195 F(mor)129.6 291 Q 2.5(ed)-.18 G(etail.)161.06 291 Q
.4 LW 134.6 304.2 129.6 304.2 DL 134.774 304.2 129.774 304.2 DL 139.774 304.2
134.774 304.2 DL 144.774 304.2 139.774 304.2 DL 149.774 304.2 144.774 304.2 DL
154.774 304.2 149.774 304.2 DL 159.774 304.2 154.774 304.2 DL 164.774 304.2
159.774 304.2 DL 169.774 304.2 164.774 304.2 DL 174.774 304.2 169.774 304.2 DL
179.774 304.2 174.774 304.2 DL 184.774 304.2 179.774 304.2 DL 189.774 304.2
184.774 304.2 DL 194.774 304.2 189.774 304.2 DL 199.774 304.2 194.774 304.2 DL
204.774 304.2 199.774 304.2 DL 209.774 304.2 204.774 304.2 DL 214.774 304.2
209.774 304.2 DL 219.774 304.2 214.774 304.2 DL 224.774 304.2 219.774 304.2 DL
229.774 304.2 224.774 304.2 DL 234.774 304.2 229.774 304.2 DL 239.774 304.2
234.774 304.2 DL 244.774 304.2 239.774 304.2 DL 249.774 304.2 244.774 304.2 DL
254.774 304.2 249.774 304.2 DL 259.774 304.2 254.774 304.2 DL 264.774 304.2
259.774 304.2 DL 269.774 304.2 264.774 304.2 DL 274.774 304.2 269.774 304.2 DL
279.774 304.2 274.774 304.2 DL 284.774 304.2 279.774 304.2 DL 289.774 304.2
284.774 304.2 DL 294.774 304.2 289.774 304.2 DL 299.774 304.2 294.774 304.2 DL
304.774 304.2 299.774 304.2 DL 309.774 304.2 304.774 304.2 DL 314.774 304.2
309.774 304.2 DL 319.774 304.2 314.774 304.2 DL 324.774 304.2 319.774 304.2 DL
329.774 304.2 324.774 304.2 DL 334.774 304.2 329.774 304.2 DL 339.774 304.2
334.774 304.2 DL 344.774 304.2 339.774 304.2 DL 349.774 304.2 344.774 304.2 DL
354.774 304.2 349.774 304.2 DL 359.774 304.2 354.774 304.2 DL 364.774 304.2
359.774 304.2 DL 369.774 304.2 364.774 304.2 DL 374.774 304.2 369.774 304.2 DL
379.774 304.2 374.774 304.2 DL 384.774 304.2 379.774 304.2 DL 389.774 304.2
384.774 304.2 DL 394.774 304.2 389.774 304.2 DL 399.774 304.2 394.774 304.2 DL
404.774 304.2 399.774 304.2 DL 409.774 304.2 404.774 304.2 DL 414.774 304.2
409.774 304.2 DL 419.774 304.2 414.774 304.2 DL 424.774 304.2 419.774 304.2 DL
429.774 304.2 424.774 304.2 DL 434.774 304.2 429.774 304.2 DL 439.774 304.2
434.774 304.2 DL 444.774 304.2 439.774 304.2 DL 449.774 304.2 444.774 304.2 DL
454.774 304.2 449.774 304.2 DL 459.774 304.2 454.774 304.2 DL 464.774 304.2
459.774 304.2 DL 469.774 304.2 464.774 304.2 DL 474.774 304.2 469.774 304.2 DL
/F6 9/Palatino-Italic@0 SF -1.5(shm / test1.c)477.024 306.7 R/F7 8.15/Courier@0
SF 4.89(1#)134.49 313.001 S 14.67(include "unpipc.h")149.16 313.001 R 4.89(2i)
134.49 330.001 S(nt)149.16 330.001 Q 4.89(3m)134.49 340.001 S
(ain\(int argc, char **argv\))149.16 340.001 Q 4.89(4{)134.49 350.001 S 24.45
(5i)134.49 360.001 S 19.56(nt fd,)168.72 360.001 R(i;)4.89 E 24.45(6c)134.49
370.001 S 9.78(har *ptr;)168.72 370.001 R 24.45(7s)134.49 380.001 S 4.89
(ize_t filesize,)168.72 380.001 R(mmapsize, pagesize;)4.89 E 24.45(8i)134.49
397.001 S 4.89(f\()168.72 397.001 S(argc != 4\))183.39 397.001 Q 44.01(9e)
134.49 407.001 S(rr_quit\("usage: test1 <pathname> <filesize> <mmapsize>"\);)
188.28 407.001 Q 19.56(10 filesize)129.6 417.001 R 4.89(=a)4.89 G
(toi\(argv[2]\);)222.51 417.001 Q 19.56(11 mmapsize)129.6 427.001 R 4.89(=a)
4.89 G(toi\(argv[3]\);)222.51 427.001 Q 39.12(12 /*)129.6 444.001 R
(open file: create or truncate; set file size */)4.89 E 19.56(13 fd)129.6
454.001 R 4.89(=O)4.89 G
(pen\(argv[1], O_RDWR | O_CREAT | O_TRUNC, FILE_MODE\);)193.17 454.001 Q 19.56
(14 Lseek\(fd,)129.6 464.001 R(filesize - 1, SEEK_SET\);)4.89 E 19.56
(15 Write\(fd,)129.6 474.001 R("", 1\);)4.89 E 19.56(16 ptr)129.6 491.001 R
4.89(=M)4.89 G
(map\(NULL, mmapsize, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0\);)198.06
491.001 Q 19.56(17 Close\(fd\);)129.6 501.001 R 19.56(18 pagesize)129.6 518.001
R 4.89(=S)4.89 G(ysconf\(_SC_PAGESIZE\);)222.51 518.001 Q 19.56
(19 printf\("PAGESIZE)129.6 528.001 R 4.89(=%)4.89 G
(ld\\n", \(long\) pagesize\);)261.63 528.001 Q 19.56(20 for)129.6 545.001 R
(\(i = 0; i < max\(filesize, mmapsize\); i += pagesize\) {)4.89 E 39.12
(21 printf\("ptr[%d])129.6 555.001 R 4.89(=%)4.89 G(d\\n", i, ptr[i]\);)276.3
555.001 Q 39.12(22 ptr[i])129.6 565.001 R 4.89(=1)4.89 G(;)232.29 565.001 Q
39.12(23 printf\("ptr[%d])129.6 575.001 R 4.89(=%)4.89 G
(d\\n", i + pagesize - 1, ptr[i + pagesize - 1]\);)276.3 575.001 Q 39.12
(24 ptr[i)129.6 585.001 R 4.89(+p)4.89 G(agesize - 1] = 1;)227.4 585.001 Q
19.56(25 })129.6 595.001 R 19.56(26 printf\("ptr[%d])129.6 605.001 R 4.89(=%)
4.89 G(d\\n", i, ptr[i]\);)256.74 605.001 Q 19.56(27 exit\(0\);)129.6 622.001 R
(28 })129.6 632.001 Q 134.6 636.802 129.6 636.802 DL 134.774 636.802 129.774
636.802 DL 139.774 636.802 134.774 636.802 DL 144.774 636.802 139.774 636.802
DL 149.774 636.802 144.774 636.802 DL 154.774 636.802 149.774 636.802 DL
159.774 636.802 154.774 636.802 DL 164.774 636.802 159.774 636.802 DL 169.774
636.802 164.774 636.802 DL 174.774 636.802 169.774 636.802 DL 179.774 636.802
174.774 636.802 DL 184.774 636.802 179.774 636.802 DL 189.774 636.802 184.774
636.802 DL 194.774 636.802 189.774 636.802 DL 199.774 636.802 194.774 636.802
DL 204.774 636.802 199.774 636.802 DL 209.774 636.802 204.774 636.802 DL
214.774 636.802 209.774 636.802 DL 219.774 636.802 214.774 636.802 DL 224.774
636.802 219.774 636.802 DL 229.774 636.802 224.774 636.802 DL 234.774 636.802
229.774 636.802 DL 239.774 636.802 234.774 636.802 DL 244.774 636.802 239.774
636.802 DL 249.774 636.802 244.774 636.802 DL 254.774 636.802 249.774 636.802
DL 259.774 636.802 254.774 636.802 DL 264.774 636.802 259.774 636.802 DL
269.774 636.802 264.774 636.802 DL 274.774 636.802 269.774 636.802 DL 279.774
636.802 274.774 636.802 DL 284.774 636.802 279.774 636.802 DL 289.774 636.802
284.774 636.802 DL 294.774 636.802 289.774 636.802 DL 299.774 636.802 294.774
636.802 DL 304.774 636.802 299.774 636.802 DL 309.774 636.802 304.774 636.802
DL 314.774 636.802 309.774 636.802 DL 319.774 636.802 314.774 636.802 DL
324.774 636.802 319.774 636.802 DL 329.774 636.802 324.774 636.802 DL 334.774
636.802 329.774 636.802 DL 339.774 636.802 334.774 636.802 DL 344.774 636.802
339.774 636.802 DL 349.774 636.802 344.774 636.802 DL 354.774 636.802 349.774
636.802 DL 359.774 636.802 354.774 636.802 DL 364.774 636.802 359.774 636.802
DL 369.774 636.802 364.774 636.802 DL 374.774 636.802 369.774 636.802 DL
379.774 636.802 374.774 636.802 DL 384.774 636.802 379.774 636.802 DL 389.774
636.802 384.774 636.802 DL 394.774 636.802 389.774 636.802 DL 399.774 636.802
394.774 636.802 DL 404.774 636.802 399.774 636.802 DL 409.774 636.802 404.774
636.802 DL 414.774 636.802 409.774 636.802 DL 419.774 636.802 414.774 636.802
DL 424.774 636.802 419.774 636.802 DL 429.774 636.802 424.774 636.802 DL
434.774 636.802 429.774 636.802 DL 439.774 636.802 434.774 636.802 DL 444.774
636.802 439.774 636.802 DL 449.774 636.802 444.774 636.802 DL 454.774 636.802
449.774 636.802 DL 459.774 636.802 454.774 636.802 DL 464.774 636.802 459.774
636.802 DL 469.774 636.802 464.774 636.802 DL 474.774 636.802 469.774 636.802
DL F6 -1.5(shm / test1.c)477.024 639.302 R/F8 8/Palatino-Bold@0 SF
(Figure 12.16)218.332 652.802 Q/F9 8/Palatino-Roman@0 SF(Memory mapping when)6
E/F10 8/Courier@0 SF(mmap)2 E F9(equals \214le size.)2 E EP
%%Page: 318 16
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(318)93.6 82 Q/F1 9/Palatino-Roman@0 SF(Shar)125.1 82 Q
2.25(ed Memory Intr)-.162 F 227.622(oduction Chapter)-.162 F(12)2.25 E .32 LW
97.6 89.2 93.6 89.2 DL 99.6 89.2 95.6 89.2 DL 103.6 89.2 99.6 89.2 DL 107.6
89.2 103.6 89.2 DL 111.6 89.2 107.6 89.2 DL 115.6 89.2 111.6 89.2 DL 119.6 89.2
115.6 89.2 DL 123.6 89.2 119.6 89.2 DL 127.6 89.2 123.6 89.2 DL 131.6 89.2
127.6 89.2 DL 135.6 89.2 131.6 89.2 DL 139.6 89.2 135.6 89.2 DL 143.6 89.2
139.6 89.2 DL 147.6 89.2 143.6 89.2 DL 151.6 89.2 147.6 89.2 DL 155.6 89.2
151.6 89.2 DL 159.6 89.2 155.6 89.2 DL 163.6 89.2 159.6 89.2 DL 167.6 89.2
163.6 89.2 DL 171.6 89.2 167.6 89.2 DL 175.6 89.2 171.6 89.2 DL 179.6 89.2
175.6 89.2 DL 183.6 89.2 179.6 89.2 DL 187.6 89.2 183.6 89.2 DL 191.6 89.2
187.6 89.2 DL 195.6 89.2 191.6 89.2 DL 199.6 89.2 195.6 89.2 DL 203.6 89.2
199.6 89.2 DL 207.6 89.2 203.6 89.2 DL 211.6 89.2 207.6 89.2 DL 215.6 89.2
211.6 89.2 DL 219.6 89.2 215.6 89.2 DL 223.6 89.2 219.6 89.2 DL 227.6 89.2
223.6 89.2 DL 231.6 89.2 227.6 89.2 DL 235.6 89.2 231.6 89.2 DL 239.6 89.2
235.6 89.2 DL 243.6 89.2 239.6 89.2 DL 247.6 89.2 243.6 89.2 DL 251.6 89.2
247.6 89.2 DL 255.6 89.2 251.6 89.2 DL 259.6 89.2 255.6 89.2 DL 263.6 89.2
259.6 89.2 DL 267.6 89.2 263.6 89.2 DL 271.6 89.2 267.6 89.2 DL 275.6 89.2
271.6 89.2 DL 279.6 89.2 275.6 89.2 DL 283.6 89.2 279.6 89.2 DL 287.6 89.2
283.6 89.2 DL 291.6 89.2 287.6 89.2 DL 295.6 89.2 291.6 89.2 DL 299.6 89.2
295.6 89.2 DL 303.6 89.2 299.6 89.2 DL 307.6 89.2 303.6 89.2 DL 311.6 89.2
307.6 89.2 DL 315.6 89.2 311.6 89.2 DL 319.6 89.2 315.6 89.2 DL 323.6 89.2
319.6 89.2 DL 327.6 89.2 323.6 89.2 DL 331.6 89.2 327.6 89.2 DL 335.6 89.2
331.6 89.2 DL 339.6 89.2 335.6 89.2 DL 343.6 89.2 339.6 89.2 DL 347.6 89.2
343.6 89.2 DL 351.6 89.2 347.6 89.2 DL 355.6 89.2 351.6 89.2 DL 359.6 89.2
355.6 89.2 DL 363.6 89.2 359.6 89.2 DL 367.6 89.2 363.6 89.2 DL 371.6 89.2
367.6 89.2 DL 375.6 89.2 371.6 89.2 DL 379.6 89.2 375.6 89.2 DL 383.6 89.2
379.6 89.2 DL 387.6 89.2 383.6 89.2 DL 391.6 89.2 387.6 89.2 DL 395.6 89.2
391.6 89.2 DL 399.6 89.2 395.6 89.2 DL 403.6 89.2 399.6 89.2 DL 407.6 89.2
403.6 89.2 DL 411.6 89.2 407.6 89.2 DL 415.6 89.2 411.6 89.2 DL 419.6 89.2
415.6 89.2 DL 423.6 89.2 419.6 89.2 DL 427.6 89.2 423.6 89.2 DL 431.6 89.2
427.6 89.2 DL 435.6 89.2 431.6 89.2 DL 439.6 89.2 435.6 89.2 DL 443.6 89.2
439.6 89.2 DL 447.6 89.2 443.6 89.2 DL 451.6 89.2 447.6 89.2 DL 455.6 89.2
451.6 89.2 DL 459.6 89.2 455.6 89.2 DL 463.6 89.2 459.6 89.2 DL 467.6 89.2
463.6 89.2 DL 471.6 89.2 467.6 89.2 DL 475.6 89.2 471.6 89.2 DL 479.6 89.2
475.6 89.2 DL 483.6 89.2 479.6 89.2 DL 487.6 89.2 483.6 89.2 DL 491.6 89.2
487.6 89.2 DL 495.6 89.2 491.6 89.2 DL 499.6 89.2 495.6 89.2 DL 503.6 89.2
499.6 89.2 DL 507.6 89.2 503.6 89.2 DL 511.6 89.2 507.6 89.2 DL 515.6 89.2
511.6 89.2 DL 519.6 89.2 515.6 89.2 DL/F2 9/Helvetica-Bold@0 SF(Command)129.6
123 Q(-)-.81 I(line ar).81 I(guments)-.135 E/F3 7/Courier-Oblique@0 SF(8\21111)
108.48 138 Q/F4 10/Palatino-Roman@0 SF .894(The command)147.6 138 R(-)-.9 I
.894(line ar).9 J .894
(guments specify the pathname of the \214le that will be cr)-.18 F(eated)-.18 E
.178(and memory mapped, the size to which that \214le is set, and the size of \
the memory map-)129.6 150 R(ping.)129.6 162 Q F2 -2.412(Create ,)129.6 178 R
(open, truncate \214le; set \214le siz)2.502 E(e).09 E F3(12\21115)104.28 193 Q
F4 .939(The \214le being opened is cr)147.6 193 R .939
(eated if it does not exist, or tr)-.18 F .94(uncated to a size of 0 if it)-.08
F(alr)129.6 205 Q .357(eady exists.)-.18 F .356(The size of the \214le is then\
 set to the speci\214ed size by seeking to that size)5.357 F
(minus 1 byte and writing 1 byte.)129.6 217 Q F2 -2.412(Memor y)129.6 233 R
(map \214le)2.502 E F3(16\21117)104.28 248 Q F4 2.153(The \214le is memory map\
ped, using the size speci\214ed as the \214nal command)147.6 248 R(-)-.9 I
(line).9 I(ar)129.6 260 Q 2.5(gument. The)-.18 F(descriptor is then closed.)2.5
E F2(Print pa)129.6 276 Q -.18 .09(ge s)-.09 H -2.412(iz e)-.09 F F3(18\21119)
104.28 291 Q F4(The page size of the implementation is obtained using)147.6 291
Q/F5 10/Courier@0 SF(sysconf)2.5 E F4(and printed.)2.5 E F2
(Read and store the memor)129.6 307 Q(y-mapped region).09 E F3(20\21126)104.28
322 Q F4 .464(The memory-mapped r)147.6 322 R .464(egion is r)-.18 F .463
(ead \(the \214rst byte of each page and the last byte of)-.18 F .037
(each page\), and the values printed.)129.6 334 R 1.878 -.92(We e)5.038 H .038
(xpect the values to all be 0.).92 F 1.878 -.92(We a)5.038 H .038
(lso set the \214rst).92 F 1.491(and last bytes of the page to 1.)129.6 346 R
3.331 -.92(We e)6.491 H 1.49(xpect one of the r).92 F(efer)-.18 E 1.49
(ences to generate a signal)-.18 F(eventually)129.6 358 Q 2.905(,w)-1.11 G .405
(hich will terminate the pr)188.955 358 R 2.905(ogram. When)-.18 F(the)2.905 E
F5(for)2.905 E F4 .405(loop terminates, we print)2.905 F .422(the \214rst byte\
 of the next page, expecting this to fail \(assuming that the pr)129.6 370 R
.421(ogram has not)-.18 F(alr)129.6 382 Q(eady failed\).)-.18 E 1.377(The \214\
rst scenario that we show is when the \214le size equals the memory-mapped)
147.6 406 R(size, but this size is not a multiple of the page size.)129.6 418 Q
/F6 8.15/Courier@0 SF(solaris %)147.6 434 Q/F7 8.15/Courier-Bold@0 SF
(ls -l foo)4.89 E F6(foo: No such file or directory)147.6 444 Q(solaris %)147.6
454 Q F7(test1 foo 5000 5000)4.89 E F6(PAGESIZE = 4096)147.6 464 Q(ptr[0] = 0)
147.6 474 Q(ptr[4095] = 0)147.6 484 Q(ptr[4096] = 0)147.6 494 Q(ptr[8191] = 0)
147.6 504 Q(Segmentation Fault\(coredump\))147.6 514 Q(solaris %)147.6 524 Q F7
(ls -l foo)4.89 E F6 9.78(-rw-r--r-- 1)147.6 534 R(rstevens other1)4.89 E
(5000 Mar 20 17:18 foo)323.64 534 Q(solaris %)147.6 544 Q F7(od -b -A d foo)
4.89 E F6
(0000000 001 000 000 000 000 000 000 000 000 000 000 000 000 000 000 000)147.6
554 Q(0000016 000 000 000 000 000 000 000 000 000 000 000 000 000 000 000 000)
147.6 564 Q(*)147.6 574 Q
(0004080 000 000 000 000 000 000 000 000 000 000 000 000 000 000 000 001)147.6
584 Q(0004096 001 000 000 000 000 000 000 000 000 000 000 000 000 000 000 000)
147.6 594 Q
(0004112 000 000 000 000 000 000 000 000 000 000 000 000 000 000 000 000)147.6
604 Q(*)147.6 614 Q(0005000)147.6 624 Q F4 .036
(The page size is 4096 bytes, and we ar)129.6 642 R 2.536(ea)-.18 G .036
(ble to r)309.114 642 R .036(ead the entir)-.18 F 2.536(es)-.18 G .035
(econd page \(indexes 4096)406.864 642 R(thr)129.6 654 Q .349
(ough 8191\), but a r)-.18 F(efer)-.18 E .349(ence to the thir)-.18 F 2.849(dp)
-.18 G .349(age \(index 8192\) generates)324.522 654 R F5(SIGSEGV)2.85 E F4
2.85(,w)C(hich)500.61 654 Q EP
%%Page: 319 17
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF(Section 12.6)93.6 82 Q(Refer)331.572 82 Q 2.25
(encing Memory-Mapped Objects)-.162 F/F1 9/Palatino-Bold@0 SF(319)506.1 82 Q
.32 LW 97.6 89.2 93.6 89.2 DL 99.6 89.2 95.6 89.2 DL 103.6 89.2 99.6 89.2 DL
107.6 89.2 103.6 89.2 DL 111.6 89.2 107.6 89.2 DL 115.6 89.2 111.6 89.2 DL
119.6 89.2 115.6 89.2 DL 123.6 89.2 119.6 89.2 DL 127.6 89.2 123.6 89.2 DL
131.6 89.2 127.6 89.2 DL 135.6 89.2 131.6 89.2 DL 139.6 89.2 135.6 89.2 DL
143.6 89.2 139.6 89.2 DL 147.6 89.2 143.6 89.2 DL 151.6 89.2 147.6 89.2 DL
155.6 89.2 151.6 89.2 DL 159.6 89.2 155.6 89.2 DL 163.6 89.2 159.6 89.2 DL
167.6 89.2 163.6 89.2 DL 171.6 89.2 167.6 89.2 DL 175.6 89.2 171.6 89.2 DL
179.6 89.2 175.6 89.2 DL 183.6 89.2 179.6 89.2 DL 187.6 89.2 183.6 89.2 DL
191.6 89.2 187.6 89.2 DL 195.6 89.2 191.6 89.2 DL 199.6 89.2 195.6 89.2 DL
203.6 89.2 199.6 89.2 DL 207.6 89.2 203.6 89.2 DL 211.6 89.2 207.6 89.2 DL
215.6 89.2 211.6 89.2 DL 219.6 89.2 215.6 89.2 DL 223.6 89.2 219.6 89.2 DL
227.6 89.2 223.6 89.2 DL 231.6 89.2 227.6 89.2 DL 235.6 89.2 231.6 89.2 DL
239.6 89.2 235.6 89.2 DL 243.6 89.2 239.6 89.2 DL 247.6 89.2 243.6 89.2 DL
251.6 89.2 247.6 89.2 DL 255.6 89.2 251.6 89.2 DL 259.6 89.2 255.6 89.2 DL
263.6 89.2 259.6 89.2 DL 267.6 89.2 263.6 89.2 DL 271.6 89.2 267.6 89.2 DL
275.6 89.2 271.6 89.2 DL 279.6 89.2 275.6 89.2 DL 283.6 89.2 279.6 89.2 DL
287.6 89.2 283.6 89.2 DL 291.6 89.2 287.6 89.2 DL 295.6 89.2 291.6 89.2 DL
299.6 89.2 295.6 89.2 DL 303.6 89.2 299.6 89.2 DL 307.6 89.2 303.6 89.2 DL
311.6 89.2 307.6 89.2 DL 315.6 89.2 311.6 89.2 DL 319.6 89.2 315.6 89.2 DL
323.6 89.2 319.6 89.2 DL 327.6 89.2 323.6 89.2 DL 331.6 89.2 327.6 89.2 DL
335.6 89.2 331.6 89.2 DL 339.6 89.2 335.6 89.2 DL 343.6 89.2 339.6 89.2 DL
347.6 89.2 343.6 89.2 DL 351.6 89.2 347.6 89.2 DL 355.6 89.2 351.6 89.2 DL
359.6 89.2 355.6 89.2 DL 363.6 89.2 359.6 89.2 DL 367.6 89.2 363.6 89.2 DL
371.6 89.2 367.6 89.2 DL 375.6 89.2 371.6 89.2 DL 379.6 89.2 375.6 89.2 DL
383.6 89.2 379.6 89.2 DL 387.6 89.2 383.6 89.2 DL 391.6 89.2 387.6 89.2 DL
395.6 89.2 391.6 89.2 DL 399.6 89.2 395.6 89.2 DL 403.6 89.2 399.6 89.2 DL
407.6 89.2 403.6 89.2 DL 411.6 89.2 407.6 89.2 DL 415.6 89.2 411.6 89.2 DL
419.6 89.2 415.6 89.2 DL 423.6 89.2 419.6 89.2 DL 427.6 89.2 423.6 89.2 DL
431.6 89.2 427.6 89.2 DL 435.6 89.2 431.6 89.2 DL 439.6 89.2 435.6 89.2 DL
443.6 89.2 439.6 89.2 DL 447.6 89.2 443.6 89.2 DL 451.6 89.2 447.6 89.2 DL
455.6 89.2 451.6 89.2 DL 459.6 89.2 455.6 89.2 DL 463.6 89.2 459.6 89.2 DL
467.6 89.2 463.6 89.2 DL 471.6 89.2 467.6 89.2 DL 475.6 89.2 471.6 89.2 DL
479.6 89.2 475.6 89.2 DL 483.6 89.2 479.6 89.2 DL 487.6 89.2 483.6 89.2 DL
491.6 89.2 487.6 89.2 DL 495.6 89.2 491.6 89.2 DL 499.6 89.2 495.6 89.2 DL
503.6 89.2 499.6 89.2 DL 507.6 89.2 503.6 89.2 DL 511.6 89.2 507.6 89.2 DL
515.6 89.2 511.6 89.2 DL 519.6 89.2 515.6 89.2 DL/F2 10/Palatino-Roman@0 SF
1.727(the shell prints as `)129.6 123 R 1.727(`Segmentation Fault.')-.37 F
6.727('E)-.37 G 1.727(ven though we set)329.932 123 R/F3 10/Courier@0 SF
(ptr[8191])4.227 E F2 1.727(to 1, this)4.227 F .687
(value is not written to the \214le, and the \214le's size r)129.6 135 R .688
(emains 5000.)-.18 F .688(The kernel lets us r)5.688 F(ead)-.18 E .021(and wri\
te that portion of the \214nal page beyond our mapping \(since the kernel's me\
mory)129.6 147 R(pr)129.6 159 Q .071(otection works with pages\), but anything\
 that we write to this extension is not written)-.18 F .354(to the \214le.)
129.6 171 R .354
(The other 3 bytes that we set to 1, indexes 0, 4095, and 4096, ar)5.354 F
2.853(ec)-.18 G .353(opied back)470.937 171 R 1.515
(to the \214le, which we verify with the)129.6 183 R F3(od)4.016 E F2 4.016
(command. \(The)4.016 F F3(-b)4.016 E F2 1.516(option says to print the)4.016 F
.41(bytes in octal, and the)129.6 195 R F3 -3.09(-A d)2.91 F F2 .41
(option says to print the addr)2.91 F .41(esses in decimal.\))-.18 F(Figur)5.41
E 2.91(e1)-.18 G(2.17)502.1 195 Q(depicts this example.)129.6 207 Q 349.8 275.8
MT 0 -28.8 RL -129.6 0 RL 0 28.8 RL CL ST/F4 8/Palatino-Roman@0 SF(\214le)279.5
263.16 Q 349.8 340.6 MT 0 -28.8 RL -129.6 0 RL 0 28.8 RL CL ST(memory-mapped r)
241.676 327.96 Q(egion)-.144 E 407.4 340.6 MT 0 -28.8 RL -57.6 0 RL 0 28.8 RL
CL 0.8000 FL 353.4 340.6 349.8 340.6 DL 361.104 340.6 357.504 340.6 DL 368.808
340.6 365.208 340.6 DL 376.512 340.6 372.912 340.6 DL 384.288 340.6 380.688
340.6 DL 391.992 340.6 388.392 340.6 DL 399.696 340.6 396.096 340.6 DL 407.4
340.6 403.8 340.6 DL 407.4 337 407.4 340.6 DL 407.4 328.576 407.4 332.176 DL
407.4 320.224 407.4 323.824 DL 407.4 311.8 407.4 315.4 DL 403.8 311.8 407.4
311.8 DL 396.096 311.8 399.696 311.8 DL 388.392 311.8 391.992 311.8 DL 380.688
311.8 384.288 311.8 DL 372.912 311.8 376.512 311.8 DL 365.208 311.8 368.808
311.8 DL 357.504 311.8 361.104 311.8 DL 349.8 311.8 353.4 311.8 DL 349.8 315.4
349.8 311.8 DL 349.8 323.824 349.8 320.224 DL 349.8 332.176 349.8 328.576 DL
349.8 340.6 349.8 337 DL -.144(re)360.212 322.96 S(mainder).144 E(of last page)
358.376 332.96 Q(of)196.816 282.56 Q(fset:)-.144 E(0)222.2 282.56 Q(4999)331.8
282.56 Q(index:)196.368 308.56 Q(0)222.2 308.56 Q(4999)331.8 308.56 Q(5000)
351.8 308.56 Q(8191)389.4 308.56 Q 220.2 362.2 220.2 347.8 DL 407.4 362.2 407.4
347.8 DL 285 355 220.2 355 DL 220.2 355 MT 7.2 -1.8 RL 0 3.6 RL CL BL 220.2 355
MT 7.2 -1.8 RL 0 3.6 RL CL ST 342.6 355 407.4 355 DL 407.4 355 MT -7.2 1.8 RL 0
-3.6 RL CL BL 407.4 355 MT -7.2 1.8 RL 0 -3.6 RL CL ST -.144(re)288.94 356.76 S
(fer).144 E(ences OK)-.144 E 421.8 356.44 407.4 356.44 DL 421.8 356.44 MT -7.2
1.8 RL 0 -3.6 RL CL BL 421.8 356.44 MT -7.2 1.8 RL 0 -3.6 RL CL ST -.144(re)
425.4 348.2 S(fer).144 E(ences)-.144 E(generate)425.4 358.2 Q/F5 8/Courier@0 SF
(SIGSEGV)425.4 368.2 Q 349.8 229 349.8 243.4 DL 349.8 243.4 MT -1.8 -7.2 RL 3.6
0 RL CL BL 349.8 243.4 MT -1.8 -7.2 RL 3.6 0 RL CL ST F4(\214le size)336.524
225.76 Q 349.8 373 349.8 358.6 DL 349.8 358.6 MT 1.8 7.2 RL -3.6 0 RL CL BL
349.8 358.6 MT 1.8 7.2 RL -3.6 0 RL CL ST F5(mmap\(\))327.624 379.76 Q F4(size)
2 E/F6 8/Palatino-Bold@0 SF(Figure 12.17)210.556 391 Q F4(Memory mapping when)6
E F5(mmap)2 E F4(size equals \214le size.)2 E F2 .562(If we r)147.6 415 R .562
(un our example under Digital Unix, we see similar r)-.08 F .562
(esults, but the page size)-.18 F(is now 8192.)129.6 427 Q/F7 8.15/Courier@0 SF
(alpha %)147.6 443 Q/F8 8.15/Courier-Bold@0 SF(ls -l foo)4.89 E F7
(foo not found)147.6 453 Q(alpha %)147.6 463 Q F8(test1 foo 5000 5000)4.89 E F7
(PAGESIZE = 8192)147.6 473 Q(ptr[0] = 0)147.6 483 Q(ptr[8191] = 0)147.6 493 Q
(Memory fault\(coredump\))147.6 503 Q(alpha %)147.6 513 Q F8(ls -l foo)4.89 E
F7 9.78(-rw-r--r-- 1)147.6 523 R(rstevens operator)4.89 E
(5000 Mar 21 08:40 foo)323.64 523 Q F2 2.292 -.92(We a)129.6 541 T .812 -.18
(re s).92 H .452(till able to r).18 F(efer)-.18 E .451
(ence beyond the end of our memory-mapped r)-.18 F .451(egion but within)-.18 F
.999(that page of memory \(indexes 5000 thr)129.6 553 R .999(ough 8191\).)-.18
F(Refer)5.999 E(encing)-.18 E F3(ptr[8192])3.499 E F2(generates)3.499 E F3
(SIGSEGV)129.6 565 Q F2 2.5(,a)C 2.5(sw)181.6 565 S 2.5(ee)196.68 565 S(xpect.)
208.76 565 Q .184(In our next example with Figur)147.6 577 R 2.684(e1)-.18 G
.184(2.16, we specify a memory mapping \(15000 bytes\))298.804 577 R
(that is lar)129.6 589 Q(ger than the \214le size \(5000 bytes\).)-.18 E F7
(solaris %)147.6 605 Q F8(rm foo)4.89 E F7(solaris %)147.6 615 Q F8
(test1 foo 5000 15000)4.89 E F7(PAGESIZE = 4096)147.6 625 Q(ptr[0] = 0)147.6
635 Q(ptr[4095] = 0)147.6 645 Q(ptr[4096] = 0)147.6 655 Q EP
%%Page: 320 18
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(320)93.6 82 Q/F1 9/Palatino-Roman@0 SF(Shar)125.1 82 Q
2.25(ed Memory Intr)-.162 F 227.622(oduction Chapter)-.162 F(12)2.25 E .32 LW
97.6 89.2 93.6 89.2 DL 99.6 89.2 95.6 89.2 DL 103.6 89.2 99.6 89.2 DL 107.6
89.2 103.6 89.2 DL 111.6 89.2 107.6 89.2 DL 115.6 89.2 111.6 89.2 DL 119.6 89.2
115.6 89.2 DL 123.6 89.2 119.6 89.2 DL 127.6 89.2 123.6 89.2 DL 131.6 89.2
127.6 89.2 DL 135.6 89.2 131.6 89.2 DL 139.6 89.2 135.6 89.2 DL 143.6 89.2
139.6 89.2 DL 147.6 89.2 143.6 89.2 DL 151.6 89.2 147.6 89.2 DL 155.6 89.2
151.6 89.2 DL 159.6 89.2 155.6 89.2 DL 163.6 89.2 159.6 89.2 DL 167.6 89.2
163.6 89.2 DL 171.6 89.2 167.6 89.2 DL 175.6 89.2 171.6 89.2 DL 179.6 89.2
175.6 89.2 DL 183.6 89.2 179.6 89.2 DL 187.6 89.2 183.6 89.2 DL 191.6 89.2
187.6 89.2 DL 195.6 89.2 191.6 89.2 DL 199.6 89.2 195.6 89.2 DL 203.6 89.2
199.6 89.2 DL 207.6 89.2 203.6 89.2 DL 211.6 89.2 207.6 89.2 DL 215.6 89.2
211.6 89.2 DL 219.6 89.2 215.6 89.2 DL 223.6 89.2 219.6 89.2 DL 227.6 89.2
223.6 89.2 DL 231.6 89.2 227.6 89.2 DL 235.6 89.2 231.6 89.2 DL 239.6 89.2
235.6 89.2 DL 243.6 89.2 239.6 89.2 DL 247.6 89.2 243.6 89.2 DL 251.6 89.2
247.6 89.2 DL 255.6 89.2 251.6 89.2 DL 259.6 89.2 255.6 89.2 DL 263.6 89.2
259.6 89.2 DL 267.6 89.2 263.6 89.2 DL 271.6 89.2 267.6 89.2 DL 275.6 89.2
271.6 89.2 DL 279.6 89.2 275.6 89.2 DL 283.6 89.2 279.6 89.2 DL 287.6 89.2
283.6 89.2 DL 291.6 89.2 287.6 89.2 DL 295.6 89.2 291.6 89.2 DL 299.6 89.2
295.6 89.2 DL 303.6 89.2 299.6 89.2 DL 307.6 89.2 303.6 89.2 DL 311.6 89.2
307.6 89.2 DL 315.6 89.2 311.6 89.2 DL 319.6 89.2 315.6 89.2 DL 323.6 89.2
319.6 89.2 DL 327.6 89.2 323.6 89.2 DL 331.6 89.2 327.6 89.2 DL 335.6 89.2
331.6 89.2 DL 339.6 89.2 335.6 89.2 DL 343.6 89.2 339.6 89.2 DL 347.6 89.2
343.6 89.2 DL 351.6 89.2 347.6 89.2 DL 355.6 89.2 351.6 89.2 DL 359.6 89.2
355.6 89.2 DL 363.6 89.2 359.6 89.2 DL 367.6 89.2 363.6 89.2 DL 371.6 89.2
367.6 89.2 DL 375.6 89.2 371.6 89.2 DL 379.6 89.2 375.6 89.2 DL 383.6 89.2
379.6 89.2 DL 387.6 89.2 383.6 89.2 DL 391.6 89.2 387.6 89.2 DL 395.6 89.2
391.6 89.2 DL 399.6 89.2 395.6 89.2 DL 403.6 89.2 399.6 89.2 DL 407.6 89.2
403.6 89.2 DL 411.6 89.2 407.6 89.2 DL 415.6 89.2 411.6 89.2 DL 419.6 89.2
415.6 89.2 DL 423.6 89.2 419.6 89.2 DL 427.6 89.2 423.6 89.2 DL 431.6 89.2
427.6 89.2 DL 435.6 89.2 431.6 89.2 DL 439.6 89.2 435.6 89.2 DL 443.6 89.2
439.6 89.2 DL 447.6 89.2 443.6 89.2 DL 451.6 89.2 447.6 89.2 DL 455.6 89.2
451.6 89.2 DL 459.6 89.2 455.6 89.2 DL 463.6 89.2 459.6 89.2 DL 467.6 89.2
463.6 89.2 DL 471.6 89.2 467.6 89.2 DL 475.6 89.2 471.6 89.2 DL 479.6 89.2
475.6 89.2 DL 483.6 89.2 479.6 89.2 DL 487.6 89.2 483.6 89.2 DL 491.6 89.2
487.6 89.2 DL 495.6 89.2 491.6 89.2 DL 499.6 89.2 495.6 89.2 DL 503.6 89.2
499.6 89.2 DL 507.6 89.2 503.6 89.2 DL 511.6 89.2 507.6 89.2 DL 515.6 89.2
511.6 89.2 DL 519.6 89.2 515.6 89.2 DL/F2 8.15/Courier@0 SF(ptr[8191] = 0)147.6
121 Q(Bus Error\(coredump\))147.6 131 Q(solaris %)147.6 141 Q/F3 8.15
/Courier-Bold@0 SF(ls -l foo)4.89 E F2 9.78(-rw-r--r-- 1)147.6 151 R
(rstevens other1)4.89 E(5000 Mar 20 17:37 foo)323.64 151 Q/F4 10
/Palatino-Roman@0 SF .991(The r)129.6 169 R .991(esults ar)-.18 F 3.491(es)-.18
G .991(imilar to our earlier example when the \214le size and the memory map)
203.853 169 R .326(size wer)129.6 181 R 2.826(et)-.18 G .326
(he same \(both 5000\).)177.142 181 R .325(This example generates)5.325 F/F5 10
/Courier@0 SF(SIGBUS)2.825 E F4 .325(\(which the shell prints)2.825 F .987
(as `)129.6 193 R .987(`Bus Err)-.37 F -1.76(or ')-.18 F .987('\), wher)-.37 F
.987(eas the pr)-.18 F .987(evious example generated)-.18 F F5(SIGSEGV)3.487 E
F4 5.988(.T)C .988(he dif)450.964 193 R(fer)-.18 E .988(ence is)-.18 F(that)
129.6 205 Q F5(SIGBUS)2.618 E F4 .117(means we have r)2.618 F(efer)-.18 E .117
(enced within our memory-mapped r)-.18 F .117(egion but beyond)-.18 F .414
(the size of the underlying object.)129.6 217 R(The)5.414 E F5(SIGSEGV)2.914 E
F4 .414(in the pr)2.914 F .415(evious example meant we had)-.18 F -.18(re)129.6
229 S(fer).18 E .615(enced beyond the end of our memory-mapped r)-.18 F 3.115
(egion. What)-.18 F .615(we have shown her)3.115 F(e)-.18 E .249(is that the k\
ernel knows the size of the underlying object that is mapped \(the \214le)129.6
241 R F5(foo)2.749 E F4(in)2.749 E .416
(this case\), even though we have closed the descriptor for that object.)129.6
253 R .415(The kernel allows)5.415 F .08(us to specify a size to)129.6 265 R F5
(mmap)2.58 E F4 .08(that is lar)2.58 F .08
(ger than the size of this object, but we cannot r)-.18 F(efer)-.18 E(-)-.18 E
.573
(ence beyond its end \(except for the bytes within the \214nal page that ar)
129.6 277 R 3.072(eb)-.18 G .572(eyond the end)455.126 277 R
(of the object, indexes 5000 thr)129.6 289 Q(ough 8191\).)-.18 E(Figur)5 E 2.5
(e1)-.18 G(2.18 depicts this example.)352.07 289 Q 285 357.8 MT 0 -28.8 RL
-129.6 0 RL 0 28.8 RL CL ST/F6 8/Palatino-Roman@0 SF(\214le)214.7 345.16 Q 285
422.6 MT 0 -28.8 RL -129.6 0 RL 0 28.8 RL CL ST 342.6 422.6 MT 0 -28.8 RL -57.6
0 RL 0 28.8 RL CL 0.8000 FL 288.6 422.6 285 422.6 DL 296.304 422.6 292.704
422.6 DL 304.008 422.6 300.408 422.6 DL 311.712 422.6 308.112 422.6 DL 319.488
422.6 315.888 422.6 DL 327.192 422.6 323.592 422.6 DL 334.896 422.6 331.296
422.6 DL 342.6 422.6 339 422.6 DL 342.6 419 342.6 422.6 DL 342.6 410.576 342.6
414.176 DL 342.6 402.224 342.6 405.824 DL 342.6 393.8 342.6 397.4 DL 339 393.8
342.6 393.8 DL 331.296 393.8 334.896 393.8 DL 323.592 393.8 327.192 393.8 DL
315.888 393.8 319.488 393.8 DL 308.112 393.8 311.712 393.8 DL 300.408 393.8
304.008 393.8 DL 292.704 393.8 296.304 393.8 DL 285 393.8 288.6 393.8 DL 285
397.4 285 393.8 DL 285 405.824 285 402.224 DL 285 414.176 285 410.576 DL 285
422.6 285 419 DL -.144(re)295.412 404.96 S(mainder).144 E(of page)300.74 414.96
Q 472.2 422.6 MT 0 -28.8 RL -129.6 0 RL 0 28.8 RL CL ST(of)132.016 364.56 Q
(fset:)-.144 E(0)157.4 364.56 Q(4999)267 364.56 Q(index:)131.568 390.56 Q(0)
157.4 390.56 Q(4999)267 390.56 Q(5000)287 390.56 Q(8191)324.6 390.56 Q(8192)
344.6 390.56 Q(14999)450.2 390.56 Q 155.4 444.2 155.4 429.8 DL 342.6 444.2
342.6 429.8 DL 220.2 437 155.4 437 DL 155.4 437 MT 7.2 -1.8 RL 0 3.6 RL CL BL
155.4 437 MT 7.2 -1.8 RL 0 3.6 RL CL ST 277.8 437 342.6 437 DL 342.6 437 MT
-7.2 1.8 RL 0 -3.6 RL CL BL 342.6 437 MT -7.2 1.8 RL 0 -3.6 RL CL ST -.144(re)
224.14 438.76 S(fer).144 E(ences OK)-.144 E 342.6 444.2 342.6 429.8 DL 472.2
444.2 472.2 429.8 DL 385.8 437 342.6 437 DL 342.6 437 MT 7.2 -1.8 RL 0 3.6 RL
CL BL 342.6 437 MT 7.2 -1.8 RL 0 3.6 RL CL ST 429 437 472.2 437 DL 472.2 437 MT
-7.2 1.8 RL 0 -3.6 RL CL BL 472.2 437 MT -7.2 1.8 RL 0 -3.6 RL CL ST/F7 8
/Courier@0 SF(SIGBUS)393 438.76 Q 486.6 438.44 472.2 438.44 DL 486.6 438.44 MT
-7.2 1.8 RL 0 -3.6 RL CL BL 486.6 438.44 MT -7.2 1.8 RL 0 -3.6 RL CL ST F6
-.144(re)490.2 430.2 S(fer).144 E(ences)-.144 E(generate)490.2 440.2 Q F7
(SIGSEGV)490.2 450.2 Q 285 311 285 325.4 DL 285 325.4 MT -1.8 -7.2 RL 3.6 0 RL
CL BL 285 325.4 MT -1.8 -7.2 RL 3.6 0 RL CL ST F6(\214le size)271.724 307.76 Q
472.2 375.8 472.2 390.2 DL 472.2 390.2 MT -1.8 -7.2 RL 3.6 0 RL CL BL 472.2
390.2 MT -1.8 -7.2 RL 3.6 0 RL CL ST F7(mmap\(\))450.024 372.56 Q F6(size)2 E
/F8 8/Palatino-Bold@0 SF(Figure 12.18)208.256 470.84 Q F6(Memory mapping when)6
E F7(mmap)2 E F6(size exceeds \214le size.)2 E F4 .366(Our next pr)147.6 506.84
R .366(ogram is shown in Figur)-.18 F 2.866(e1)-.18 G 2.866(2.19. It)322.292
506.84 R .367(shows a common technique for han-)2.867 F .505
(dling a \214le that is gr)129.6 518.84 R .505
(owing: specify a memory-map size that is lar)-.18 F .505
(ger than the \214le, keep)-.18 F .741(track of the \214le's curr)129.6 530.84
R .741(ent size \(making certain not to r)-.18 F(efer)-.18 E .742
(ence beyond the curr)-.18 F .742(ent end-)-.18 F
(of-\214le\), and then just let the \214le's size incr)129.6 542.84 Q
(ease as mor)-.18 E 2.5(ed)-.18 G(ata is written to the \214le.)377.79 542.84 Q
/F9 9/Helvetica-Bold@0 SF(Open \214le)129.6 558.84 Q/F10 7/Courier-Oblique@0 SF
(9\21111)108.48 573.84 Q F4 2.214 -.92(We o)147.6 573.84 T .374
(pen a \214le, cr).92 F .374(eating it if it does not exist or tr)-.18 F .374
(uncating it if it alr)-.08 F .373(eady exists.)-.18 F(The)5.373 E
(\214le is memory mapped with a size of 32768, even though the \214le's curr)
129.6 585.84 Q(ent size is 0.)-.18 E F9(Increase \214le siz)129.6 601.84 Q(e)
.09 E F10(12\21116)104.28 616.84 Q F4 3.202 -.92(We i)147.6 616.84 T(ncr).92 E
1.363(ease the size of the \214le, 4096 bytes at a time, by calling)-.18 F F5
(ftruncate)3.863 E F4(\(Sec-)3.863 E
(tion 13.3\), and fetch the byte that is now the \214nal byte of the \214le.)
129.6 628.84 Q EP
%%Page: 321 19
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF(Section 12.6)93.6 82 Q(Refer)331.572 82 Q 2.25
(encing Memory-Mapped Objects)-.162 F/F1 9/Palatino-Bold@0 SF(321)506.1 82 Q
.32 LW 97.6 89.2 93.6 89.2 DL 99.6 89.2 95.6 89.2 DL 103.6 89.2 99.6 89.2 DL
107.6 89.2 103.6 89.2 DL 111.6 89.2 107.6 89.2 DL 115.6 89.2 111.6 89.2 DL
119.6 89.2 115.6 89.2 DL 123.6 89.2 119.6 89.2 DL 127.6 89.2 123.6 89.2 DL
131.6 89.2 127.6 89.2 DL 135.6 89.2 131.6 89.2 DL 139.6 89.2 135.6 89.2 DL
143.6 89.2 139.6 89.2 DL 147.6 89.2 143.6 89.2 DL 151.6 89.2 147.6 89.2 DL
155.6 89.2 151.6 89.2 DL 159.6 89.2 155.6 89.2 DL 163.6 89.2 159.6 89.2 DL
167.6 89.2 163.6 89.2 DL 171.6 89.2 167.6 89.2 DL 175.6 89.2 171.6 89.2 DL
179.6 89.2 175.6 89.2 DL 183.6 89.2 179.6 89.2 DL 187.6 89.2 183.6 89.2 DL
191.6 89.2 187.6 89.2 DL 195.6 89.2 191.6 89.2 DL 199.6 89.2 195.6 89.2 DL
203.6 89.2 199.6 89.2 DL 207.6 89.2 203.6 89.2 DL 211.6 89.2 207.6 89.2 DL
215.6 89.2 211.6 89.2 DL 219.6 89.2 215.6 89.2 DL 223.6 89.2 219.6 89.2 DL
227.6 89.2 223.6 89.2 DL 231.6 89.2 227.6 89.2 DL 235.6 89.2 231.6 89.2 DL
239.6 89.2 235.6 89.2 DL 243.6 89.2 239.6 89.2 DL 247.6 89.2 243.6 89.2 DL
251.6 89.2 247.6 89.2 DL 255.6 89.2 251.6 89.2 DL 259.6 89.2 255.6 89.2 DL
263.6 89.2 259.6 89.2 DL 267.6 89.2 263.6 89.2 DL 271.6 89.2 267.6 89.2 DL
275.6 89.2 271.6 89.2 DL 279.6 89.2 275.6 89.2 DL 283.6 89.2 279.6 89.2 DL
287.6 89.2 283.6 89.2 DL 291.6 89.2 287.6 89.2 DL 295.6 89.2 291.6 89.2 DL
299.6 89.2 295.6 89.2 DL 303.6 89.2 299.6 89.2 DL 307.6 89.2 303.6 89.2 DL
311.6 89.2 307.6 89.2 DL 315.6 89.2 311.6 89.2 DL 319.6 89.2 315.6 89.2 DL
323.6 89.2 319.6 89.2 DL 327.6 89.2 323.6 89.2 DL 331.6 89.2 327.6 89.2 DL
335.6 89.2 331.6 89.2 DL 339.6 89.2 335.6 89.2 DL 343.6 89.2 339.6 89.2 DL
347.6 89.2 343.6 89.2 DL 351.6 89.2 347.6 89.2 DL 355.6 89.2 351.6 89.2 DL
359.6 89.2 355.6 89.2 DL 363.6 89.2 359.6 89.2 DL 367.6 89.2 363.6 89.2 DL
371.6 89.2 367.6 89.2 DL 375.6 89.2 371.6 89.2 DL 379.6 89.2 375.6 89.2 DL
383.6 89.2 379.6 89.2 DL 387.6 89.2 383.6 89.2 DL 391.6 89.2 387.6 89.2 DL
395.6 89.2 391.6 89.2 DL 399.6 89.2 395.6 89.2 DL 403.6 89.2 399.6 89.2 DL
407.6 89.2 403.6 89.2 DL 411.6 89.2 407.6 89.2 DL 415.6 89.2 411.6 89.2 DL
419.6 89.2 415.6 89.2 DL 423.6 89.2 419.6 89.2 DL 427.6 89.2 423.6 89.2 DL
431.6 89.2 427.6 89.2 DL 435.6 89.2 431.6 89.2 DL 439.6 89.2 435.6 89.2 DL
443.6 89.2 439.6 89.2 DL 447.6 89.2 443.6 89.2 DL 451.6 89.2 447.6 89.2 DL
455.6 89.2 451.6 89.2 DL 459.6 89.2 455.6 89.2 DL 463.6 89.2 459.6 89.2 DL
467.6 89.2 463.6 89.2 DL 471.6 89.2 467.6 89.2 DL 475.6 89.2 471.6 89.2 DL
479.6 89.2 475.6 89.2 DL 483.6 89.2 479.6 89.2 DL 487.6 89.2 483.6 89.2 DL
491.6 89.2 487.6 89.2 DL 495.6 89.2 491.6 89.2 DL 499.6 89.2 495.6 89.2 DL
503.6 89.2 499.6 89.2 DL 507.6 89.2 503.6 89.2 DL 511.6 89.2 507.6 89.2 DL
515.6 89.2 511.6 89.2 DL 519.6 89.2 515.6 89.2 DL .4 LW 134.6 123 129.6 123 DL
134.774 123 129.774 123 DL 139.774 123 134.774 123 DL 144.774 123 139.774 123
DL 149.774 123 144.774 123 DL 154.774 123 149.774 123 DL 159.774 123 154.774
123 DL 164.774 123 159.774 123 DL 169.774 123 164.774 123 DL 174.774 123
169.774 123 DL 179.774 123 174.774 123 DL 184.774 123 179.774 123 DL 189.774
123 184.774 123 DL 194.774 123 189.774 123 DL 199.774 123 194.774 123 DL
204.774 123 199.774 123 DL 209.774 123 204.774 123 DL 214.774 123 209.774 123
DL 219.774 123 214.774 123 DL 224.774 123 219.774 123 DL 229.774 123 224.774
123 DL 234.774 123 229.774 123 DL 239.774 123 234.774 123 DL 244.774 123
239.774 123 DL 249.774 123 244.774 123 DL 254.774 123 249.774 123 DL 259.774
123 254.774 123 DL 264.774 123 259.774 123 DL 269.774 123 264.774 123 DL
274.774 123 269.774 123 DL 279.774 123 274.774 123 DL 284.774 123 279.774 123
DL 289.774 123 284.774 123 DL 294.774 123 289.774 123 DL 299.774 123 294.774
123 DL 304.774 123 299.774 123 DL 309.774 123 304.774 123 DL 314.774 123
309.774 123 DL 319.774 123 314.774 123 DL 324.774 123 319.774 123 DL 329.774
123 324.774 123 DL 334.774 123 329.774 123 DL 339.774 123 334.774 123 DL
344.774 123 339.774 123 DL 349.774 123 344.774 123 DL 354.774 123 349.774 123
DL 359.774 123 354.774 123 DL 364.774 123 359.774 123 DL 369.774 123 364.774
123 DL 374.774 123 369.774 123 DL 379.774 123 374.774 123 DL 384.774 123
379.774 123 DL 389.774 123 384.774 123 DL 394.774 123 389.774 123 DL 399.774
123 394.774 123 DL 404.774 123 399.774 123 DL 409.774 123 404.774 123 DL
414.774 123 409.774 123 DL 419.774 123 414.774 123 DL 424.774 123 419.774 123
DL 429.774 123 424.774 123 DL 434.774 123 429.774 123 DL 439.774 123 434.774
123 DL 444.774 123 439.774 123 DL 449.774 123 444.774 123 DL 454.774 123
449.774 123 DL 459.774 123 454.774 123 DL 464.774 123 459.774 123 DL 469.774
123 464.774 123 DL 474.774 123 469.774 123 DL/F2 9/Palatino-Italic@0 SF -1.5
(shm / test2.c)477.024 125.5 R/F3 8.15/Courier@0 SF 4.89(1#)134.49 131.801 S
14.67(include "unpipc.h")149.16 131.801 R 4.89(2#)134.49 148.801 S(define FILE)
149.16 148.801 Q("test.data")222.51 148.801 Q 4.89(3#)134.49 158.801 S
(define SIZE)149.16 158.801 Q(32768)222.51 158.801 Q 4.89(4i)134.49 175.801 S
(nt)149.16 175.801 Q 4.89(5m)134.49 185.801 S(ain\(int argc, char **argv\))
149.16 185.801 Q 4.89(6{)134.49 195.801 S 24.45(7i)134.49 205.801 S 19.56
(nt fd,)168.72 205.801 R(i;)4.89 E 24.45(8c)134.49 215.801 S 9.78(har *ptr;)
168.72 215.801 R 44.01(9/)134.49 232.801 S 4.89(*o)188.28 232.801 S
(pen: create or truncate; then mmap file */)202.95 232.801 Q 19.56(10 fd)129.6
242.801 R 4.89(=O)4.89 G(pen\(FILE, O_RDWR | O_CREAT | O_TRUNC, FILE_MODE\);)
193.17 242.801 Q 19.56(11 ptr)129.6 252.801 R 4.89(=M)4.89 G
(map\(NULL, SIZE, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0\);)198.06 252.801 Q
19.56(12 for)129.6 269.801 R(\(i = 4096; i <= SIZE; i += 4096\) {)4.89 E 39.12
(13 printf\("setting)129.6 279.801 R(file size to %d\\n", i\);)4.89 E 39.12
(14 Ftruncate\(fd,)129.6 289.801 R(i\);)4.89 E 39.12(15 printf\("ptr[%d])129.6
299.801 R 4.89(=%)4.89 G(d\\n", i - 1, ptr[i - 1]\);)276.3 299.801 Q 19.56
(16 })129.6 309.801 R 19.56(17 exit\(0\);)129.6 326.801 R(18 })129.6 336.801 Q
134.6 341.602 129.6 341.602 DL 134.774 341.602 129.774 341.602 DL 139.774
341.602 134.774 341.602 DL 144.774 341.602 139.774 341.602 DL 149.774 341.602
144.774 341.602 DL 154.774 341.602 149.774 341.602 DL 159.774 341.602 154.774
341.602 DL 164.774 341.602 159.774 341.602 DL 169.774 341.602 164.774 341.602
DL 174.774 341.602 169.774 341.602 DL 179.774 341.602 174.774 341.602 DL
184.774 341.602 179.774 341.602 DL 189.774 341.602 184.774 341.602 DL 194.774
341.602 189.774 341.602 DL 199.774 341.602 194.774 341.602 DL 204.774 341.602
199.774 341.602 DL 209.774 341.602 204.774 341.602 DL 214.774 341.602 209.774
341.602 DL 219.774 341.602 214.774 341.602 DL 224.774 341.602 219.774 341.602
DL 229.774 341.602 224.774 341.602 DL 234.774 341.602 229.774 341.602 DL
239.774 341.602 234.774 341.602 DL 244.774 341.602 239.774 341.602 DL 249.774
341.602 244.774 341.602 DL 254.774 341.602 249.774 341.602 DL 259.774 341.602
254.774 341.602 DL 264.774 341.602 259.774 341.602 DL 269.774 341.602 264.774
341.602 DL 274.774 341.602 269.774 341.602 DL 279.774 341.602 274.774 341.602
DL 284.774 341.602 279.774 341.602 DL 289.774 341.602 284.774 341.602 DL
294.774 341.602 289.774 341.602 DL 299.774 341.602 294.774 341.602 DL 304.774
341.602 299.774 341.602 DL 309.774 341.602 304.774 341.602 DL 314.774 341.602
309.774 341.602 DL 319.774 341.602 314.774 341.602 DL 324.774 341.602 319.774
341.602 DL 329.774 341.602 324.774 341.602 DL 334.774 341.602 329.774 341.602
DL 339.774 341.602 334.774 341.602 DL 344.774 341.602 339.774 341.602 DL
349.774 341.602 344.774 341.602 DL 354.774 341.602 349.774 341.602 DL 359.774
341.602 354.774 341.602 DL 364.774 341.602 359.774 341.602 DL 369.774 341.602
364.774 341.602 DL 374.774 341.602 369.774 341.602 DL 379.774 341.602 374.774
341.602 DL 384.774 341.602 379.774 341.602 DL 389.774 341.602 384.774 341.602
DL 394.774 341.602 389.774 341.602 DL 399.774 341.602 394.774 341.602 DL
404.774 341.602 399.774 341.602 DL 409.774 341.602 404.774 341.602 DL 414.774
341.602 409.774 341.602 DL 419.774 341.602 414.774 341.602 DL 424.774 341.602
419.774 341.602 DL 429.774 341.602 424.774 341.602 DL 434.774 341.602 429.774
341.602 DL 439.774 341.602 434.774 341.602 DL 444.774 341.602 439.774 341.602
DL 449.774 341.602 444.774 341.602 DL 454.774 341.602 449.774 341.602 DL
459.774 341.602 454.774 341.602 DL 464.774 341.602 459.774 341.602 DL 469.774
341.602 464.774 341.602 DL 474.774 341.602 469.774 341.602 DL F2 -1.5
(shm / test2.c)477.024 344.102 R/F4 8/Palatino-Bold@0 SF(Figure 12.19)212.944
357.602 Q/F5 8/Palatino-Roman@0 SF
(Memory map example that lets the \214le size gr)6 E(ow)-.144 E(.)-.736 E/F6 10
/Palatino-Roman@0 SF 1.064(When we r)147.6 393.602 R 1.064(un this pr)-.08 F
1.064(ogram, we see that as we incr)-.18 F 1.063
(ease the size of the \214le, we ar)-.18 F(e)-.18 E(able to r)129.6 405.602 Q
(efer)-.18 E(ence the new data thr)-.18 E(ough our established memory map.)-.18
E F3(alpha %)147.6 421.602 Q/F7 8.15/Courier-Bold@0 SF(ls -l test.data)4.89 E
F3(test.data: No such file or directory)147.6 431.602 Q(alpha %)147.6 441.602 Q
F7(test2)4.89 E F3(setting file size to 4096)147.6 451.602 Q(ptr[4095] = 0)
147.6 461.602 Q(setting file size to 8192)147.6 471.602 Q(ptr[8191] = 0)147.6
481.602 Q(setting file size to 12288)147.6 491.602 Q(ptr[12287] = 0)147.6
501.602 Q(setting file size to 16384)147.6 511.602 Q(ptr[16383] = 0)147.6
521.602 Q(setting file size to 20480)147.6 531.602 Q(ptr[20479] = 0)147.6
541.602 Q(setting file size to 24576)147.6 551.602 Q(ptr[24575] = 0)147.6
561.602 Q(setting file size to 28672)147.6 571.602 Q(ptr[28671] = 0)147.6
581.602 Q(setting file size to 32768)147.6 591.602 Q(ptr[32767] = 0)147.6
601.602 Q(alpha %)147.6 611.602 Q F7(ls -l test.data)4.89 E F3 9.78
(-rw-r--r-- 1)147.6 621.602 R(rstevens other1)4.89 E
(32768 Mar 20 17:53 test.data)318.75 621.602 Q EP
%%Page: 322 20
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(322)93.6 82 Q/F1 9/Palatino-Roman@0 SF(Shar)125.1 82 Q
2.25(ed Memory Intr)-.162 F 227.622(oduction Chapter)-.162 F(12)2.25 E .32 LW
97.6 89.2 93.6 89.2 DL 99.6 89.2 95.6 89.2 DL 103.6 89.2 99.6 89.2 DL 107.6
89.2 103.6 89.2 DL 111.6 89.2 107.6 89.2 DL 115.6 89.2 111.6 89.2 DL 119.6 89.2
115.6 89.2 DL 123.6 89.2 119.6 89.2 DL 127.6 89.2 123.6 89.2 DL 131.6 89.2
127.6 89.2 DL 135.6 89.2 131.6 89.2 DL 139.6 89.2 135.6 89.2 DL 143.6 89.2
139.6 89.2 DL 147.6 89.2 143.6 89.2 DL 151.6 89.2 147.6 89.2 DL 155.6 89.2
151.6 89.2 DL 159.6 89.2 155.6 89.2 DL 163.6 89.2 159.6 89.2 DL 167.6 89.2
163.6 89.2 DL 171.6 89.2 167.6 89.2 DL 175.6 89.2 171.6 89.2 DL 179.6 89.2
175.6 89.2 DL 183.6 89.2 179.6 89.2 DL 187.6 89.2 183.6 89.2 DL 191.6 89.2
187.6 89.2 DL 195.6 89.2 191.6 89.2 DL 199.6 89.2 195.6 89.2 DL 203.6 89.2
199.6 89.2 DL 207.6 89.2 203.6 89.2 DL 211.6 89.2 207.6 89.2 DL 215.6 89.2
211.6 89.2 DL 219.6 89.2 215.6 89.2 DL 223.6 89.2 219.6 89.2 DL 227.6 89.2
223.6 89.2 DL 231.6 89.2 227.6 89.2 DL 235.6 89.2 231.6 89.2 DL 239.6 89.2
235.6 89.2 DL 243.6 89.2 239.6 89.2 DL 247.6 89.2 243.6 89.2 DL 251.6 89.2
247.6 89.2 DL 255.6 89.2 251.6 89.2 DL 259.6 89.2 255.6 89.2 DL 263.6 89.2
259.6 89.2 DL 267.6 89.2 263.6 89.2 DL 271.6 89.2 267.6 89.2 DL 275.6 89.2
271.6 89.2 DL 279.6 89.2 275.6 89.2 DL 283.6 89.2 279.6 89.2 DL 287.6 89.2
283.6 89.2 DL 291.6 89.2 287.6 89.2 DL 295.6 89.2 291.6 89.2 DL 299.6 89.2
295.6 89.2 DL 303.6 89.2 299.6 89.2 DL 307.6 89.2 303.6 89.2 DL 311.6 89.2
307.6 89.2 DL 315.6 89.2 311.6 89.2 DL 319.6 89.2 315.6 89.2 DL 323.6 89.2
319.6 89.2 DL 327.6 89.2 323.6 89.2 DL 331.6 89.2 327.6 89.2 DL 335.6 89.2
331.6 89.2 DL 339.6 89.2 335.6 89.2 DL 343.6 89.2 339.6 89.2 DL 347.6 89.2
343.6 89.2 DL 351.6 89.2 347.6 89.2 DL 355.6 89.2 351.6 89.2 DL 359.6 89.2
355.6 89.2 DL 363.6 89.2 359.6 89.2 DL 367.6 89.2 363.6 89.2 DL 371.6 89.2
367.6 89.2 DL 375.6 89.2 371.6 89.2 DL 379.6 89.2 375.6 89.2 DL 383.6 89.2
379.6 89.2 DL 387.6 89.2 383.6 89.2 DL 391.6 89.2 387.6 89.2 DL 395.6 89.2
391.6 89.2 DL 399.6 89.2 395.6 89.2 DL 403.6 89.2 399.6 89.2 DL 407.6 89.2
403.6 89.2 DL 411.6 89.2 407.6 89.2 DL 415.6 89.2 411.6 89.2 DL 419.6 89.2
415.6 89.2 DL 423.6 89.2 419.6 89.2 DL 427.6 89.2 423.6 89.2 DL 431.6 89.2
427.6 89.2 DL 435.6 89.2 431.6 89.2 DL 439.6 89.2 435.6 89.2 DL 443.6 89.2
439.6 89.2 DL 447.6 89.2 443.6 89.2 DL 451.6 89.2 447.6 89.2 DL 455.6 89.2
451.6 89.2 DL 459.6 89.2 455.6 89.2 DL 463.6 89.2 459.6 89.2 DL 467.6 89.2
463.6 89.2 DL 471.6 89.2 467.6 89.2 DL 475.6 89.2 471.6 89.2 DL 479.6 89.2
475.6 89.2 DL 483.6 89.2 479.6 89.2 DL 487.6 89.2 483.6 89.2 DL 491.6 89.2
487.6 89.2 DL 495.6 89.2 491.6 89.2 DL 499.6 89.2 495.6 89.2 DL 503.6 89.2
499.6 89.2 DL 507.6 89.2 503.6 89.2 DL 511.6 89.2 507.6 89.2 DL 515.6 89.2
511.6 89.2 DL 519.6 89.2 515.6 89.2 DL/F2 10/Palatino-Roman@0 SF .42(This exam\
ple shows that the kernel keeps track of the size of the underlying object tha\
t)129.6 123 R .074(is memory mapped \(the \214le)129.6 135 R/F3 10/Courier@0 SF
(test.data)2.574 E F2 .074(in this example\), and we ar)2.574 F 2.574(ea)-.18 G
.074(lways able to r)443.658 135 R(ef-)-.18 E(er)129.6 147 Q .758
(ence bytes that ar)-.18 F 3.258(ew)-.18 G .758(ithin the curr)233.652 147 R
.758(ent \214le size that ar)-.18 F 3.258(ea)-.18 G .758
(lso within our memory map.)389.698 147 R 1.84 -.92(We o)129.6 159 T
(btain identical r).92 E(esults under Solaris 2.6.)-.18 E 1.214
(This section has dealt with memory-mapped \214les and)147.6 171 R F3(mmap)
3.714 E F2 6.214(.I)C 3.714(nE)433.298 171 S(xer)448.942 171 Q 1.214
(cise 13.1, we)-.18 F .352(modify our two pr)129.6 183 R .353
(ograms to work with Posix shar)-.18 F .353(ed memory and see the same r)-.18 F
(esults.)-.18 E/F4 12/Helvetica-Bold@0 SF 9.312(12.7 Summar)93.6 219 R(y).12 E
F2(Shar)129.6 243 Q .416(ed memory is the fastest form of IPC available, becau\
se one copy of the data in the)-.18 F(shar)129.6 255 Q .195
(ed memory is available to all the thr)-.18 F .196(eads or pr)-.18 F .196
(ocesses that shar)-.18 F 2.696(et)-.18 G .196(he memory)437.958 255 R 5.196
(.S)-1.11 G(ome)500.52 255 Q 3.208(form of synchr)129.6 267 R 3.208
(onization is normally r)-.18 F(equir)-.18 E 3.208(ed, however)-.18 F 5.708(,t)
-.74 G 5.708(oc)402.886 267 S(oor)418.494 267 Q 3.208(dinate the various)-.18 F
(thr)129.6 279 Q(eads or pr)-.18 E(ocesses that ar)-.18 E 2.5(es)-.18 G
(haring the memory)261.62 279 Q(.)-1.11 E .126(This chapter has focused on the)
147.6 291 R F3(mmap)2.626 E F2 .127(function and the mapping of r)2.626 F .127
(egular \214les into)-.18 F(memory)129.6 303 Q 3.835(,b)-1.11 G 1.335
(ecause this is one way to shar)177.775 303 R 3.835(em)-.18 G 1.334
(emory between r)333.43 303 R 1.334(elated or unr)-.18 F 1.334(elated pr)-.18 F
(o-)-.18 E 2.611(cesses. Once)129.6 315 R .111
(we have memory mapped a \214le, we no longer use)2.611 F F3(read)2.612 E F2(,)
A F3(write)2.612 E F2 2.612(,o)C(r)483.038 315 Q F3(lseek)2.612 E F2 1.333
(to access the \214le; instead, we just fetch or stor)129.6 327 R 3.833(et)-.18
G 1.332(he memory locations that have been)353.38 327 R .462
(mapped to the \214le by)129.6 339 R F3(mmap)2.962 E F2 5.462(.C)C .462
(hanging explicit \214le I/O into fetches and stor)267.642 339 R .462
(es of mem-)-.18 F(ory can often simplify our pr)129.6 351 Q
(ograms and sometimes incr)-.18 E(ease performance.)-.18 E .558
(When the memory is to be shar)147.6 363 R .558(ed acr)-.18 F .558
(oss a subsequent)-.18 F F3(fork)3.058 E F2 3.058(,t)C .557
(his can be simpli\214ed)427.118 363 R .823(by not cr)129.6 375 R .824
(eating a r)-.18 F .824
(egular \214le to map, but using anonymous memory mapping instead.)-.18 F .289
(This involves either a new \215ag of)129.6 387 R F3(MAP_ANON)2.788 E F2 .288
(\(for Berkeley-derived kernels\) or mapping)2.788 F F3(/dev/zero)129.6 399 Q
F2(\(for SVR4-derived kernels\).)2.5 E 1.125(Our r)147.6 411 R 1.125
(eason for covering)-.18 F F3(mmap)3.625 E F2 1.126
(in such detail is both because memory mapping of)3.625 F .529
(\214les is a useful technique and because)129.6 423 R F3(mmap)3.029 E F2 .529
(is used for Posix shar)3.029 F .528(ed memory)-.18 F 3.028(,w)-1.11 G .528
(hich is)490.432 423 R(the topic of the next chapter)129.6 435 Q(.)-.74 E .321
(Also available ar)147.6 447 R 2.821(ef)-.18 G .322
(our additional functions \(that we do not cover\) de\214ned by Posix)233.043
447 R(dealing with memory management:)129.6 459 Q<83>147.6 483 Q F3(mlockall)
8.83 E F2 2.434(causes all of the memory of the pr)4.935 F 2.434
(ocess to be memory r)-.18 F(esident.)-.18 E F3(munlockall)162.49 495 Q F2
(undoes this locking.)2.5 E<83>147.6 511 Q F3(mlock)8.83 E F2 1.017
(causes a speci\214ed range of addr)3.516 F 1.017(esses of the pr)-.18 F 1.017
(ocess to be memory r)-.18 F(esi-)-.18 E .04(dent, wher)162.49 523 R 2.54(et)
-.18 G .04(he function ar)220.82 523 R .039(guments ar)-.18 F 2.539(eas)-.18 G
.039(tarting addr)351.296 523 R .039(ess and a number of bytes)-.18 F(fr)162.49
535 Q(om that addr)-.18 E(ess.)-.18 E F3(munlock)5 E F2
(unlocks a speci\214ed r)2.5 E(egion of memory)-.18 E(.)-1.11 E F4(Ex)129.6 589
Q(er)-.12 E(cises)-.24 E F0(12.1)129.6 610 Q F1 .188
(What would happen in Figur)157.185 610 R 2.438(e1)-.162 G .189
(2.19 if we executed the code within the)285.232 610 R/F5 9/Courier@0 SF(for)
2.439 E F1 .189(loop one mor)2.439 F(e)-.162 E(time?)157.185 621 Q F0(12.2)
129.6 636 Q F1 .414(Assume that we have two pr)157.185 636 R .414
(ocesses, a sender and a r)-.162 F(eceiver)-.162 E 2.663(,w)-.666 G .413
(ith the former just sending)412.387 636 R .884(messages to the latter)157.185
647 R 5.384(.A)-.666 G .884(ssume that System V message queues ar)259.262 647 R
3.134(eu)-.162 G .884(sed and draw a dia-)437.026 647 R 1.916
(gram of how the messages go fr)157.185 658 R 1.916(om the sender to the r)
-.162 F(eceiver)-.162 E 6.416(.N)-.666 G 1.916(ow assume that our)435.363 658 R
EP
%%Page: 323 21
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF(Chapter 12)93.6 82 Q(Exer)451.695 82 Q(cises)-.162 E
/F1 9/Palatino-Bold@0 SF(323)506.1 82 Q .32 LW 97.6 89.2 93.6 89.2 DL 99.6 89.2
95.6 89.2 DL 103.6 89.2 99.6 89.2 DL 107.6 89.2 103.6 89.2 DL 111.6 89.2 107.6
89.2 DL 115.6 89.2 111.6 89.2 DL 119.6 89.2 115.6 89.2 DL 123.6 89.2 119.6 89.2
DL 127.6 89.2 123.6 89.2 DL 131.6 89.2 127.6 89.2 DL 135.6 89.2 131.6 89.2 DL
139.6 89.2 135.6 89.2 DL 143.6 89.2 139.6 89.2 DL 147.6 89.2 143.6 89.2 DL
151.6 89.2 147.6 89.2 DL 155.6 89.2 151.6 89.2 DL 159.6 89.2 155.6 89.2 DL
163.6 89.2 159.6 89.2 DL 167.6 89.2 163.6 89.2 DL 171.6 89.2 167.6 89.2 DL
175.6 89.2 171.6 89.2 DL 179.6 89.2 175.6 89.2 DL 183.6 89.2 179.6 89.2 DL
187.6 89.2 183.6 89.2 DL 191.6 89.2 187.6 89.2 DL 195.6 89.2 191.6 89.2 DL
199.6 89.2 195.6 89.2 DL 203.6 89.2 199.6 89.2 DL 207.6 89.2 203.6 89.2 DL
211.6 89.2 207.6 89.2 DL 215.6 89.2 211.6 89.2 DL 219.6 89.2 215.6 89.2 DL
223.6 89.2 219.6 89.2 DL 227.6 89.2 223.6 89.2 DL 231.6 89.2 227.6 89.2 DL
235.6 89.2 231.6 89.2 DL 239.6 89.2 235.6 89.2 DL 243.6 89.2 239.6 89.2 DL
247.6 89.2 243.6 89.2 DL 251.6 89.2 247.6 89.2 DL 255.6 89.2 251.6 89.2 DL
259.6 89.2 255.6 89.2 DL 263.6 89.2 259.6 89.2 DL 267.6 89.2 263.6 89.2 DL
271.6 89.2 267.6 89.2 DL 275.6 89.2 271.6 89.2 DL 279.6 89.2 275.6 89.2 DL
283.6 89.2 279.6 89.2 DL 287.6 89.2 283.6 89.2 DL 291.6 89.2 287.6 89.2 DL
295.6 89.2 291.6 89.2 DL 299.6 89.2 295.6 89.2 DL 303.6 89.2 299.6 89.2 DL
307.6 89.2 303.6 89.2 DL 311.6 89.2 307.6 89.2 DL 315.6 89.2 311.6 89.2 DL
319.6 89.2 315.6 89.2 DL 323.6 89.2 319.6 89.2 DL 327.6 89.2 323.6 89.2 DL
331.6 89.2 327.6 89.2 DL 335.6 89.2 331.6 89.2 DL 339.6 89.2 335.6 89.2 DL
343.6 89.2 339.6 89.2 DL 347.6 89.2 343.6 89.2 DL 351.6 89.2 347.6 89.2 DL
355.6 89.2 351.6 89.2 DL 359.6 89.2 355.6 89.2 DL 363.6 89.2 359.6 89.2 DL
367.6 89.2 363.6 89.2 DL 371.6 89.2 367.6 89.2 DL 375.6 89.2 371.6 89.2 DL
379.6 89.2 375.6 89.2 DL 383.6 89.2 379.6 89.2 DL 387.6 89.2 383.6 89.2 DL
391.6 89.2 387.6 89.2 DL 395.6 89.2 391.6 89.2 DL 399.6 89.2 395.6 89.2 DL
403.6 89.2 399.6 89.2 DL 407.6 89.2 403.6 89.2 DL 411.6 89.2 407.6 89.2 DL
415.6 89.2 411.6 89.2 DL 419.6 89.2 415.6 89.2 DL 423.6 89.2 419.6 89.2 DL
427.6 89.2 423.6 89.2 DL 431.6 89.2 427.6 89.2 DL 435.6 89.2 431.6 89.2 DL
439.6 89.2 435.6 89.2 DL 443.6 89.2 439.6 89.2 DL 447.6 89.2 443.6 89.2 DL
451.6 89.2 447.6 89.2 DL 455.6 89.2 451.6 89.2 DL 459.6 89.2 455.6 89.2 DL
463.6 89.2 459.6 89.2 DL 467.6 89.2 463.6 89.2 DL 471.6 89.2 467.6 89.2 DL
475.6 89.2 471.6 89.2 DL 479.6 89.2 475.6 89.2 DL 483.6 89.2 479.6 89.2 DL
487.6 89.2 483.6 89.2 DL 491.6 89.2 487.6 89.2 DL 495.6 89.2 491.6 89.2 DL
499.6 89.2 495.6 89.2 DL 503.6 89.2 499.6 89.2 DL 507.6 89.2 503.6 89.2 DL
511.6 89.2 507.6 89.2 DL 515.6 89.2 511.6 89.2 DL 519.6 89.2 515.6 89.2 DL F0
.478(implementation of Posix message queues fr)157.185 122 R .478
(om Section 5.8 is used, and draw a diagram of)-.162 F
(the transfer of messages.)157.185 133 Q F1(12.3)129.6 148 Q F0 -.495(Wi)
157.185 148 S(th).495 E/F2 9/Courier@0 SF(mmap)3.085 E F0(and)3.085 E F2
(MAP_SHARED)3.085 E F0 3.084(,w)C 3.084(es)289.413 148 S .834
(aid that the kernel virtual memory algorithm updates)300.624 148 R .394
(the actual \214le with any modi\214cations that ar)157.185 159 R 2.644(em)
-.162 G .394(ade to the memory image.)350.405 159 R .394(Read the man-)4.894 F
.732(ual page for)157.185 170 R F2(/dev/zero)2.982 E F0 .732
(to determine what happens when the kernel writes the changes)2.982 F
(back to the \214le.)157.185 181 Q F1(12.4)129.6 196 Q F0 .373(Modify Figur)
157.185 196 R 2.623(e1)-.162 G .373(2.10 to specify)222.236 196 R F2
(MAP_PRIVATE)2.624 E F0 .374(instead of)2.624 F F2(MAP_SHARED)2.624 E F0 2.624
(,a)C .374(nd verify that the)449.331 196 R -.162(re)157.185 207 S .678
(sults ar).162 F 2.928(es)-.162 G .678(imilar to the r)205.377 207 R .677
(esults fr)-.162 F .677(om Figur)-.162 F 2.927(e1)-.162 G 2.927(2.3. What)
342.957 207 R(ar)2.927 E 2.927(et)-.162 G .677
(he contents of the \214le that is)404.298 207 R(memory mapped?)157.185 218 Q
F1(12.5)129.6 233 Q F0 .536(In Section 6.9, we mentioned that one way to)
157.185 233 R F2(select)2.786 E F0 .536(on a System V message queue is to)2.786
F(cr)157.185 244 Q .924(eate a piece of anonymous shar)-.162 F .923(ed memory)
-.162 F 3.173(,c)-.999 G -.162(re)348.582 244 S .923
(ate a child, and let the child block in its).162 F 1.632(call to)157.185 255 R
F2(msgrcv)3.882 E F0 3.882(,r)C 1.633(eading the message into shar)228.456 255
R 1.633(ed memory)-.162 F 6.133(.T)-.999 G 1.633(he par)410.27 255 R 1.633
(ent also cr)-.162 F 1.633(eates two)-.162 F .285
(pipes; one is used by the child to notify the par)157.185 266 R .284
(ent that a message is r)-.162 F .284(eady in shar)-.162 F .284(ed mem-)-.162 F
(ory)157.185 277 Q 2.698(,a)-.999 G .448(nd the other pipe is used by the par)
179.107 277 R .448(ent to notify the child that the shar)-.162 F .449
(ed memory is)-.162 F .657(now available.)157.185 288 R .656
(This allows the par)5.156 F .656(ent to)-.162 F F2(select)2.906 E F0 .656
(on the r)2.906 F .656(ead end of the pipe, along with)-.162 F .474
(any other descriptors on which it wants to)157.185 299 R F2(select)2.725 E F0
4.975(.C)C .475(ode this solution.)377.248 299 R .475(Call our)4.975 F F2
(my_shm)2.725 E F0 3.58(function \(Figur)157.185 310 R 5.83(eA)-.162 G 3.58
(.46\) to allocate the anonymous shar)237.965 310 R 3.58(ed memory object.)
-.162 F 3.579(Use our)8.079 F F2(msgcreate)157.185 321 Q F0(and)2.399 E F2
(msgsnd)2.399 E F0(pr)2.399 E .15(ograms fr)-.162 F .15(om Section 6.6 to cr)
-.162 F .15(eate the message queue, and then)-.162 F .545(place r)157.185 332 R
(ecor)-.162 E .544(ds onto the queue.)-.162 F .544(The par)5.044 F .544
(ent should just print the size and type of each mes-)-.162 F
(sage that the child r)157.185 343 Q(eads.)-.162 E EP
%%Trailer
end
%%EOF
